!function(e){function t(t){for(var n,i,s=t[0],u=t[1],c=t[2],d=0,p=[];d<s.length;d++)i=s[d],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&p.push(o[i][0]),o[i]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);for(l&&l(t);p.length;)p.shift()();return a.push.apply(a,c||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,s=1;s<r.length;s++){var u=r[s];0!==o[u]&&(n=!1)}n&&(a.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},o={"web/story_publisher":0},a=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/js/cmodules/";var s=window.webpackJsonp=window.webpackJsonp||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var l=u;a.push([265,"bundles/common","bundles/vendors","bundles/1c6a9b415901224f27daf60c6bc90be0"]),r()}({"/MKj":function(e,t,r){"use strict";r.r(t),r.d(t,"Provider",(function(){return h})),r.d(t,"connectAdvanced",(function(){return P})),r.d(t,"ReactReduxContext",(function(){return c})),r.d(t,"connect",(function(){return ne})),r.d(t,"batch",(function(){return de.unstable_batchedUpdates})),r.d(t,"useDispatch",(function(){return ie})),r.d(t,"useSelector",(function(){return ce})),r.d(t,"useStore",(function(){return ae})),r.d(t,"shallowEqual",(function(){return L}));var n=r("JX7q"),o=r("dI71"),a=r("q1tI"),i=r.n(a),s=r("17x9"),u=r.n(s),c=i.a.createContext(null);var l=function(e){e()},d={notify:function(){}};function p(){var e=l,t=[],r=[];return{clear:function(){r=null,t=null},notify:function(){var n=t=r;e((function(){for(var e=0;e<n.length;e++)n[e]()}))},get:function(){return r},subscribe:function(e){var n=!0;return r===t&&(r=t.slice()),r.push(e),function(){n&&null!==t&&(n=!1,r===t&&(r=t.slice()),r.splice(r.indexOf(e),1))}}}}var f=function(){function e(e,t){this.store=e,this.parentSub=t,this.unsubscribe=null,this.listeners=d,this.handleChangeWrapper=this.handleChangeWrapper.bind(this)}var t=e.prototype;return t.addNestedSub=function(e){return this.trySubscribe(),this.listeners.subscribe(e)},t.notifyNestedSubs=function(){this.listeners.notify()},t.handleChangeWrapper=function(){this.onStateChange&&this.onStateChange()},t.isSubscribed=function(){return Boolean(this.unsubscribe)},t.trySubscribe=function(){this.unsubscribe||(this.unsubscribe=this.parentSub?this.parentSub.addNestedSub(this.handleChangeWrapper):this.store.subscribe(this.handleChangeWrapper),this.listeners=p())},t.tryUnsubscribe=function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null,this.listeners.clear(),this.listeners=d)},e}(),m=function(e){function t(t){var r;r=e.call(this,t)||this;var o=t.store;r.notifySubscribers=r.notifySubscribers.bind(Object(n.default)(r));var a=new f(o);return a.onStateChange=r.notifySubscribers,r.state={store:o,subscription:a},r.previousState=o.getState(),r}Object(o.default)(t,e);var r=t.prototype;return r.componentDidMount=function(){this._isMounted=!0,this.state.subscription.trySubscribe(),this.previousState!==this.props.store.getState()&&this.state.subscription.notifyNestedSubs()},r.componentWillUnmount=function(){this.unsubscribe&&this.unsubscribe(),this.state.subscription.tryUnsubscribe(),this._isMounted=!1},r.componentDidUpdate=function(e){if(this.props.store!==e.store){this.state.subscription.tryUnsubscribe();var t=new f(this.props.store);t.onStateChange=this.notifySubscribers,this.setState({store:this.props.store,subscription:t})}},r.notifySubscribers=function(){this.state.subscription.notifyNestedSubs()},r.render=function(){var e=this.props.context||c;return i.a.createElement(e.Provider,{value:this.state},this.props.children)},t}(a.Component);m.propTypes={store:u.a.shape({subscribe:u.a.func.isRequired,dispatch:u.a.func.isRequired,getState:u.a.func.isRequired}),context:u.a.object,children:u.a.any};var h=m,g=r("wx14"),v=r("zLVn"),_=r("2mql"),y=r.n(_),x=r("QLaP"),b=r.n(x),E=r("TOwV"),w=[],T=[null,null];function S(e,t){var r=e[1];return[t.payload,r+1]}var C=function(){return[null,0]},O="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?a.useLayoutEffect:a.useEffect;function P(e,t){void 0===t&&(t={});var r=t,n=r.getDisplayName,o=void 0===n?function(e){return"ConnectAdvanced("+e+")"}:n,s=r.methodName,u=void 0===s?"connectAdvanced":s,l=r.renderCountProp,d=void 0===l?void 0:l,p=r.shouldHandleStateChanges,m=void 0===p||p,h=r.storeKey,_=void 0===h?"store":h,x=r.withRef,P=void 0!==x&&x,D=r.forwardRef,k=void 0!==D&&D,L=r.context,N=void 0===L?c:L,R=Object(v.default)(r,["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"]);b()(void 0===d,"renderCountProp is removed. render counting is built into the latest React Dev Tools profiling extension"),b()(!P,"withRef is removed. To access the wrapped instance, use a ref on the connected component");b()("store"===_,"storeKey has been removed and does not do anything. To use a custom Redux store for specific components, create a custom React context with React.createContext(), and pass the context object to React Redux's Provider and specific components like: <Provider context={MyContext}><ConnectedComponent context={MyContext} /></Provider>. You may also pass a {context : MyContext} option to connect");var I=N;return function(t){var r=t.displayName||t.name||"Component",n=o(r),s=Object(g.default)({},R,{getDisplayName:o,methodName:u,renderCountProp:d,shouldHandleStateChanges:m,storeKey:_,displayName:n,wrappedComponentName:r,WrappedComponent:t}),c=R.pure;var l=c?a.useMemo:function(e){return e()};function p(r){var o=Object(a.useMemo)((function(){var e=r.forwardedRef,t=Object(v.default)(r,["forwardedRef"]);return[r.context,e,t]}),[r]),u=o[0],c=o[1],d=o[2],p=Object(a.useMemo)((function(){return u&&u.Consumer&&Object(E.isContextConsumer)(i.a.createElement(u.Consumer,null))?u:I}),[u,I]),h=Object(a.useContext)(p),_=Boolean(r.store),y=Boolean(h)&&Boolean(h.store);b()(_||y,'Could not find "store" in the context of "'+n+'". Either wrap the root component in a <Provider>, or pass a custom React context provider to <Provider> and the corresponding React context consumer to '+n+" in connect options.");var x=r.store||h.store,P=Object(a.useMemo)((function(){return function(t){return e(t.dispatch,s)}(x)}),[x]),D=Object(a.useMemo)((function(){if(!m)return T;var e=new f(x,_?null:h.subscription),t=e.notifyNestedSubs.bind(e);return[e,t]}),[x,_,h]),k=D[0],L=D[1],N=Object(a.useMemo)((function(){return _?h:Object(g.default)({},h,{subscription:k})}),[_,h,k]),R=Object(a.useReducer)(S,w,C),A=R[0][0],j=R[1];if(A&&A.error)throw A.error;var M=Object(a.useRef)(),F=Object(a.useRef)(d),B=Object(a.useRef)(),U=Object(a.useRef)(!1),H=l((function(){return B.current&&d===F.current?B.current:P(x.getState(),d)}),[x,A,d]);O((function(){F.current=d,M.current=H,U.current=!1,B.current&&(B.current=null,L())})),O((function(){if(m){var e=!1,t=null,r=function(){if(!e){var r,n,o=x.getState();try{r=P(o,F.current)}catch(e){n=e,t=e}n||(t=null),r===M.current?U.current||L():(M.current=r,B.current=r,U.current=!0,j({type:"STORE_UPDATED",payload:{latestStoreState:o,error:n}}))}};k.onStateChange=r,k.trySubscribe(),r();return function(){if(e=!0,k.tryUnsubscribe(),t)throw t}}}),[x,k,P]);var W=Object(a.useMemo)((function(){return i.a.createElement(t,Object(g.default)({},H,{ref:c}))}),[c,t,H]);return Object(a.useMemo)((function(){return m?i.a.createElement(p.Provider,{value:N},W):W}),[p,W,N])}var h=c?i.a.memo(p):p;if(h.WrappedComponent=t,h.displayName=n,k){var x=i.a.forwardRef((function(e,t){return i.a.createElement(h,Object(g.default)({},e,{forwardedRef:t}))}));return x.displayName=n,x.WrappedComponent=t,y()(x,t)}return y()(h,t)}}var D=Object.prototype.hasOwnProperty;function k(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}function L(e,t){if(k(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var o=0;o<r.length;o++)if(!D.call(t,r[o])||!k(e[r[o]],t[r[o]]))return!1;return!0}var N=r("ANjH");function R(e){return function(t,r){var n=e(t,r);function o(){return n}return o.dependsOnOwnProps=!1,o}}function I(e){return null!==e.dependsOnOwnProps&&void 0!==e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}function A(e,t){return function(t,r){r.displayName;var n=function(e,t){return n.dependsOnOwnProps?n.mapToProps(e,t):n.mapToProps(e)};return n.dependsOnOwnProps=!0,n.mapToProps=function(t,r){n.mapToProps=e,n.dependsOnOwnProps=I(e);var o=n(t,r);return"function"==typeof o&&(n.mapToProps=o,n.dependsOnOwnProps=I(o),o=n(t,r)),o},n}}var j=[function(e){return"function"==typeof e?A(e):void 0},function(e){return e?void 0:R((function(e){return{dispatch:e}}))},function(e){return e&&"object"==typeof e?R((function(t){return Object(N.bindActionCreators)(e,t)})):void 0}];var M=[function(e){return"function"==typeof e?A(e):void 0},function(e){return e?void 0:R((function(){return{}}))}];function F(e,t,r){return Object(g.default)({},r,e,t)}var B=[function(e){return"function"==typeof e?function(e){return function(t,r){r.displayName;var n,o=r.pure,a=r.areMergedPropsEqual,i=!1;return function(t,r,s){var u=e(t,r,s);return i?o&&a(u,n)||(n=u):(i=!0,n=u),n}}}(e):void 0},function(e){return e?void 0:function(){return F}}];function U(e,t,r,n){return function(o,a){return r(e(o,a),t(n,a),a)}}function H(e,t,r,n,o){var a,i,s,u,c,l=o.areStatesEqual,d=o.areOwnPropsEqual,p=o.areStatePropsEqual,f=!1;function m(o,f){var m,h,g=!d(f,i),v=!l(o,a);return a=o,i=f,g&&v?(s=e(a,i),t.dependsOnOwnProps&&(u=t(n,i)),c=r(s,u,i)):g?(e.dependsOnOwnProps&&(s=e(a,i)),t.dependsOnOwnProps&&(u=t(n,i)),c=r(s,u,i)):v?(m=e(a,i),h=!p(m,s),s=m,h&&(c=r(s,u,i)),c):c}return function(o,l){return f?m(o,l):(s=e(a=o,i=l),u=t(n,i),c=r(s,u,i),f=!0,c)}}function W(e,t){var r=t.initMapStateToProps,n=t.initMapDispatchToProps,o=t.initMergeProps,a=Object(v.default)(t,["initMapStateToProps","initMapDispatchToProps","initMergeProps"]),i=r(e,a),s=n(e,a),u=o(e,a);return(a.pure?H:U)(i,s,u,e,a)}function Y(e,t,r){for(var n=t.length-1;n>=0;n--){var o=t[n](e);if(o)return o}return function(t,n){throw new Error("Invalid value of type "+typeof e+" for "+r+" argument when connecting component "+n.wrappedComponentName+".")}}function z(e,t){return e===t}var V,G,X,K,Z,q,$,J,Q,ee,te,re,ne=(X=(G=void 0===V?{}:V).connectHOC,K=void 0===X?P:X,Z=G.mapStateToPropsFactories,q=void 0===Z?M:Z,$=G.mapDispatchToPropsFactories,J=void 0===$?j:$,Q=G.mergePropsFactories,ee=void 0===Q?B:Q,te=G.selectorFactory,re=void 0===te?W:te,function(e,t,r,n){void 0===n&&(n={});var o=n,a=o.pure,i=void 0===a||a,s=o.areStatesEqual,u=void 0===s?z:s,c=o.areOwnPropsEqual,l=void 0===c?L:c,d=o.areStatePropsEqual,p=void 0===d?L:d,f=o.areMergedPropsEqual,m=void 0===f?L:f,h=Object(v.default)(o,["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"]),_=Y(e,q,"mapStateToProps"),y=Y(t,J,"mapDispatchToProps"),x=Y(r,ee,"mergeProps");return K(re,Object(g.default)({methodName:"connect",getDisplayName:function(e){return"Connect("+e+")"},shouldHandleStateChanges:Boolean(e),initMapStateToProps:_,initMapDispatchToProps:y,initMergeProps:x,pure:i,areStatesEqual:u,areOwnPropsEqual:l,areStatePropsEqual:p,areMergedPropsEqual:m},h))});function oe(){var e=Object(a.useContext)(c);return b()(e,"could not find react-redux context value; please ensure the component is wrapped in a <Provider>"),e}function ae(){return oe().store}function ie(){return ae().dispatch}var se="undefined"!=typeof window?a.useLayoutEffect:a.useEffect,ue=function(e,t){return e===t};function ce(e,t){void 0===t&&(t=ue),b()(e,"You must pass a selector to useSelectors");var r,n=oe(),o=n.store,i=n.subscription,s=Object(a.useReducer)((function(e){return e+1}),0)[1],u=Object(a.useMemo)((function(){return new f(o,i)}),[o,i]),c=Object(a.useRef)(),l=Object(a.useRef)(),d=Object(a.useRef)();try{r=e!==l.current||c.current?e(o.getState()):d.current}catch(e){var p="An error occured while selecting the store state: "+e.message+".";throw c.current&&(p+="\nThe error may be correlated with this previous error:\n"+c.current.stack+"\n\nOriginal stack trace:"),new Error(p)}return se((function(){l.current=e,d.current=r,c.current=void 0})),se((function(){function e(){try{var e=l.current(o.getState());if(t(e,d.current))return;d.current=e}catch(e){c.current=e}s({})}return u.onStateChange=e,u.trySubscribe(),e(),function(){return u.tryUnsubscribe()}}),[o,u]),r}var le,de=r("i8i4");le=de.unstable_batchedUpdates,l=le},"/TnQ":function(e,t,r){"use strict";var n=r("ANjH").compose;t.__esModule=!0,t.composeWithDevTools=function(){if(0!==arguments.length)return"object"==typeof arguments[0]?n:n.apply(null,arguments)},t.devToolsEnhancer=function(){return function(e){return e}}},"0fW4":function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),o=r("/MKj"),a=r("ANjH"),i=r("/TnQ"),s=r("sINF"),u=r("xYVc"),c=function(){return(c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},l={isDataLoaded:!1,isShowDropBox:!1,isSaveLoading:!1,currentMode:u.default.TABS.STICKERS,currentStickerPackIndex:0,stickerHeaderScrollPosition:0},d=function(e,t){switch(void 0===e&&(e=l),t.type){case"SET_DATA_LOADED":return c(c({},e),{isDataLoaded:!0});case"SET_SHOW_DROP_BOX":return c(c({},e),{isShowDropBox:t.value});case"SET_SAVE_LOADING":return c(c({},e),{isSaveLoading:t.value});case"SET_CURRENT_TAB":return c(c({},e),{currentMode:t.value});case"SET_CURRENT_STICKER_PACK_INDEX":return c(c({},e),{currentStickerPackIndex:t.value});case"SET_HEADER_SCROLL_POSITION":return c(c({},e),{stickerHeaderScrollPosition:t.value});default:return e}},p=function(){return(p=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},f={color:u.default.COLORS[0],brushWidth:.5,brushOpacity:1,fontSize:.5,fontStyle:u.default.FONTS[0],filter:{name:u.default.PHOTO_FILTERS[0],value:.75},colorCorrection:{exposure:0,brightness:0,contrast:0,saturation:0,vignette:0,sharpness:0,warmth:0}},m=function(e,t){var r;switch(void 0===e&&(e=f),t.type){case"SET_SETTING_COLOR":return p(p({},e),{color:t.color});case"SET_SETTING_BRUSH_WIDTH":return p(p({},e),{brushWidth:t.brushWidth});case"SET_SETTING_BRUSH_OPACITY":return p(p({},e),{brushOpacity:t.brushOpacity});case"SET_SETTING_FONT_SIZE":return p(p({},e),{fontSize:t.fontSize});case"SET_SETTING_FONT_FAMILY":return p(p({},e),{fontStyle:t.fontStyle});case"SET_SETTING_COLOR_CORRECTION":return p(p({},e),{colorCorrection:p(p({},e.colorCorrection),(r={},r[t.filter]=t.value,r))});case"SET_SETTING_FILTER":return p(p({},e),{filter:{name:t.name,value:t.value}});default:return e}},h=function(){return(h=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},g=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},v={currentIndex:null,items:[]},_=function(e,t){switch(void 0===e&&(e=v),t.type){case"SET_CURRENT_LAYER":return h(h({},e),{currentIndex:t.index});case"ADD_LAYER_STICKER":case"ADD_LAYER_TEXT":case"ADD_LAYER_IMAGE":return h(h({},e),{items:g(e.items,[t.payload])});case"UPDATE_LAYER":return h(h({},e),{items:e.items.map((function(r,n){return e.currentIndex===n?h(h({},r),t.payload):r}))});case"DELETE_LAYER":return{currentIndex:null,items:e.items.filter((function(e,r){return r!==t.index}))};default:return e}},y=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},x=function(e,t){switch(void 0===e&&(e=[]),t.type){case"ADD_VECTOR":return y(e,[t.payload]);case"UNDO_DRAWING":return e.filter((function(t,r){return r!==e.length-1}));default:return e}},b=function(){return(b=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},E={currentBackgroundType:u.default.BACKGROUND_MODES.BACKGROUND,currentPhotoUrl:null,currentBackgroundId:1},w=function(e,t){switch(void 0===e&&(e=E),t.type){case"SET_CURRENT_BACKGROUND_TYPE":return b(b({},e),{currentBackgroundType:t.value});case"SET_CURRENT_PHOTO_URL":return b(b({},e),{currentPhotoUrl:t.value});case"SET_CURRENT_BACKGROUND_ID":return b(b({},e),{currentBackgroundId:t.value});default:return e}},T=function(){return(T=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},S=function(e,t){switch(void 0===e&&(e={}),t.type){case"SET_DATA":return T(T({},e),t.payload);default:return e}},C=Object(a.combineReducers)({ui:d,settings:m,layers:_,drawings:x,background:w,data:S}),O=r("mYgU"),P=r.n(O),D=r("ufMw"),k=r("nAFc"),L=r("jE6c"),N=function(e){return{type:"SET_CURRENT_LAYER",index:e}},R=function(e,t,r){return void 0===r&&(r=!0),function(n,o){var a=o().layers.items;n({type:e,payload:t}),r&&n(N(a.length))}},I=function(e,t){return function(r,n){var o,a,i=n(),s=i.data,c=i.settings,l=s.artboardWidth/2,d=s.artboardHeight/2-(parseInt(null===(o=s.addons)||void 0===o?void 0:o.photoOffsetTop)||0),p=Object(k.decodeHTMLEntities)(s.placeholders[Object(L.irand)(0,s.placeholders.length-1)]),f=0,m=!1,h=c.fontStyle,g=c.color,v=c.fontSize;t&&(l=void 0!==t.x?t.x:l,d=void 0!==t.y?t.y:d,p=void 0!==t.text?t.text:p,f=void 0!==t.rotate?t.rotate:f,m=void 0!==t.isEdit?t.isEdit:m,h=void 0!==t.style?t.style:h,g=void 0!==t.color?t.color:g,v=void 0!==t.fontSize?t.fontSize:v,a=t.initialFontSize),Object(D.sendStat)(D.EVENTS.ADD_TEXT),e&&r(B(u.default.TABS.TEXT)),r(R("ADD_LAYER_TEXT",{type:u.default.LAYER_TYPES.TEXT,text:p,x:l,y:d,rotate:f,isFixed:!1,isEdit:m,fontSize:v,initialFontSize:a,fontStyle:h,color:g,scale:1},e))}},A=function(e){return function(t,r){var n=r().layers,o=n.currentIndex,a=n.items;null!==o&&a[o]&&t({type:"UPDATE_LAYER",payload:e})}},j=function(){return function(e,t){var r=t().layers,n=r.currentIndex,o=r.items;if(null!==n){var a=o[n];a&&(a.type===u.default.LAYER_TYPES.STICKER?Object(D.sendStat)(D.EVENTS.DELETE_STICKER):a.type===u.default.LAYER_TYPES.TEXT&&Object(D.sendStat)(D.EVENTS.DELETE_TEXT),e(F(!1)),e({type:"DELETE_LAYER",index:n}))}}},M=function(){return function(e,t){var r=t().layers,n=r.currentIndex,o=r.items;if(null!==n){var a=o[n];a&&a.type===u.default.LAYER_TYPES.TEXT&&(o[n].text.trim()?e(A({isEdit:!1})):e(j()))}}},F=function(e){return{type:"SET_SHOW_DROP_BOX",value:e}},B=function(e){return function(t,r){var n=r().layers,o=n.items,a=n.currentIndex;null!==a&&(o[a].type===u.default.LAYER_TYPES.TEXT&&t(M()),e===u.default.TABS.PAINT&&t(N(null))),t({type:"SET_CURRENT_TAB",value:e})}},U=function(e){return function(t,r){var n=r().layers,o=n.currentIndex,a=n.items;o&&!a[o]||t(A({color:e})),t({type:"SET_SETTING_COLOR",color:e})}},H=function(e,t){return{type:"SET_SETTING_FILTER",name:e,value:t}},W=function(){return Object(D.sendStat)(D.EVENTS.CANCEL_GRAFFITI),{type:"UNDO_DRAWING"}},Y=r("i8i4");function z(e){return new Promise((function(t,r){var n=new Image;n.crossOrigin="Anonymous",n.onerror=function(){r(new Error("Failed to load image's URL: "+e))},n.onload=function(){t(n)},n.src=e}))}function V(e,t){if(!t)return{x:0,y:0,xOrigin:0,yOrigin:0};var r=t.getBoundingClientRect(),n=r.left,o=r.top;return{x:e.clientX-n,y:e.clientY-o,xOrigin:n,yOrigin:o}}function G(e,t){var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?"rgba("+parseInt(r[1],16)+", "+parseInt(r[2],16)+", "+parseInt(r[3],16)+", "+t+")":"rgba(0, 0, 0, 1)"}function X(e){var t,r={r:0,g:0,b:0};if(!e)return r;try{t=e.getImageData(0,0,e.canvas.width,e.canvas.height)}catch(e){return r}for(var n=-4,o=0;(n+=20)<t.data.length;)++o,r.r+=t.data[n],r.g+=t.data[n+1],r.b+=t.data[n+2];return r.r=~~(r.r/o),r.g=~~(r.g/o),r.b=~~(r.b/o),r}function K(){return new Promise((function(e,t){var r=document.createElement("input");r.setAttribute("style","width: 0; height: 0; position: absolute; top: -1000px; left: -1000px; visibility: hidden"),r.value="",r.type="file",r.accept="image/*",r.onchange=function(r){var n=r.target;if(!n)return t();if(!n.files)return t();var o=n.files[0],a=URL.createObjectURL(o);z(a).then((function(){(function(e){return new Promise((function(t){var r=new FileReader;r.onload=function(e){if(e.target){var r=e.target,n=new DataView(r.result);if(65496!=n.getUint16(0,!1))return t(-2);for(var o=n.byteLength,a=2;a<o;){if(n.getUint16(a+2,!1)<=8)return t(-1);var i=n.getUint16(a,!1);if(a+=2,65505==i){if(1165519206!=n.getUint32(a+=2,!1))return t(-1);var s=18761==n.getUint16(a+=6,!1);a+=n.getUint32(a+4,s);var u=n.getUint16(a,s);a+=2;for(var c=0;c<u;c++)if(274==n.getUint16(a+12*c,s))return t(n.getUint16(a+12*c+8,s))}else{if(65280!=(65280&i))break;a+=n.getUint16(a,!1)}}return t(-1)}},r.readAsArrayBuffer(e)}))})(o).then((function(r){-1===r||-2===r||1===r?e(a):function(e,t){return new Promise((function(r,n){var o=new Image;o.onload=function(){var e=o.width,a=o.height,i=document.createElement("canvas"),s=i.getContext("2d");if(!s)return n();switch(4<t&&t<9?(i.width=a,i.height=e):(i.width=e,i.height=a),t){case 2:s.transform(-1,0,0,1,e,0);break;case 3:s.transform(-1,0,0,-1,e,a);break;case 4:s.transform(1,0,0,-1,0,a);break;case 5:s.transform(0,1,1,0,0,0);break;case 6:s.transform(0,1,-1,0,a,0);break;case 7:s.transform(0,-1,-1,0,a,e);break;case 8:s.transform(0,-1,1,0,0,e)}s.drawImage(o,0,0),r(i.toDataURL())},o.src=e}))}(a,r).then((function(t){e(t)})).catch((function(){t()}))})).catch((function(){t()}))})).catch((function(){t()}))},r.onclick=function(){document.body.onfocus=function(){r.remove()}},document.body.appendChild(r),r.click()}))}function Z(e,t,r,n,o,a,i){var s=0,u=0;switch(e){case"left_top":s=n+a,u=o+i;break;case"left_center":s=n+a,u=r/2+i;break;case"left_bottom":s=n+a,u=r-o+i;break;case"center_top":s=t/2+a,u=o+i;break;case"center":s=t/2+a,u=r/2+i;break;case"center_bottom":s=t/2+a,u=r-o+i;break;case"right_top":s=t-n+a,u=o+i;break;case"right_center":s=t-n+a,u=r/2+i;break;case"right_bottom":s=t-n+a,u=r-o+i}return{x:s,y:u}}var q,$=(q=function(e,t){return(q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}q(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),J=function(e){function t(t){var r=e.call(this,t)||this;return r.shouldComponentUpdate=function(e){return r.props.drawings.length!==e.drawings.length&&r.renderDrawings(e.drawings),!1},r.renderDrawings=function(e){var t=r.canvas.current;if(t){var n=t.getContext("2d");if(n){var o=r.props.data.originalHeight/r.props.height;n.clearRect(0,0,t.width,t.height),n.lineCap="round",n.lineJoin="round",e.forEach((function(e){n.lineWidth=e.width*u.default.BRUSH_WIDTH_COEFFICIENT*o,n.strokeStyle=G(e.color,e.opacity),n.beginPath(),n.moveTo(e.path[0][0]*o,e.path[0][1]*o),e.path.forEach((function(e){n.lineTo(e[0]*o,e[1]*o)})),n.stroke()}))}}},r.drawStart=function(e){if(r.props.ui.currentMode===u.default.TABS.PAINT){window.addEventListener("mousemove",r.drawProcess),window.addEventListener("mouseup",r.drawFinish);var t=V(e.nativeEvent,r.canvas.current),n=t.x,o=t.y;r.currentDrawing=[[n,o]];var a=r.props.settings;r.props.addDrawing({color:a.color,width:a.brushWidth,opacity:a.brushOpacity,path:r.currentDrawing}),r.renderDrawings(r.props.drawings)}},r.drawProcess=function(e){var t=V(e,r.canvas.current),n=t.x,o=t.y;r.currentDrawing.push([n,o]),r.renderDrawings(r.props.drawings)},r.drawFinish=function(){window.removeEventListener("mousemove",r.drawProcess),window.removeEventListener("mouseup",r.drawFinish),r.currentDrawing=[]},r.canvasDoubleClick=function(){r.props.ui.currentMode!==u.default.TABS.PAINT&&r.props.addLayerText(!0,{isEdit:!0})},r.canvas=n.createRef(),r.currentDrawing=[],r}return $(t,e),t.prototype.render=function(){var e=this.props,t=e.data,r=e.width,o=e.height;return n.createElement("canvas",{ref:this.canvas,className:"EditorCanvas__canvas EditorCanvas__canvas--draw",onDoubleClick:this.canvasDoubleClick,onMouseDown:this.drawStart,width:t.originalWidth,height:t.originalHeight,style:{width:r,height:o}})},t}(n.Component),Q=Object(o.connect)((function(e){return{ui:e.ui,settings:e.settings,drawings:e.drawings,data:e.data}}),(function(e){return{addDrawing:function(t){return e(function(e){return Object(D.sendStat)(D.EVENTS.ADD_GRAFFITI),{type:"ADD_VECTOR",payload:e}}(t))},addLayerText:function(t,r){return e(I(t,r))}}}))(J),ee=new(function(){function e(){this.images={}}return e.prototype.get=function(e){var t=this;return new Promise((function(r,n){var o=t.images[e];o?r(o):z(e).then((function(n){t.setImage(e,n),r(n)})).catch(n)}))},e.prototype.setImage=function(e,t){this.images[e]=t},e}()),te=r("t7n3"),re={regular:{glsl:"// INCLUDE header.frag.glsl\n\nvoid main() {\n\tvec4 color = getColorFilter(texture2D(u_image, v_texCoord));\n\tgl_FragColor = color;\n}\n",textures:[]},nox:{glsl:"// INCLUDE header.frag.glsl\n\nuniform sampler2D u_imageTexture1; // '/images/filters/maps/nox_map.png'\n\nconst mediump vec3 luminanceWeighting = vec3(0.2125, 0.7154, 0.0721);\n\nvoid main() {\n\tvec3 texel = getColorFilter(texture2D(u_image, v_texCoord)).rgb;\n\n\tlowp float luminance = dot(texel.rgb, luminanceWeighting);\n\tlowp vec3 greyScaleColor = vec3(luminance);\n\tlowp vec4 saturatedColor = vec4(mix(greyScaleColor, texel.rgb, 0.0), 1.0);\n\n\ttexel.r = (1.0 - u_amount) * texel.r + u_amount * texture2D(u_imageTexture1, vec2(saturatedColor.r, 0.5)).r;\n\ttexel.g = (1.0 - u_amount) * texel.g + u_amount * texture2D(u_imageTexture1, vec2(saturatedColor.g, 0.5)).g;\n\ttexel.b = (1.0 - u_amount) * texel.b + u_amount * texture2D(u_imageTexture1, vec2(saturatedColor.b, 0.5)).b;\n\n\tgl_FragColor = vec4(texel, 1.0);\n}\n",textures:["/images/filters/maps/nox_map.png"]},vesper:{glsl:"// INCLUDE header.frag.glsl\n\nuniform sampler2D u_imageTexture1; // '/images/filters/maps/vesper_map.png'\nuniform sampler2D u_imageTexture2; // '/images/filters/maps/vesper_vignettemap.png'\n\nconst mediump vec3 luminanceWeighting = vec3(0.2125, 0.7154, 0.0721);\n\nvoid main() {\n\tvec3 texel = getColorFilter(texture2D(u_image, v_texCoord)).rgb;\n\tvec3 orig = texel;\n\n\tvec2 tc = (2.0 * v_texCoord) - 1.0;\n\tfloat d = dot(tc, tc);\n\tvec2 lookup = vec2(d, texel.r);\n\ttexel.r = texture2D(u_imageTexture2, lookup).r;\n\tlookup.y = texel.g;\n\ttexel.g = texture2D(u_imageTexture2, lookup).g;\n\tlookup.y = texel.b;\n\ttexel.b = texture2D(u_imageTexture2, lookup).b;\n\n\ttexel.r = texture2D(u_imageTexture1, vec2(texel.r, 0.16666)).r;\n\ttexel.g = texture2D(u_imageTexture1, vec2(texel.g, 0.5)).g;\n\ttexel.b = texture2D(u_imageTexture1, vec2(texel.b, .83333)).b;\n\n\tlowp float luminance = dot(texel.rgb, luminanceWeighting);\n\n\ttexel = mix(vec3(luminance), texel.rgb, 1.25);\n\ttexel.r = (1.0 - u_amount) * orig.r + u_amount * texel.r;\n\ttexel.g = (1.0 - u_amount) * orig.g + u_amount * texel.g;\n\ttexel.b = (1.0 - u_amount) * orig.b + u_amount * texel.b;\n\n\tgl_FragColor = vec4(texel, 1.0);\n}\n",textures:["/images/filters/maps/vesper_map.png","/images/filters/maps/vesper_vignettemap.png"]},latona:{glsl:"// INCLUDE header.frag.glsl\n\nuniform sampler2D u_imageTexture1; // '/images/filters/maps/latona_map.png'\nuniform sampler2D u_imageTexture2; // '/images/filters/maps/latona_softlight.png'\nuniform sampler2D u_imageTexture3; // '/images/filters/maps/latona_curves.png'\n\nvoid main() {\n\tvec3 texel = getColorFilter(texture2D(u_image, v_texCoord)).rgb;\n\tvec3 orig = texel;\n\n\tvec2 tc = (2.0 * v_texCoord) - 1.0;\n\tfloat d = dot(tc, tc);\n\tvec2 lookup = vec2(d, texel.r);\n\ttexel.r = texture2D(u_imageTexture1, lookup).r;\n\tlookup.y = texel.g;\n\ttexel.g = texture2D(u_imageTexture1, lookup).g;\n\tlookup.y = texel.b;\n\ttexel.b  = texture2D(u_imageTexture1, lookup).b;\n\n\tvec3 rgbPrime = vec3(0.1019, 0.0, 0.0);\n\tfloat m = dot(vec3(.3, .59, .11), texel.rgb) - 0.03058;\n\ttexel = mix(texel, rgbPrime + m, 0.32);\n\n\ttexel.r = texture2D(u_imageTexture3, vec2(texel.r, .16666)).r;\n\ttexel.g = texture2D(u_imageTexture3, vec2(texel.g, .5)).g;\n\ttexel.b = texture2D(u_imageTexture3, vec2(texel.b, .83333)).b;\n\n\ttexel.r = (1.0 - u_amount) * orig.r + u_amount * texel.r;\n\ttexel.g = (1.0 - u_amount) * orig.g + u_amount * texel.g;\n\ttexel.b = (1.0 - u_amount) * orig.b + u_amount * texel.b;\n\n\tgl_FragColor = vec4(texel, 1.0);\n}\n",textures:["/images/filters/maps/latona_map.png","/images/filters/maps/latona_softlight.png","/images/filters/maps/latona_curves.png"]},liber:{glsl:"// INCLUDE header.frag.glsl\n\nuniform sampler2D u_imageTexture1; // '/images/filters/maps/liber_map.png'\nuniform sampler2D u_imageTexture2; // '/images/filters/maps/liber_vignettemap.png'\n\nconst mediump vec3 luminanceWeighting = vec3(0.2125, 0.7154, 0.0721);\n\nvoid main() {\n\tvec3 texel = getColorFilter(texture2D(u_image, v_texCoord)).rgb;\n\tvec3 orig = texel;\n\n\tvec2 tc = (2.0 * v_texCoord) - 1.0;\n\tfloat d = dot(tc, tc);\n\tvec2 lookup = vec2(d, texel.r);\n\ttexel.r = texture2D(u_imageTexture2, lookup).r;\n\tlookup.y = texel.g;\n\ttexel.g = texture2D(u_imageTexture2, lookup).g;\n\tlookup.y = texel.b;\n\ttexel.b  = texture2D(u_imageTexture2, lookup).b;\n\n\tvec2 red = vec2(texel.r, 0.16666);\n\tvec2 green = vec2(texel.g, 0.5);\n\tvec2 blue = vec2(texel.b, .83333);\n\n\ttexel.r = texture2D(u_imageTexture1, red).r;\n\ttexel.g = texture2D(u_imageTexture1, green).g;\n\ttexel.b = texture2D(u_imageTexture1, blue).b;\n\n\ttexel.r = (1.0 - u_amount) * orig.r + u_amount * texel.r;\n\ttexel.g = (1.0 - u_amount) * orig.g + u_amount * texel.g;\n\ttexel.b = (1.0 - u_amount) * orig.b + u_amount * texel.b;\n\n\tgl_FragColor = vec4(texel, 1.0);\n}\n",textures:["/images/filters/maps/liber_map.png","/images/filters/maps/liber_vignettemap.png"]},luna:{glsl:"// INCLUDE header.frag.glsl\n\nconst mediump vec3 luminanceWeighting = vec3(0.2125, 0.7154, 0.0721);\nconst lowp vec3 base = vec3(220.0/255.0, 225.0/255.0, 95.0/255.0);\n\nvoid main() {\n\tlowp vec4 textureColor = getColorFilter(texture2D(u_image, v_texCoord));\n\tlowp float luminance = dot(textureColor.rgb, luminanceWeighting);\n\tlowp vec3 greyScaleColor = vec3(luminance);\n\n\tmediump vec3 res1 = vec3(mix(greyScaleColor, textureColor.rgb, 0.486590027809143));\n\tres1 = vec3(((res1.rgb - vec3(0.5)) * 1.51111116409302 + vec3(0.5)));\n\tres1 = vec3(res1.r, res1.g, res1.b * 1.6513409614563);\n\tres1 = mix(res1, res1 * base , 0.335249036550522);\n\n\tlowp vec3 rgb = res1;\n\tlowp float d = distance(v_texCoord, vec2(0.5,0.5));\n\trgb *= smoothstep(0.95, 0.1, d);\n\n\trgb.r = (1.0 - u_amount) * textureColor.r + u_amount * rgb.r;\n\trgb.g = (1.0 - u_amount) * textureColor.g + u_amount * rgb.g;\n\trgb.b = (1.0 - u_amount) * textureColor.b + u_amount * rgb.b;\n\n\tgl_FragColor = vec4(vec3(rgb),1.0);\n}\n",textures:[]},minerva:{glsl:"// INCLUDE header.frag.glsl\n\nuniform sampler2D u_imageTexture1; // '/images/filters/maps/minerva_map.png'\nuniform sampler2D u_imageTexture2; // '/images/filters/maps/minerva_gradient_map.png'\nuniform sampler2D u_imageTexture3; // '/images/filters/maps/minerva_softlight.png'\nuniform sampler2D u_imageTexture4; // '/images/filters/maps/filter_metal1.jpg'\n\nvoid main() {\n\tvec3 texel = getColorFilter(texture2D(u_image, v_texCoord)).rgb;\n\tvec3 orig = texel;\n\n\ttexel = vec3(\n\t\ttexture2D(u_imageTexture1, vec2(texel.r, .16666)).r,\n\t\ttexture2D(u_imageTexture1, vec2(texel.g, .5)).g,\n\t\ttexture2D(u_imageTexture1, vec2(texel.b, .83333)).b\n\t);\n\n\tvec3 luma = vec3(.30, .59, .11);\n\tvec3 gradSample = texture2D(u_imageTexture2, vec2(dot(luma, texel), .5)).rgb;\n\tvec3 final = vec3(\n\t\ttexture2D(u_imageTexture3, vec2(gradSample.r, texel.r)).r,\n\t\ttexture2D(u_imageTexture3, vec2(gradSample.g, texel.g)).g,\n\t\ttexture2D(u_imageTexture3, vec2(gradSample.b, texel.b)).b\n\t);\n\n\tvec3 metal = texture2D(u_imageTexture4, v_texCoord).rgb;\n\tvec3 metaled = vec3(\n\t\ttexture2D(u_imageTexture3, vec2(metal.r, texel.r)).r,\n\t\ttexture2D(u_imageTexture3, vec2(metal.g, texel.g)).g,\n\t\ttexture2D(u_imageTexture3, vec2(metal.b, texel.b)).b\n\t);\n\n\tmetaled.r = (1.0 - u_amount) * orig.r + u_amount * metaled.r;\n\tmetaled.g = (1.0 - u_amount) * orig.g + u_amount * metaled.g;\n\tmetaled.b = (1.0 - u_amount) * orig.b + u_amount * metaled.b;\n\n\tgl_FragColor = vec4(metaled, 1.0);\n}\n",textures:["/images/filters/maps/minerva_map.png","/images/filters/maps/minerva_gradient_map.png","/images/filters/maps/minerva_softlight.png","/images/filters/maps/filter_metal1.jpg"]},mitra:{glsl:"// INCLUDE header.frag.glsl\n\nuniform sampler2D u_imageTexture1; // '/images/filters/maps/filter_blackboard1.jpg'\nuniform sampler2D u_imageTexture2; // '/images/filters/maps/mitra_overlaymap.png'\nuniform sampler2D u_imageTexture3; // '/images/filters/maps/mitra_map.png'\nuniform sampler2D u_imageTexture4; // '/images/filters/maps/mitra_map2.png'\n\nconst mediump vec3 luminanceWeighting = vec3(0.2125, 0.7154, 0.0721);\n\nvoid main() {\n\tvec4 texel = getColorFilter(texture2D(u_image, v_texCoord));\n\tvec4 orig = texel;\n\tvec3 bbTexel = texture2D(u_imageTexture1, v_texCoord).rgb;\n\n\ttexel.r = texture2D(u_imageTexture2, vec2(bbTexel.r, texel.r)).r;\n\ttexel.g = texture2D(u_imageTexture2, vec2(bbTexel.g, texel.g)).g;\n\ttexel.b = texture2D(u_imageTexture2, vec2(bbTexel.b, texel.b)).b;\n\n\tvec4 mapped;\n\tmapped.r = texture2D(u_imageTexture3, vec2(texel.r, .16666)).r;\n\tmapped.g = texture2D(u_imageTexture3, vec2(texel.g, .5)).g;\n\tmapped.b = texture2D(u_imageTexture3, vec2(texel.b, .83333)).b;\n\tmapped.a = 1.0;\n\n\tlowp float luminance = dot(mapped.rgb, luminanceWeighting);\n\tlowp vec3 greyScaleColor = vec3(luminance);\n\tmapped = vec4(mix(greyScaleColor, mapped.rgb, 0.65), 1.0);\n\n\tmapped.r = texture2D(u_imageTexture4, vec2(mapped.r, 0.5)).r;\n\tmapped.g = texture2D(u_imageTexture4, vec2(mapped.g, 0.5)).g;\n\tmapped.b = texture2D(u_imageTexture4, vec2(mapped.b, 0.5)).b;\n\n\tmapped.r = (1.0 - u_amount) * orig.r + u_amount * mapped.r;\n\tmapped.g = (1.0 - u_amount) * orig.g + u_amount * mapped.g;\n\tmapped.b = (1.0 - u_amount) * orig.b + u_amount * mapped.b;\n\n\tgl_FragColor = mapped;\n}\n",textures:["/images/filters/maps/filter_blackboard1.jpg","/images/filters/maps/mitra_overlaymap.png","/images/filters/maps/mitra_map.png","/images/filters/maps/mitra_map2.png"]},pro:{glsl:"// INCLUDE header.frag.glsl\n\nuniform sampler2D u_imageTexture1; // '/images/filters/maps/filter_blackboard1.jpg'\nuniform sampler2D u_imageTexture2; // '/images/filters/maps/pro_overlaymap.png'\nuniform sampler2D u_imageTexture3; // '/images/filters/maps/pro_map.png'\n\nvoid main() {\n\tvec4 texel = getColorFilter(texture2D(u_image, v_texCoord));\n\tvec4 orig = texel;\n\tvec3 bbTexel = texture2D(u_imageTexture1, v_texCoord).rgb;\n\n\ttexel.r = texture2D(u_imageTexture2, vec2(bbTexel.r, texel.r)).r;\n\ttexel.g = texture2D(u_imageTexture2, vec2(bbTexel.g, texel.g)).g;\n\ttexel.b = texture2D(u_imageTexture2, vec2(bbTexel.b, texel.b)).b;\n\n\tvec4 mapped;\n\tmapped.r = texture2D(u_imageTexture3, vec2(texel.r, .16666)).r;\n\tmapped.g = texture2D(u_imageTexture3, vec2(texel.g, .5)).g;\n\tmapped.b = texture2D(u_imageTexture3, vec2(texel.b, .83333)).b;\n\tmapped.a = 1.0;\n\n\tmapped.r = (1.0 - u_amount) * orig.r + u_amount * mapped.r;\n\tmapped.g = (1.0 - u_amount) * orig.g + u_amount * mapped.g;\n\tmapped.b = (1.0 - u_amount) * orig.b + u_amount * mapped.b;\n\n\tgl_FragColor = mapped;\n}\n",textures:["/images/filters/maps/filter_blackboard1.jpg","/images/filters/maps/pro_overlaymap.png","/images/filters/maps/pro_map.png"]},terra:{glsl:"// INCLUDE header.frag.glsl\n\nuniform sampler2D u_imageTexture1; // '/images/filters/maps/terra_map.png'\n\nvoid main() {\n\tvec3 texel = getColorFilter(texture2D(u_image, v_texCoord)).rgb;\n\tvec3 orig = texel;\n\ttexel = vec3(\n\ttexture2D(u_imageTexture1, vec2(texel.r, .16666)).r,\n\ttexture2D(u_imageTexture1, vec2(texel.g, .5)).g,\n\ttexture2D(u_imageTexture1, vec2(texel.b, .83333)).b);\n\n\tlowp vec4 mapped = vec4(texel, 1.0);\n\tmapped.r = (1.0 - u_amount) * orig.r + u_amount * mapped.r;\n\tmapped.g = (1.0 - u_amount) * orig.g + u_amount * mapped.g;\n\tmapped.b = (1.0 - u_amount) * orig.b + u_amount * mapped.b;\n\n\tgl_FragColor = mapped;\n}\n",textures:["/images/filters/maps/terra_map.png"]},veles:{glsl:"// INCLUDE header.frag.glsl\n\nuniform sampler2D u_imageTexture1; // '/images/filters/maps/veles_background.jpg'\nuniform sampler2D u_imageTexture2; // '/images/filters/maps/veles_overlay.png'\nuniform sampler2D u_imageTexture3; // '/images/filters/maps/veles_map.png'\n\nvoid main() {\n\tvec4 texel = getColorFilter(texture2D(u_image, v_texCoord));\n\tvec4 orig = texel;\n\n\tvec3 bbTexel = texture2D(u_imageTexture1, v_texCoord).rgb;\n\n\ttexel.r = texture2D(u_imageTexture2, vec2(bbTexel.r, texel.r)).r;\n\ttexel.g = texture2D(u_imageTexture2, vec2(bbTexel.g, texel.g)).g;\n\ttexel.b = texture2D(u_imageTexture2, vec2(bbTexel.b, texel.b)).b;\n\n\tvec3 mapped;\n\tmapped.r = texture2D(u_imageTexture3, vec2(texel.r, .16666)).r;\n\tmapped.g = texture2D(u_imageTexture3, vec2(texel.g, .5)).g;\n\tmapped.b = texture2D(u_imageTexture3, vec2(texel.b, .83333)).b;\n\n\tmapped.r = (1.0 - u_amount) * orig.r + u_amount * mapped.r;\n\tmapped.g = (1.0 - u_amount) * orig.g + u_amount * mapped.g;\n\tmapped.b = (1.0 - u_amount) * orig.b + u_amount * mapped.b;\n\n\tgl_FragColor = vec4(mapped, 1.0);\n}\n",textures:["/images/filters/maps/veles_background.jpg","/images/filters/maps/veles_overlay.png","/images/filters/maps/veles_map.png"]},vesta:{glsl:"// INCLUDE header.frag.glsl\n\nuniform sampler2D u_imageTexture1; // '/images/filters/maps/vesta_overlay.png'\nuniform sampler2D u_imageTexture2; // '/images/filters/maps/vesta_softlight.png'\nuniform sampler2D u_imageTexture3; // '/images/filters/maps/vesta_curves.png'\nuniform sampler2D u_imageTexture4; // '/images/filters/maps/vesta_overlaymapwarm.png'\nuniform sampler2D u_imageTexture5; // '/images/filters/maps/vesta_colorshift.png'\n\nvoid main() {\n\tlowp vec3 texel;\n\tmediump vec2 lookup;\n\n\tvec2 blue;\n\tvec2 green;\n\tvec2 red;\n\n\tlowp vec4 tmpvar_1;\n\ttmpvar_1 = getColorFilter(texture2D(u_image, v_texCoord));\n\ttexel = tmpvar_1.xyz;\n\n\tlowp vec4 tmpvar_2;\n\ttmpvar_2 = texture2D (u_imageTexture1, v_texCoord);\n\n\tlowp vec2 tmpvar_3;\n\ttmpvar_3.x = tmpvar_2.x;\n\ttmpvar_3.y = tmpvar_1.x;\n\ttexel.x = texture2D (u_imageTexture2, tmpvar_3).x;\n\n\tlowp vec2 tmpvar_4;\n\ttmpvar_4.x = tmpvar_2.y;\n\ttmpvar_4.y = tmpvar_1.y;\n\ttexel.y = texture2D (u_imageTexture2, tmpvar_4).y;\n\n\tlowp vec2 tmpvar_5;\n\ttmpvar_5.x = tmpvar_2.z;\n\ttmpvar_5.y = tmpvar_1.z;\n\ttexel.z = texture2D (u_imageTexture2, tmpvar_5).z;\n\tred.x = texel.x;\n\tred.y = 0.16666;\n\tgreen.x = texel.y;\n\tgreen.y = 0.5;\n\tblue.x = texel.z;\n\tblue.y = 0.833333;\n\ttexel.x = texture2D (u_imageTexture3, red).x;\n\ttexel.y = texture2D (u_imageTexture3, green).y;\n\ttexel.z = texture2D (u_imageTexture3, blue).z;\n\n\tmediump vec2 tmpvar_6;\n\ttmpvar_6 = ((2.0 * v_texCoord) - 1.0);\n\n\tmediump vec2 tmpvar_7;\n\ttmpvar_7.x = dot (tmpvar_6, tmpvar_6);\n\ttmpvar_7.y = texel.x;\n\tlookup = tmpvar_7;\n\ttexel.x = texture2D (u_imageTexture4, tmpvar_7).x;\n\tlookup.y = texel.y;\n\ttexel.y = texture2D (u_imageTexture4, lookup).y;\n\tlookup.y = texel.z;\n\ttexel.z = texture2D (u_imageTexture4, lookup).z;\n\tred.x = texel.x;\n\tgreen.x = texel.y;\n\tblue.x = texel.z;\n\ttexel.x = texture2D (u_imageTexture5, red).x;\n\ttexel.y = texture2D (u_imageTexture5, green).y;\n\ttexel.z = texture2D (u_imageTexture5, blue).z;\n\n\tlowp vec4 tmpvar_8;\n\ttmpvar_8.w = 1.0;\n\ttmpvar_8.xyz = texel;\n\ttmpvar_8.r = (1.0 - u_amount) * tmpvar_1.r + u_amount * tmpvar_8.r;\n\ttmpvar_8.g = (1.0 - u_amount) * tmpvar_1.g + u_amount * tmpvar_8.g;\n\ttmpvar_8.b = (1.0 - u_amount) * tmpvar_1.b + u_amount * tmpvar_8.b;\n\n\tgl_FragColor = tmpvar_8;\n}\n",textures:["/images/filters/maps/vesta_overlay.png","/images/filters/maps/vesta_softlight.png","/images/filters/maps/vesta_curves.png","/images/filters/maps/vesta_overlaymapwarm.png","/images/filters/maps/vesta_colorshift.png"]},zaria:{glsl:"// INCLUDE header.frag.glsl\n\nuniform sampler2D u_imageTexture1; // '/images/filters/maps/zaria_map.png'\n\nvoid main() {\n\tvec4 texel = getColorFilter(texture2D(u_image, v_texCoord));\n\n\tvec4 mapped;\n\tmapped.r = texture2D(u_imageTexture1, vec2(texel.r, .16666)).r;\n\tmapped.g = texture2D(u_imageTexture1, vec2(texel.g, .5)).g;\n\tmapped.b = texture2D(u_imageTexture1, vec2(texel.b, .83333)).b;\n\tmapped.r = (1.0 - u_amount) * texel.r + u_amount * mapped.r;\n\tmapped.g = (1.0 - u_amount) * texel.g + u_amount * mapped.g;\n\tmapped.b = (1.0 - u_amount) * texel.b + u_amount * mapped.b;\n\tmapped.a = 1.0;\n\n\tgl_FragColor = mapped;\n}\n",textures:["/images/filters/maps/zaria_map.png"]},sepia:{glsl:"// INCLUDE header.frag.glsl\n\nvoid main() {\n\tvec4 color = getColorFilter(texture2D(u_image, v_texCoord));\n\tfloat r = color.r;\n\tfloat g = color.g;\n\tfloat b = color.b;\n\n\tcolor.r = min(1.0, (r * (1.0 - (0.607 * u_amount))) + (g * (0.769 * u_amount)) + (b * (0.189 * u_amount)));\n\tcolor.g = min(1.0, (r * 0.349 * u_amount) + (g * (1.0 - (0.314 * u_amount))) + (b * 0.168 * u_amount));\n\tcolor.b = min(1.0, (r * 0.272 * u_amount) + (g * 0.534 * u_amount) + (b * (1.0 - (0.869 * u_amount))));\n\n\tgl_FragColor = color;\n}\n",textures:[]},genius:{glsl:"// INCLUDE header.frag.glsl\n\nuniform sampler2D u_imageTexture1; // '/images/filters/maps/genius_map.png'\nuniform sampler2D u_imageTexture2; // '/images/filters/maps/genius_metal.jpg'\nuniform sampler2D u_imageTexture3; // '/images/filters/maps/genius_softlight.png'\nuniform sampler2D u_imageTexture4; // '/images/filters/maps/genius_curves.png'\n\nvoid main() {\n\tvec3 texel_orig = getColorFilter(texture2D(u_image, v_texCoord)).rgb;\n\tvec3 texel = texel_orig;\n\n\tvec2 tc = (2.0 * v_texCoord) - 1.0;\n\tfloat d = dot(tc, tc);\n\tvec2 lookup = vec2(d, texel.r);\n\n\ttexel.r = texture2D(u_imageTexture1, lookup).r;\n\tlookup.y = texel.g;\n\n\ttexel.g = texture2D(u_imageTexture1, lookup).g;\n\tlookup.y = texel.b;\n\n\ttexel.b  = texture2D(u_imageTexture1, lookup).b;\n\n\tvec3 rgbPrime = vec3(0.1019, 0.0, 0.0);\n\tfloat m = dot(vec3(.3, .59, .11), texel.rgb) - 0.03058;\n\ttexel = mix(texel, rgbPrime + m, 0.32);\n\n\tvec3 metal = texture2D(u_imageTexture2, v_texCoord).rgb;\n\ttexel.r = texture2D(u_imageTexture3, vec2(metal.r, texel.r)).r;\n\ttexel.g = texture2D(u_imageTexture3, vec2(metal.g, texel.g)).g;\n\ttexel.b = texture2D(u_imageTexture3, vec2(metal.b, texel.b)).b;\n\n\ttexel.r = (1.0 - u_amount) * texel_orig.r + u_amount * texture2D(u_imageTexture4, vec2(texel.r, .16666)).r;\n\ttexel.g = (1.0 - u_amount) * texel_orig.g + u_amount * texture2D(u_imageTexture4, vec2(texel.g, .5)).g;\n\ttexel.b = (1.0 - u_amount) * texel_orig.b + u_amount * texture2D(u_imageTexture4, vec2(texel.b, .83333)).b;\n\n\tgl_FragColor = vec4(texel, 1.0);\n}\n",textures:["/images/filters/maps/genius_map.png","/images/filters/maps/genius_metal.jpg","/images/filters/maps/genius_softlight.png","/images/filters/maps/genius_curves.png"]},horus:{glsl:"// INCLUDE header.frag.glsl\n\nuniform sampler2D u_imageTexture1; // '/images/filters/maps/filter_metal1.jpg'\nuniform sampler2D u_imageTexture2; // '/images/filters/maps/horus_overlaymap.png'\nuniform sampler2D u_imageTexture3; // '/images/filters/maps/horus_map.png'\n\nvoid main() {\n\tvec4 texel = getColorFilter(texture2D(u_image, v_texCoord));\n\tvec4 orig = texel;\n\tvec3 bbTexel = texture2D(u_imageTexture1, v_texCoord).rgb;\n\n\ttexel.r = texture2D(u_imageTexture2, vec2(bbTexel.r, texel.r)).r;\n\ttexel.g = texture2D(u_imageTexture2, vec2(bbTexel.g, texel.g)).g;\n\ttexel.b = texture2D(u_imageTexture2, vec2(bbTexel.b, texel.b)).b;\n\n\tvec4 mapped;\n\tmapped.r = texture2D(u_imageTexture3, vec2(texel.r, .16666)).r;\n\tmapped.g = texture2D(u_imageTexture3, vec2(texel.g, .5)).g;\n\tmapped.b = texture2D(u_imageTexture3, vec2(texel.b, .83333)).b;\n\tmapped.a = 1.0;\n\tmapped.r = (1.0 - u_amount) * orig.r + u_amount * mapped.r;\n\tmapped.g = (1.0 - u_amount) * orig.g + u_amount * mapped.g;\n\tmapped.b = (1.0 - u_amount) * orig.b + u_amount * mapped.b;\n\n\tgl_FragColor = mapped;\n}\n",textures:["/images/filters/maps/filter_metal1.jpg","/images/filters/maps/horus_overlaymap.png","/images/filters/maps/horus_map.png"]},fortuna:{glsl:"// INCLUDE header.frag.glsl\n\nuniform sampler2D u_imageTexture1; // '/images/filters/maps/map.png'\nuniform sampler2D u_imageTexture2; // '/images/filters/maps/gradientmap.png'\nuniform sampler2D u_imageTexture3; // '/images/filters/maps/softlight.png'\n\nvoid main() {\n\tvec3 texel = getColorFilter(texture2D(u_image, v_texCoord)).rgb;\n\n\tvec3 texel2 = vec3(\n\t\ttexture2D(u_imageTexture1, vec2(texel.r, .16666)).r,\n\t\ttexture2D(u_imageTexture1, vec2(texel.g, .5)).g,\n\t\ttexture2D(u_imageTexture1, vec2(texel.b, .83333)).b\n\t);\n\n\tvec3 luma = vec3(.30, .59, .11);\n\tvec3 gradSample = texture2D(u_imageTexture2, vec2(dot(luma, texel2), .5)).rgb;\n\n\tvec3 final = vec3(\n\t\t(1.0 - u_amount) * texel.r + u_amount * texture2D(u_imageTexture3, vec2(gradSample.r, texel2.r)).r,\n\t\t(1.0 - u_amount) * texel.g + u_amount * texture2D(u_imageTexture3, vec2(gradSample.g, texel2.g)).g,\n\t\t(1.0 - u_amount) * texel.b + u_amount * texture2D(u_imageTexture3, vec2(gradSample.b, texel2.b)).b\n\t);\n\n\tgl_FragColor = vec4(final, 1.0);\n}\n",textures:["/images/filters/maps/map.png","/images/filters/maps/gradientmap.png","/images/filters/maps/softlight.png"]}};var ne=document.createElement("canvas"),oe=ne.getContext("webgl"),ae={},ie=function(){function e(e){this.canvas=ne,this.gl=oe;var t=function(e){var t,r=re[e];if(r)return{glsl:(t=r.glsl,"precision mediump float;\n\n// global\nvarying vec2 v_texCoord;\nuniform sampler2D u_image;\n\n// color correction\nuniform float u_exposure;\nuniform float u_brightness;\nuniform float u_contrast;\nuniform float u_saturation;\nuniform float u_vignette;\nuniform float u_sharpness;\nuniform float u_warmth;\nuniform vec2 sourceSize;\n\n// filters\nuniform float u_amount;\n\n// #include filters.frag.glsl\n// value [0; 1.0]\nvec3 getSharpness(float value) {\n  vec2 off = sourceSize * 10. * value;\n  vec2 off2 = off * 2.0;\n\n  // Why isn't this a loop? Some graphics chips can get be very slow if they\n  // can't tell at compile time which texture reads are needed\n  vec4 tex00 = texture2D(u_image, v_texCoord + vec2(-off2.x, -off2.y));\n  vec4 tex10 = texture2D(u_image, v_texCoord + vec2(-off.x, -off2.y));\n  vec4 tex20 = texture2D(u_image, v_texCoord + vec2(0.0, -off2.y));\n  vec4 tex30 = texture2D(u_image, v_texCoord + vec2(off.x, -off2.y));\n  vec4 tex40 = texture2D(u_image, v_texCoord + vec2(off2.x, -off2.y));\n\n  vec4 tex01 = texture2D(u_image, v_texCoord + vec2(-off2.x, -off.y));\n  vec4 tex11 = texture2D(u_image, v_texCoord + vec2(-off.x, -off.y));\n  vec4 tex21 = texture2D(u_image, v_texCoord + vec2(0.0, -off.y));\n  vec4 tex31 = texture2D(u_image, v_texCoord + vec2(off.x, -off.y));\n  vec4 tex41 = texture2D(u_image, v_texCoord + vec2(off2.x, -off.y));\n\n  vec4 tex02 = texture2D(u_image, v_texCoord + vec2(-off2.x, 0.0));\n  vec4 tex12 = texture2D(u_image, v_texCoord + vec2(-off.x, 0.0));\n  vec4 tex22 = texture2D(u_image, v_texCoord + vec2(0.0, 0.0));\n  vec4 tex32 = texture2D(u_image, v_texCoord + vec2(off.x, 0.0));\n  vec4 tex42 = texture2D(u_image, v_texCoord + vec2(off2.x, 0.0));\n\n  vec4 tex03 = texture2D(u_image, v_texCoord + vec2(-off2.x, off.y));\n  vec4 tex13 = texture2D(u_image, v_texCoord + vec2(-off.x, off.y));\n  vec4 tex23 = texture2D(u_image, v_texCoord + vec2(0.0, off.y));\n  vec4 tex33 = texture2D(u_image, v_texCoord + vec2(off.x, off.y));\n  vec4 tex43 = texture2D(u_image, v_texCoord + vec2(off2.x, off.y));\n\n  vec4 tex04 = texture2D(u_image, v_texCoord + vec2(-off2.x, off2.y));\n  vec4 tex14 = texture2D(u_image, v_texCoord + vec2(-off.x, off2.y));\n  vec4 tex24 = texture2D(u_image, v_texCoord + vec2(0.0, off2.y));\n  vec4 tex34 = texture2D(u_image, v_texCoord + vec2(off.x, off2.y));\n  vec4 tex44 = texture2D(u_image, v_texCoord + vec2(off2.x, off2.y));\n\n  vec4 tex = tex22;\n\n  vec4 blurred = 1.0 * tex00 + 4.0 * tex10 + 6.0 * tex20 + 4.0 * tex30 + 1.0 * tex40\n  + 4.0 * tex01 + 16.0 * tex11 + 24.0 * tex21 + 16.0 * tex31 + 4.0 * tex41\n  + 6.0 * tex02 + 24.0 * tex12 + 36.0 * tex22 + 24.0 * tex32 + 6.0 * tex42\n  + 4.0 * tex03 + 16.0 * tex13 + 24.0 * tex23 + 16.0 * tex33 + 4.0 * tex43\n  + 1.0 * tex04 + 4.0 * tex14 + 6.0 * tex24 + 4.0 * tex34 + 1.0 * tex44;\n  blurred /= 256.0;\n\n  tex += (tex - blurred) * value;\n  return tex.rgb;\n}\n\n// value[-1; 1]\nvec3 getExposure(vec3 color, float value) {\n  return color.rgb * pow(2.0, value);\n}\n\n// value[-0.5; 0.5]\nvec3 getBrightness(vec3 color, float value) {\n  return color.rgb += value;\n}\n\n// value[-0.5; 0.5]\n// https://www.w3.org/TR/filter-effects-1/#contrastEquivalent\nvec3 getContrast(vec3 color, float value) {\n  if (value > 0.0) {\n    color.rgb = (color.rgb - 0.5) / (1.0 - value) + 0.5;\n  } else {\n    color.rgb = (color.rgb - 0.5) * (1.0 + value) + 0.5;\n  }\n\n  return color.rgb;\n}\n\n// value[-1; 0.8]\nvec3 getSaturation(vec3 color, float value) {\n  float average = (color.r + color.g + color.b) / 3.0;\n  if (value > 0.0) {\n    color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - value));\n  } else {\n    color.rgb += (average - color.rgb) * (-value);\n  }\n\n  return color.rgb;\n}\n\n// value [0; 1.0]\nvec3 getVignette(vec3 color, float value) {\n  float dist = distance(v_texCoord, vec2(0.5, 0.5));\n  float size = 0.5 - value * 0.4;\n  float amount = value * value * 0.1 + 0.5 * value;\n  float vignette = smoothstep(0.8, size * 0.799, dist * (amount + size));\n  return color.rgb * vignette;\n}\n\n// value [-0.5; 0.5]\nvec3 getWarmth(vec3 color, float value) {\n  color.r += value;\n  color.b -= value;\n  return color.rgb;\n}\n\nvec4 getColorFilter(vec4 color) {\n  // Set sharpen\n  color.rgb = getSharpness(u_sharpness);\n\n  // Set exposure\n  color.rgb = getExposure(color.rgb, u_exposure);\n\n  // Set brightness\n  color.rgb = getBrightness(color.rgb, u_brightness);\n\n  // Set contrast\n  color.rgb = getContrast(color.rgb, u_contrast);\n\n  // Set satiration\n  color.rgb = getSaturation(color.rgb, u_saturation);\n\n  // Set warmth\n  color.rgb = getWarmth(color.rgb, u_warmth);\n\n  // Set vignette\n  color.rgb = getVignette(color.rgb, u_vignette);\n\n  return color;\n}\n"+t),textures:r.textures}}(e);t&&(this.program=this.createProgramFromTextShader("attribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform vec2 u_resolution;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\t// convert the rectangle from pixels to 0.0 to 1.0\n\tvec2 zeroToOne = a_position / u_resolution;\n\n\t// convert from 0->1 to 0->2\n\tvec2 zeroToTwo = zeroToOne * 2.0;\n\n\t// convert from 0->2 to -1->+1 (clipspace)\n\tvec2 clipSpace = zeroToTwo - 1.0;\n\n\tgl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n\n\t// pass the texCoord to the fragment shader\n\t// The GPU will interpolate this value between points.\n\tv_texCoord = a_texCoord;\n}\n",t.glsl),this.textures=t.textures,this.textureInstans=[])}return e.prototype.compileShader=function(e,t){if(!this.gl)return null;var r=this.gl.createShader(t);return r?(this.gl.shaderSource(r,e),this.gl.compileShader(r),this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)?r:(console.error(new Error(""+this.gl.getShaderInfoLog(r))),null)):null},e.prototype.createProgram=function(e,t){if(!this.gl)return null;var r=this.gl.createProgram();return r?(this.gl.attachShader(r,e),this.gl.attachShader(r,t),this.gl.linkProgram(r),this.gl.getProgramParameter(r,this.gl.LINK_STATUS)?r:(console.error(new Error(""+this.gl.getProgramInfoLog(r))),null)):null},e.prototype.createProgramFromTextShader=function(e,t){if(!this.gl)return null;var r=this.compileShader(e,this.gl.VERTEX_SHADER);if(!r)return null;var n=this.compileShader(t,this.gl.FRAGMENT_SHADER);return n?this.createProgram(r,n):null},e.prototype.prepare=function(e){var t=this,r=this.textures.map((function(e){return ee.get(e)}));return Promise.all(r).then((function(r){if(t.gl&&t.program){t.canvas.width=e.width,t.canvas.height=e.height,t.gl.useProgram(t.program),t.gl.viewport(0,0,t.gl.drawingBufferWidth,t.gl.drawingBufferHeight),t.gl.clearColor(0,0,0,0),t.gl.clear(t.gl.COLOR_BUFFER_BIT);var n=e.width,o=e.height;t.setVertexAttribute("a_position",[0,0,n,0,0,o,0,o,n,0,n,o]),t.setVertexAttribute("a_texCoord",[0,0,1,0,0,1,0,1,1,0,1,1]);var a=t.gl.getUniformLocation(t.program,"u_resolution");t.gl.uniform2f(a,t.gl.canvas.width,t.gl.canvas.height);for(var i=0;i<r.length;i++)t.textureInstans.push(t.createTexture(r[i])),t.gl.uniform1i(t.gl.getUniformLocation(t.program,"u_imageTexture"+(i+1)),i+1);t.bg=t.createTexture(e),t.gl.uniform1i(t.gl.getUniformLocation(t.program,"u_image"),0)}})).catch((function(e){console.error(e)}))},e.prototype.render=function(e){if(this.gl){this.gl.useProgram(this.program),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.bg);for(var t=0;t<this.textures.length;t++){var r=this.textureInstans[t];this.gl.activeTexture(this.gl.TEXTURE0+(t+1)),this.gl.bindTexture(this.gl.TEXTURE_2D,r)}return this.setUniformData(e),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.canvas}},e.prototype.setVertexAttribute=function(e,t){if(this.gl&&this.program){var r=this.gl.getAttribLocation(this.program,e),n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(r),this.gl.vertexAttribPointer(r,2,this.gl.FLOAT,!1,0,0)}},e.prototype.createTexture=function(e){if(!this.gl)return null;if(ae[e.src])return ae[e.src];var t=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),t&&(ae[e.src]=t),t},e.prototype.setUniformData=function(e){var t=this.gl;if(t&&this.program)for(var r in e)if(e.hasOwnProperty(r)){var n=t.getUniformLocation(this.program,r),o=e[r];if(Array.isArray(o))switch(o.length){case 1:t.uniform1fv(n,new Float32Array(o));break;case 2:t.uniform2fv(n,new Float32Array(o));break;case 3:t.uniform3fv(n,new Float32Array(o));break;case 4:t.uniform4fv(n,new Float32Array(o));break;case 9:t.uniformMatrix3fv(n,!1,new Float32Array(o));break;case 16:t.uniformMatrix4fv(n,!1,new Float32Array(o))}else Object(te.isNumber)(o)&&t.uniform1f(n,o)}},e}(),se=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ue=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},ce=function(e){function t(t){var r=e.call(this,t)||this;return r.shouldComponentUpdate=function(e){var t=r.props,n=t.background,o=t.settings,a=JSON.stringify(n)!==JSON.stringify(e.background),i=JSON.stringify(o.colorCorrection)!==JSON.stringify(e.settings.colorCorrection),s=o.filter.name!==e.settings.filter.name,u=o.filter.value!==e.settings.filter.value;return s&&(r.filtersRenderer=new ie(e.settings.filter.name)),(a||s)&&(r.isPrepared=!1),(a||i||s||u)&&r.update(e),!1},r.getBackgroundById=function(e){var t=r.props.data.backgrounds,n=t.gradients,o=t.emojies;return ue(n,o).filter((function(t){return t.id===e}))[0]},r.getCurrentImageUrl=function(e){var t,n=e||r.props.background,o=n.currentBackgroundType,a=n.currentPhotoUrl,i=n.currentBackgroundId;o===u.default.BACKGROUND_MODES.PHOTO?t=a:t=r.getBackgroundById(i).url;return t},r.canvas=n.createRef(),r.filtersRenderer=new ie(t.settings.filter.name),r.isPrepared=!1,r}return se(t,e),t.prototype.componentDidMount=function(){this.update()},t.prototype.render=function(){var e=this.props.data;return n.createElement("canvas",{ref:this.canvas,className:"EditorCanvas__canvas EditorCanvas__canvas--bg",width:e.originalWidth,height:e.originalHeight,style:{width:this.props.width,height:this.props.height}})},t.prototype.update=function(e){var t=this,r=this.getCurrentImageUrl(null==e?void 0:e.background);if(r){var n=this.props.settings;e&&(n=e.settings),ee.get(r).then((function(e){t.renderImage(e,n)})).catch((function(e){console.error(e)}))}},t.prototype.prepare=function(e){var t=this;return new Promise((function(r){t.isPrepared&&r(),t.filtersRenderer.prepare(e).then((function(){r(),t.isPrepared=!0})).catch((function(e){console.log(e)}))}))},t.prototype.renderImage=function(e,t){var r=this,n=this.canvas.current;if(n){var o=n.getContext("2d");o&&this.prepare(e).then((function(){var a=t.colorCorrection,i=t.filter,s=r.filtersRenderer.render({u_exposure:a.exposure,u_brightness:a.brightness,u_contrast:a.contrast,u_saturation:Math.min(a.saturation,.8),u_vignette:a.vignette,u_sharpness:a.sharpness,u_warmth:a.warmth,sourceSize:[1/n.width,1/n.height],u_amount:i.value});if(s){var u,c,l=+(e.height/e.width).toFixed(2);l>1.77?(u=n.height/l,c=n.height):(u=n.width,c=n.width*l);var d=n.width/2-u/2,p=n.height/2-c/2;if(o.clearRect(0,0,n.width,n.height),o.fillStyle="rgb(30, 30, 30)",o.fillRect(0,0,n.width,n.height),o.save(),o.filter="blur(135px)",o.drawImage(s,0,0,n.width,n.height),o.restore(),"none"!==o.filter){var f=X(o);o.fillStyle="rgb("+f.r+", "+f.g+", "+f.b+")",o.fillRect(0,0,n.width,n.height)}o.drawImage(s,d,p,u,c)}})).catch((function(e){console.log(e)}))}},t}(n.Component),le=Object(o.connect)((function(e){return{data:e.data,background:e.background,settings:e.settings}}))(ce),de=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),pe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.controlMouseDown=function(e,r){if(e.preventDefault(),e.stopPropagation(),t.layer=t.props.layer,t.layer.type===u.default.LAYER_TYPES.TEXT){var n=e.target.closest(".EditorLayer__inner");if(!n)return;t.width=n.offsetWidth,t.height=n.offsetHeight}else t.width=t.layer.width,t.height=t.layer.height;if(void 0!==t.width&&void 0!==t.height){switch(window.addEventListener("mousemove",t.controlMouseMove),window.addEventListener("mouseup",t.controlMouseUp),r){case"se":t.offsetFromCenter={x:t.width/2,y:t.height/2};break;case"sw":t.offsetFromCenter={x:-t.width/2,y:t.height/2};break;case"ne":t.offsetFromCenter={x:t.width/2,y:-t.height/2};break;case"nw":t.offsetFromCenter={x:-t.width/2,y:-t.height/2}}void 0!==t.offsetFromCenter&&(t.distanceToZero=Math.sqrt(t.offsetFromCenter.x*t.offsetFromCenter.x+t.offsetFromCenter.y*t.offsetFromCenter.y))}},t.controlMouseMove=function(e){var r=V(e,document.querySelector(".EditorCanvas__canvas--draw")),n=r.x,o=r.y;if(void 0!==t.offsetFromCenter&&void 0!==t.distanceToZero&&void 0!==t.width&&void 0!==t.height){var a={x:n-t.layer.x,y:o-t.layer.y},i=180*(Math.atan2(a.y,a.x)-Math.atan2(t.offsetFromCenter.y,t.offsetFromCenter.x))/Math.PI,s=Math.max(u.default.LAYER_MIN_SIZE,Math.sqrt(a.x*a.x+a.y*a.y))/t.distanceToZero,c=Math.floor(t.width*s),l=Math.floor(t.height*s);t.layer.type===u.default.LAYER_TYPES.TEXT?t.props.updateLayer({fontSize:t.layer.fontSize*s,rotate:i}):t.props.updateLayer({width:c,height:l,scale:s,rotate:i})}},t.controlMouseUp=function(){window.removeEventListener("mousemove",t.controlMouseMove),window.removeEventListener("mouseup",t.controlMouseUp),delete t.width,delete t.height,delete t.centerCoordinates,delete t.offsetFromCenter,delete t.distanceToZero},t}return de(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"EditorLayerSelection"},n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--nw",onMouseDown:function(t){return e.controlMouseDown(t,"nw")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--ne",onMouseDown:function(t){return e.controlMouseDown(t,"ne")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--sw",onMouseDown:function(t){return e.controlMouseDown(t,"sw")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--se",onMouseDown:function(t){return e.controlMouseDown(t,"se")}}))},t}(n.Component),fe=r("Xrg9"),me=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),he=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return me(t,e),t.prototype.render=function(){return fe.default.get("story_show_clickable_zones")?this.props.clickableZones.map((function(e,t){var r=e.clickable_area,o=100*Math.abs(r[1].x-r[0].x),a=100*Math.abs(r[2].y-r[1].y);return n.createElement("div",{key:t,className:"EditorClickableZone",style:{top:100*r[0].y+"%",left:100*r[0].x+"%",width:o+"%",height:a+"%"}})})):null},t}(n.Component),ge=r("pemR"),ve=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),_e=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderLayerSticker=function(e,r,o){var a=t.props.getStickerUrlById(e.id,u.default.STICKER_LARGE);return n.createElement("div",{key:r,className:o,"data-index":r,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:{width:e.width,height:e.height,backgroundImage:"url('"+a+"')"}},t.props.currentIndex===r&&n.createElement(pe,{layer:e,updateLayer:t.props.updateLayer})))},t.renderLayerImage=function(e,r,o){return n.createElement("div",{key:r,className:o,"data-index":r,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:{width:e.width,height:e.height,backgroundImage:"url('"+e.url+"')"}},t.props.currentIndex===r&&n.createElement(pe,{layer:e,updateLayer:t.props.updateLayer}),e.clickableZones&&n.createElement(he,{clickableZones:e.clickableZones})))},t.renderLayerText=function(e,r,o){var a=Math.max(2,e.fontSize*e.scale*u.default.FONT_SIZE_COEFFICIENT);o+=" PhotoEditorFontStyle--"+e.fontStyle;var i={fontSize:a,color:e.color};return t.props.currentIndex===r&&e.isEdit?null:n.createElement("div",{key:r,className:o,"data-index":r,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:i,onDoubleClick:t.handleDoubleClick},n.createElement("div",null,Object(k.decodeHTMLEntities)(e.text.replace(/(\v)/gm,"\n"))),t.props.currentIndex===r&&n.createElement(pe,{layer:e,updateLayer:t.props.updateLayer})))},t.handleDoubleClick=function(){t.props.updateLayer({isEdit:!0})},t}return ve(t,e),t.prototype.render=function(){var e=this.props,t=e.layer,r=e.currentIndex,n=e.index,o=null,a=Object(ge.classNames)("EditorLayer","EditorLayer--"+t.type,{"EditorLayer--active":r===n,"EditorLayer--drag":t.isFixed,"EditorLayer--hide":t.isHide});switch(t.type){case u.default.LAYER_TYPES.STICKER:o=this.renderLayerSticker(t,n,a);break;case u.default.LAYER_TYPES.TEXT:o=this.renderLayerText(t,n,a);break;case u.default.LAYER_TYPES.IMAGE:o=this.renderLayerImage(t,n,a)}return t.isFixed?Y.createPortal(o,document.body):o},t}(n.Component),ye=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),xe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ye(t,e),t.prototype.render=function(){var e=this,t=this.props.layers,r=t.items,o=t.currentIndex,a=Object(ge.classNames)("EditorCanvas__layers",{"EditorCanvas__layers--disabled":this.props.currentMode===u.default.TABS.PAINT});return n.createElement("div",{className:a,id:"EditorCanvas__layers"},r.map((function(t,r){return n.createElement(_e,{key:r,index:r,currentIndex:o,layer:t,updateLayer:e.props.updateLayer,getStickerUrlById:e.props.getStickerUrlById})})))},t}(n.Component),be=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ee=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){var e=r.textareaEl.current;e&&(r.onChange(),e.select())},r.render=function(){var e=r.props.layer,t=.5*u.default.FONT_SIZE_COEFFICIENT;return e.initialFontSize&&(t=e.initialFontSize*u.default.FONT_SIZE_COEFFICIENT),n.createElement("div",{className:"EditorText"},n.createElement("div",{className:"EditorText__inner"},n.createElement("textarea",{ref:r.textareaEl,className:"EditorText__textarea PhotoEditorFontStyle--"+e.fontStyle,defaultValue:Object(k.decodeHTMLEntities)(e.text).replace(/(\v)/gm,""),autoFocus:!0,onChange:r.onChange,onInput:r.onChange,onPaste:r.onChange,style:{color:e.color,fontSize:t,height:r.state.height}})))},r.onChange=function(){var e=r.textareaEl.current;e&&(r.setState({height:0},(function(){r.setState({height:e.scrollHeight})})),r.props.onChange(r.applyLineBreaks(e)))},r.applyLineBreaks=function(e){var t=e.value,r=e.cloneNode(!0);document.querySelector(".EditorText__inner").appendChild(r),r.setAttribute("wrap","off"),r.value="";for(var n=r.scrollWidth,o=0,a=-1;o<t.length;o++){var i=t.charAt(o);if(" "!=i&&"-"!=i&&"+"!=i||(a=o),r.value+=i,r.scrollWidth>n){var s="";if(a>=0){for(var u=a+1;u<o;u++)s+=t.charAt(u);a=-1}s+=i,r.value=r.value.substr(0,r.value.length-s.length),r.value+="\n\v"+s}}return r.remove(),r.value.replace(/(\n\v)/gm,"\v")},r.state={height:0},r.textareaEl=n.createRef(),Object(D.sendStat)(D.EVENTS.EDIT_TEXT),r}return be(t,e),t.prototype.componentDidUpdate=function(e){e.layer.fontStyle!==this.props.layer.fontStyle&&this.onChange()},t}(n.Component),we=r("4+be"),Te=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Se=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},Ce=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidUpdate=function(){r.scrollWithAnimation=!1},r.render=function(){var e,t=r.props.layers,o=t.currentIndex,a=t.items,i=null!==o&&a[o],s=i&&i.type===u.default.LAYER_TYPES.TEXT&&i.isEdit,c=i&&i.type===u.default.LAYER_TYPES.STICKER&&i.isHide,l="";return i&&(i.type===u.default.LAYER_TYPES.STICKER?l=Object(we.getLang)("photos_pe_delete_sticker"):i.type===u.default.LAYER_TYPES.TEXT&&(l=Object(we.getLang)("photos_pe_delete_text"))),r.props.currentBackgroundType!==u.default.BACKGROUND_MODES.BACKGROUND||i||(e=!0),n.createElement("div",{className:"StatusPanel"},e?r.renderBackgrounds():n.createElement("div",{className:"StatusPanel__inner"},r.renderLeftBlock(),n.createElement("div",null,i&&!s&&!c&&n.createElement("a",{className:"StatusPanel__link",onClick:r.props.deleteLayer},l),i&&s&&n.createElement("a",{className:"StatusPanel__link",onClick:r.props.closeTextEditor},Object(we.getLang)("photos_pe_save_action")))))},r.renderLeftBlock=function(){var e=r.props.addons;return"photo"===r.props.context?n.createElement("div",null,e&&e.edited&&e.canEdit&&n.createElement("a",{className:"StatusPanel__link",onClick:e.restore},Object(we.getLang)("photos_filtered_restore")),e&&!e.canEdit&&n.createElement("span",{className:"StatusPanel__info"},Object(we.getLang)("photos_will_be_saved_to_pe_album"))):n.createElement("div",null,r.props.currentBackgroundType===u.default.BACKGROUND_MODES.PHOTO&&n.createElement("a",{className:"StatusPanel__link",onClick:function(){return r.props.uploadPhoto()}},Object(we.getLang)("photos_pe_change_photo")))},r.renderBackgrounds=function(){var e=r.state.scrollBlockPosition,t=r.props.backgrounds,o=t.gradients,a=t.emojies,i=r.scrollElement.current,s=i?e+i.offsetWidth:0,u=!!e,c=!i||!!(i.scrollWidth-s);return n.createElement("div",{className:"StatusPanel__backgrounds",onWheel:r.panelMouseWheel},n.createElement("div",{className:"StatusPanel__scroll",style:{transform:"translateX(-"+e+"px)",transition:r.scrollWithAnimation?"transform .3s ease-out":""},ref:r.scrollElement},Se(o,a).map((function(e){var t=e.id,o=e.preview;return n.createElement("a",{className:Object(ge.classNames)("StatusPanel__background",{"StatusPanel__background--active":t===r.props.currentBackgroundId}),key:t,style:{backgroundImage:"url("+o+")"},onClick:function(){return r.props.setCurrentBackgroundId(t)}})}))),u&&n.createElement("div",{className:"StatusPanel__arrow StatusPanel__arrow--left",onClick:function(){return r.handleArrowClick(!0)}},n.createElement("span",{className:"StatusPanel__arrowIcon"})),c&&n.createElement("div",{className:"StatusPanel__arrow StatusPanel__arrow--right",onClick:function(){return r.handleArrowClick(!1)}},n.createElement("span",{className:"StatusPanel__arrowIcon"})))},r.panelMouseWheel=function(e){r.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},r.setPosition=function(e,t){var n=r.scrollElement.current;if(n){var o=r.state.scrollBlockPosition,a=n.offsetWidth,i=Math.max(0,Math.min(o+e,n.scrollWidth-a));t&&(r.scrollWithAnimation=!0),r.setState({scrollBlockPosition:i})}},r.handleArrowClick=function(e){var t=r.scrollElement.current;if(t){var n=t.offsetWidth/2;e&&(n=-n),r.setPosition(n,!0)}},r.state={scrollBlockPosition:0},r.scrollElement=n.createRef(),r.scrollWithAnimation=!1,r}return Te(t,e),t}(n.Component),Oe=Object(o.connect)((function(e){return{context:e.data.context,layers:e.layers,addons:e.data.addons}}),(function(e){return{deleteLayer:function(){return e(j())},closeTextEditor:function(){return e(M())}}}))(Ce),Pe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),De=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setMode=function(e){e===u.default.BACKGROUND_MODES.PHOTO?Object(D.sendStat)(D.EVENTS.CLICK_TO_CAMERA_ICON):e===u.default.BACKGROUND_MODES.BACKGROUND&&Object(D.sendStat)(D.EVENTS.CLICK_TO_GRADIENT_ICON),t.props.setMode(e)},t}return Pe(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"SwitchMode"},Object.values(u.default.BACKGROUND_MODES).map((function(t){var r=Object(ge.classNames)("SwitchMode__mode","SwitchMode__mode--"+t,{"SwitchMode__mode--active":t===e.props.current});return n.createElement("span",{key:t,className:r,onClick:function(){return e.setMode(t)}})})))},t}(n.Component),ke=r("6krn"),Le=r("XpgC"),Ne=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Re=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=t.props.data.artboardContainer;return e?Y.createPortal(t.renderCanvas(),e):t.renderCanvas()},t.renderCanvas=function(){var e=t.props,r=e.layers,o=e.background,a=e.data,i=a.addons,s=a.artboardWidth,c=a.artboardHeight,l=a.attachment,d=t.props.layers,p=d.currentIndex,f=d.items,m=null!==p&&f[p],h=m&&m.type===u.default.LAYER_TYPES.TEXT&&m.isEdit,g=t.props.ui.isDataLoaded&&t.props.data.context===u.default.CONTEXT_TYPES.STORY,v=c;i&&i.photoHeight&&(v=i.photoHeight);var _=0;return i&&i.photoOffsetTop&&(_=i.photoOffsetTop),n.createElement(n.Fragment,null,n.createElement("div",{style:{width:s,height:v,marginTop:_},className:"EditorCanvas"},n.createElement(xe,{updateLayer:t.props.updateLayer,currentMode:t.props.ui.currentMode,getStickerUrlById:t.props.getStickerUrlById,layers:r}),h&&m?n.createElement(Ee,{layer:m,onChange:t.onChangeText}):g&&n.createElement(n.Fragment,null,!!l&&n.createElement(Le.default,{text:Object(ke.getLang)("photos_pe_attached_post"),position:"b",marginTop:5,align:"left"},n.createElement("span",{className:"EditorCanvas__postIcon"})),n.createElement(De,{current:o.currentBackgroundType,setMode:t.setMode})),t.props.ui.isDataLoaded&&n.createElement(Q,{width:s,height:v}),t.props.ui.isDataLoaded&&n.createElement(le,{width:s,height:v})),t.props.ui.isDataLoaded&&n.createElement(Oe,{currentBackgroundId:o.currentBackgroundId,setCurrentBackgroundId:t.props.setCurrentBackgroundId,currentBackgroundType:o.currentBackgroundType,uploadPhoto:t.uploadPhoto,backgrounds:t.props.data.backgrounds}))},t.onChangeText=function(e){t.props.updateLayer({text:e})},t.setMode=function(e){var r=t.props.background,n=r.currentBackgroundType,o=r.currentPhotoUrl;t.props.setCurrentLayer(null),e===u.default.BACKGROUND_MODES.PHOTO&&!o||n===u.default.BACKGROUND_MODES.PHOTO&&n===e?t.uploadPhoto((function(){t.props.setBackgroundType(e)})):t.props.setBackgroundType(e)},t.uploadPhoto=function(e){K().then((function(r){e&&e(),t.props.setCurrentPhotoUrl(r)})).catch((function(){window.showFastBox({title:Object(ke.getLang)("global_error")},Object(ke.getLang)("stories_create_image_incorrect"))}))},t}return Ne(t,e),t}(n.Component),Ie=Object(o.connect)((function(e){return{ui:e.ui,settings:e.settings,layers:e.layers,drawings:e.drawings,background:e.background,data:e.data}}),(function(e){return{setCurrentBackgroundId:function(t){return e(function(e){return Object(D.sendStat)(D.EVENTS.SELECT_BACKGROUND),{type:"SET_CURRENT_BACKGROUND_ID",value:e}}(t))},updateLayer:function(t){return e(A(t))},setCurrentLayer:function(t){return e(N(t))},setBackgroundType:function(t){return e({type:"SET_CURRENT_BACKGROUND_TYPE",value:t})},setCurrentPhotoUrl:function(t){return e(function(e){return{type:"SET_CURRENT_PHOTO_URL",value:e}}(t))}}}))(Re),Ae=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),je=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ae(t,e),t.prototype.render=function(){var e=this.props,t=e.current,r=e.change;return n.createElement("div",{className:"EditorTabs"},n.createElement("div",{className:"EditorTabs__header"},n.Children.map(this.props.children,(function(e){if(e){var o=Object(ge.classNames)("EditorTabs__item","EditorTabs__item--"+e.props["data-mode"],{"EditorTabs__item--current":t===e.props["data-mode"]});return n.createElement("div",{className:o,key:e.props["data-mode"],onClick:function(){return r(e.props["data-mode"])}})}}))),n.createElement("div",{className:"EditorTabs__content"},n.Children.map(this.props.children,(function(e){if(e){var r={className:Object(ge.classNames)(e.props.className,"EditorTabs__tab",{"EditorTabs__tab--current":t===e.props["data-mode"]})};return n.cloneElement(e,r)}}))))},t}(n.Component),Me=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Fe=function(e){function t(t){var r=e.call(this,t)||this;return r.state={onHover:!1},r}return Me(t,e),t.prototype.render=function(){var e=this,r=Object(ge.classNames)("DropBox__inner",{"DropBox__inner--hover":this.state.onHover});return n.createElement("div",{className:"DropBox"},n.createElement("div",{className:r,onMouseOver:function(){return e.setState({onHover:!0})},onMouseOut:function(){return e.setState({onHover:!1})},onMouseUp:this.props.onDelete},n.createElement("div",{className:"DropBox__icon"},t.renderIcon()),n.createElement("span",{dangerouslySetInnerHTML:{__html:Object(ke.getLang)("photos_pe_drag_to_remove")}})))},t.renderIcon=function(){return n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"50px",height:"50px",viewBox:"0 0 50 50"},n.createElement("path",{d:"M15 19H35V37C35 38.1 34.1 39 33 39H17C15.9 39 15 38.1 15 37V19Z",fill:"white"}),n.createElement("path",{d:"M37 15C37 13.9 36.1 13 35 13H28.4C28.4 11.9 27.5 11 26.4 11H23.6C22.5 11 21.6 11.9 21.6 13H15C13.9 13 13 13.9 13 15C13 15 13 13.5 13 15V17H37V15C37 15 37 13.4 37 15Z",fill:"white",className:"DropBox__cap"}))},t}(n.Component),Be=r("vRp6"),Ue=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),He=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){r.setState({})},r.componentDidUpdate=function(){r.scrollWithAnimation=!1},r.render=function(){var e=r.props,t=e.stickers,o=e.stickerMouseDown,a=r.props.ui,i=a.stickerHeaderScrollPosition,s=a.currentStickerPackIndex,c=r.scrollElement.current,l=!!i,d=!1,p=0;c&&(p=i+c.offsetWidth,d=!!(c.scrollWidth-p));var f=t[s]?t[s].items:[];r.needReset&&(r.needReset=!1,f=[],r.setState({}));for(var m=[],h=0,g=f.length;h<g;h+=3)m.push(f.slice(h,h+3));return n.createElement("div",{className:"StickersPanel"},r.props.ui.isShowDropBox&&n.createElement(Fe,{onDelete:r.props.deleteLayer}),n.createElement("div",{className:"StickersPanel__header"},n.createElement("div",{className:"StickersPanel__scroll",style:{transform:"translateX(-"+i+"px)",transition:r.scrollWithAnimation?"transform .3s ease-out":""},ref:r.scrollElement,onWheel:r.tabsMouseWheel},t.map((function(e,t){var o=e.id,a=r.getTabPreviewUrl(t);if(!a)return null;var i=!Object(te.inArray)(o,["recent","editor"]),u=Object(ge.classNames)("StickersPanel__tab",{"StickersPanel__tab--selected":t===s,"StickersPanel__tab--recent":"recent"===o,"StickersPanel__tab--editor":"editor"===o});return n.createElement("div",{key:o,className:u,style:i?{backgroundImage:"url('"+a+"')"}:void 0,onClick:function(){return r.selectStickerPack(t)}})}))),l&&n.createElement("div",{className:"StickersPanel__arrow StickersPanel__arrow--left",onClick:function(){return r.handleTabArrowClick(!0)}},n.createElement("span",{className:"StickersPanel__arrowIcon"})),d&&n.createElement("div",{className:"StickersPanel__arrow StickersPanel__arrow--right",onClick:function(){return r.handleTabArrowClick(!1)}},n.createElement("span",{className:"StickersPanel__arrowIcon"}))),n.createElement(Be.default,{virtualized:!0,loadMore:function(){},hasMore:!1,className:"StickersPanel__content",itemHeight:98},m.map((function(e,t){return n.createElement("div",{key:t,className:"StickersPanel__row"},e.map((function(e){var t=e.id,r=e.sizes;return n.createElement("div",{key:t,className:"StickersPanel__preview",onMouseDown:function(e){return o(e,t)}},n.createElement("img",{src:r[u.default.STICKER_MEDIUM],className:"StickersPanel__previewImage"}))})))}))))},r.getTabPreviewUrl=function(e){var t=r.props.stickers[e].items,n=(t||[])[0],o=void 0===n?null:n;return!(!t||!o)&&o.sizes[u.default.STICKER_SMALL]},r.selectStickerPack=function(e){r.needReset=!0,r.props.setCurrentStickerPackIndex(e)},r.tabsMouseWheel=function(e){r.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},r.handleTabArrowClick=function(e){var t=r.scrollElement.current;if(t){var n=t.offsetWidth;e&&(n=-n),r.setPosition(n,!0)}},r.setPosition=function(e,t){var n=r.scrollElement.current,o=r.props.ui.stickerHeaderScrollPosition;if(n){var a=n.offsetWidth,i=Math.max(0,Math.min(o+e,n.scrollWidth-a));t&&(r.scrollWithAnimation=!0),r.props.setHeaderScrollPosition(i)}},r.loadingLimit=25,r.scrollElement=n.createRef(),r.scrollWithAnimation=!1,r.needReset=!1,r}return Ue(t,e),t}(n.Component),We=Object(o.connect)((function(e){return{ui:e.ui,stickers:e.data.stickers}}),(function(e){return{deleteLayer:function(){return e(j())},setCurrentStickerPackIndex:function(t){return e(function(e){return{type:"SET_CURRENT_STICKER_PACK_INDEX",value:e}}(t))},setHeaderScrollPosition:function(t){return e(function(e){return{type:"SET_HEADER_SCROLL_POSITION",value:e}}(t))}}}))(He),Ye=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ze=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ye(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"ColorPicker"},u.default.COLORS.map((function(t){var r=Object(ge.classNames)("ColorPicker__color",{"ColorPicker__color--white":"#FFFFFF"===t,"ColorPicker__color--selected":t===e.props.color});return n.createElement("div",{key:t,className:r,style:{backgroundColor:t},onClick:function(){return e.props.setColor(t)}})})))},t}(n.Component),Ve=r("clTp"),Ge=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Xe=function(e){function t(r){var o,a=e.call(this,r)||this;return a.onMouseDown=function(e){0===e.button&&(a.update(e),a.setState({isActive:!0}),window.addEventListener("mouseup",a.onMouseUp),window.addEventListener("mousemove",a.update))},a.onMouseUp=function(){a.setState({isActive:!1}),window.removeEventListener("mousemove",a.update),window.removeEventListener("mouseup",a.onMouseUp)},a.onMouseEnter=function(){window.addEventListener("mousemove",a.updateHint)},a.onMouseLeave=function(){window.removeEventListener("mousemove",a.updateHint)},a.update=function(e){var r=a.props,n=r.min,o=r.max,i=r.gravity,s=a.getOffset(e),u=s.offset,c=s.width,l=a.getZeroPosition(),d=t.valueToPercent(u,0,c);i&&i>0&&d>=l-i&&d<=l+i&&(d=l),a.state.percentValue!==d&&a.setState({percentValue:d,hintPosition:d},(function(){a.props.onChange(t.percentToValue(d,n,o))}))},a.updateHint=function(e){var r=a.getOffset(e),n=r.offset,o=r.width;a.setState({hintPosition:t.valueToPercent(n,0,o)})},o=r.defaultValue?t.valueToPercent(r.defaultValue,r.min,r.max):a.getZeroPosition(),a.state={percentValue:o,hintPosition:0,isActive:!1},a.slider=n.createRef(),a}return Ge(t,e),t.prototype.componentDidMount=function(){this.slider.current&&this.slider.current.addEventListener("mousedown",this.onMouseDown),this.slider.current&&this.slider.current.addEventListener("mouseenter",this.onMouseEnter),this.slider.current&&this.slider.current.addEventListener("mouseleave",this.onMouseLeave)},t.prototype.componentWillUnmount=function(){this.slider.current&&this.slider.current.removeEventListener("mousedown",this.onMouseDown),this.slider.current&&this.slider.current.removeEventListener("mouseenter",this.onMouseEnter),this.slider.current&&this.slider.current.removeEventListener("mouseleave",this.onMouseLeave)},t.valueToPercent=function(e,t,r){return e<t&&(e=t),e>r&&(e=r),100*(e-t)/(r-t)},t.percentToValue=function(e,t,r){return Math.round(100*(e*(r-t)/100+t))/100},t.getFillPosition=function(e,t){var r,n;return e<t?(r=e,n=t-e):(r=t,n=e-t),{left:r,width:n}},t.prototype.getZeroPosition=function(){var e=this.props,r=e.min,n=e.max;return t.valueToPercent(0,r,n)},t.prototype.getOffset=function(e){var t=this.props,r=t.min,n=t.max,o=t.step,a=Object(Ve.default)(this.slider.current),i=a.left,s=a.width,u=e.clientX-i;if(o>0){var c=s/((n-r)/o);u=Math.round(u/c)*c}return{offset:u,left:i,width:s}},t.prototype.render=function(){var e=this.props,r=e.min,o=e.max,a=e.isShowZero,i=e.isShowHandle,s=e.appearance,u=this.state,c=u.percentValue,l=u.hintPosition,d=u.isActive,p=this.getZeroPosition(),f=t.getFillPosition(c,p),m=f.left,h=f.width,g=c!==p,v=this.props.formatHint(t.percentToValue(l,r,o)),_=Object(ge.classNames)("Slider","Slider--"+s,{Slider__active:d}),y=Object(ge.classNames)("Slider__handle",{"Slider__handle--active":g,"Slider__handle--show":i});return n.createElement("div",{className:_,ref:this.slider},n.createElement("input",{type:"hidden",name,value:c}),a&&g&&n.createElement("div",{className:"Slider__middletick",style:{left:p+"%"}}),n.createElement("span",{className:"Slider__hint",style:{left:l+"%"}},v),n.createElement("div",{className:"Slider__fill",style:{left:m+"%",width:h+"%"}}),n.createElement("div",{className:y,style:{left:c+"%"}}))},t.defaultProps={min:0,max:100,step:0,gravity:0,isShowZero:!1,isShowHandle:!1,defaultValue:0,appearance:"blue",name:"value",onChange:function(){},formatHint:function(e){return e}},t}(n.Component),Ke=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ze=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){r.updateDrawingPreview()},r.render=function(){var e=r.props,t=e.settings,o=e.setColor,a=e.setBrushWidth,i=e.setBrushOpacity;return r.updateDrawingPreview(),n.createElement("div",{className:"DrawPanel"},n.createElement("canvas",{ref:r.previewCanvas,className:"DrawPanel__preview",width:"270",height:"80"}),n.createElement("div",{className:"DrawPanel__sliders"},n.createElement("div",{className:"DrawPanel__slider"},n.createElement("div",{className:"DrawPanel__sliderTitle"},Object(ke.getLang)("photos_pe_intensity")),n.createElement(Xe,{min:0,max:1,defaultValue:t.brushOpacity,formatHint:function(e){return Math.round(100*e)+"%"},onChange:function(e){return i(e)}})),n.createElement("div",{className:"DrawPanel__slider"},n.createElement("div",{className:"DrawPanel__sliderTitle"},Object(ke.getLang)("photos_pe_line_width")),n.createElement(Xe,{min:0,max:1,defaultValue:t.brushWidth,formatHint:function(e){return Math.round(100*e)+"%"},onChange:function(e){return a(e)}}))),n.createElement(ze,{color:t.color,setColor:o}),!!r.props.drawings.length&&n.createElement("div",{className:"DrawPanel__undo",onClick:r.undoDrawing},Object(ke.getLang)("photos_pe_undo_last_action")))},r.updateDrawingPreview=function(){var e=r.previewCanvas.current,t=r.props.settings;if(e){var n=e.getContext("2d");if(n){var o=n.canvas,a=o.width,i=o.height,s=.2*a,c=.25*i,l=.8*a,d=c,p=a/2,f=1.2*i;n.clearRect(0,0,a,i),n.beginPath(),n.moveTo(s,c),n.quadraticCurveTo(p,f,l,d);var m="#FFFFFF"===t.color?"#F1F1F1":t.color;n.lineWidth=t.brushWidth*u.default.BRUSH_WIDTH_COEFFICIENT,n.strokeStyle=G(m,t.brushOpacity),n.lineJoin=n.lineCap="round",n.stroke()}}},r.undoDrawing=function(){r.props.undoDrawing()},r.previewCanvas=n.createRef(),r}return Ke(t,e),t}(n.Component),qe=Object(o.connect)((function(e){return{settings:e.settings,drawings:e.drawings}}),(function(e){return{setColor:function(t){return e(U(t))},setBrushWidth:function(t){return e(function(e){return{type:"SET_SETTING_BRUSH_WIDTH",brushWidth:Math.max(.1,e)}}(t))},setBrushOpacity:function(t){return e(function(e){return{type:"SET_SETTING_BRUSH_OPACITY",brushOpacity:e}}(t))},undoDrawing:function(){return e(W())}}}))(Ze),$e=r("Ht+d"),Je=r("TBLV"),Qe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),et=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=t.props,r=e.settings,o=e.setColor,a=e.layer,i=e.fontsPlaceholders,s=a&&a.isEdit,c=a&&a.fontStyle,l=a&&a.color;return n.createElement("div",{className:"TextPanel"},t.props.ui.isShowDropBox&&n.createElement(Fe,{onDelete:t.props.deleteLayer}),s?n.createElement($e.default,{className:"TextPanelButton",onClick:t.props.closeTextEditor},Object(we.getLang)("photos_pe_save_action")):n.createElement($e.default,{className:"TextPanelButton",onClick:function(){return t.props.addLayerText(!0,{isEdit:!0})}},n.createElement("div",{className:"TextPanelButton__icon"}),Object(we.getLang)("photos_pe_add_text")),n.createElement("div",{className:"TextPanelButton__fonts"},n.createElement("div",{className:"TextPanelButton__title"},Object(we.getLang)("photos_pe_font")),u.default.FONTS.map((function(e,o){return n.createElement(Je.default,{key:e,value:e,name:"photo_editor_fonts",className:"TextPanelButton__radio",onChange:function(){return t.props.setFontStyle(e)},checked:c?c===e:r.fontStyle===e},n.createElement("span",{className:"TextPanelButton__font PhotoEditorFontStyle--"+e},i[o]))}))),n.createElement("div",{className:"TextPanelButton__colors"},n.createElement("div",{className:"TextPanelButton__title"},Object(we.getLang)("photos_pe_color")),n.createElement(ze,{color:l||r.color,setColor:o})))},t}return Qe(t,e),t}(n.Component),tt=Object(o.connect)((function(e){var t=e.layers,r=t.items,n=t.currentIndex,o=null;return null!==n&&(o=r[n]),{ui:e.ui,settings:e.settings,layer:o,fontsPlaceholders:e.data.fontsPlaceholders}}),(function(e){return{addLayerText:function(t,r){return e(I(t,r))},setColor:function(t){return e(U(t))},setFontSize:function(t){return e(function(e){return function(t,r){var n=r().layers,o=n.currentIndex,a=n.items;o&&!a[o]||t(A({fontSize:e})),t({type:"SET_SETTING_FONT_SIZE",fontSize:e})}}(t))},setFontStyle:function(t){return e(function(e){return function(t,r){var n=r().layers,o=n.currentIndex,a=n.items;o&&!a[o]||t(A({fontStyle:e})),t({type:"SET_SETTING_FONT_FAMILY",fontStyle:e})}}(t))},deleteLayer:function(){return e(j())},closeTextEditor:function(){return e(M())}}}))(et),rt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),nt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return rt(t,e),t.prototype.render=function(){var e=this.props,t=e.settings,r=e.setColorCorrection;return n.createElement("div",{className:"ColorPanel"},n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(ke.getLang)("photos_pe_correction_exposure")),n.createElement(Xe,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,defaultValue:t.colorCorrection.exposure,onChange:function(e){return r("exposure",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(ke.getLang)("photos_pe_correction_brightness")),n.createElement(Xe,{min:-.5,max:.5,gravity:2,isShowHandle:!0,isShowZero:!0,defaultValue:t.colorCorrection.brightness,onChange:function(e){return r("brightness",e)},formatHint:function(e){return Math.round(2*e*100)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(ke.getLang)("photos_pe_correction_contrast")),n.createElement(Xe,{min:-.5,max:.5,gravity:2,isShowHandle:!0,isShowZero:!0,defaultValue:t.colorCorrection.contrast,onChange:function(e){return r("contrast",e)},formatHint:function(e){return Math.round(2*e*100)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(ke.getLang)("photos_pe_correction_saturation")),n.createElement(Xe,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,defaultValue:t.colorCorrection.saturation,onChange:function(e){return r("saturation",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(ke.getLang)("photos_pe_correction_vignette")),n.createElement(Xe,{min:0,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,defaultValue:t.colorCorrection.vignette,onChange:function(e){return r("vignette",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(ke.getLang)("photos_pe_correction_sharpness")),n.createElement(Xe,{min:0,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,defaultValue:t.colorCorrection.sharpness,onChange:function(e){return r("sharpness",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(ke.getLang)("photos_pe_correction_warmth")),n.createElement(Xe,{min:-.5,max:.5,gravity:2,isShowHandle:!0,isShowZero:!0,defaultValue:t.colorCorrection.warmth,onChange:function(e){return r("warmth",e)},formatHint:function(e){return Math.round(2*e*100)}})))},t}(n.Component),ot=Object(o.connect)((function(e){return{settings:e.settings}}),(function(e){return{setColorCorrection:function(t,r){return e(function(e,t){return{type:"SET_SETTING_COLOR_CORRECTION",filter:e,value:t}}(t,r))}}}))(nt),at=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),it=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},st=function(e){function t(t){var r=e.call(this,t)||this;return r.shouldComponentUpdate=function(e){var t=r.props.background,n=JSON.stringify(t)!==JSON.stringify(e.background);return e.settings.filter.name!==r.props.settings.filter.name||(n&&(r.isPrepared=!1,r.update(e)),!1)},r.handleClick=function(){r.props.setFilter(r.props.filter,r.props.settings.filter.value)},r.getBackgroundById=function(e){var t=r.props.data.backgrounds,n=t.gradients,o=t.emojies;return it(n,o).filter((function(t){return t.id===e}))[0]},r.getCurrentImageUrl=function(e){var t,n=e||r.props.background,o=n.currentBackgroundType,a=n.currentPhotoUrl,i=n.currentBackgroundId;o===u.default.BACKGROUND_MODES.PHOTO?t=a:t=r.getBackgroundById(i).url;return t},r.canvas=n.createRef(),r.filtersRenderer=new ie(t.filter),r.isPrepared=!1,r}return at(t,e),t.prototype.componentDidMount=function(){this.update()},t.prototype.render=function(){var e=Object(ge.classNames)("FiltersItem",{"FiltersItem--active":this.props.settings.filter.name===this.props.filter});return n.createElement("div",{className:e,onClick:this.handleClick},n.createElement("div",{className:"FiltersItem__inner"},n.createElement("canvas",{className:"FiltersItem__image",ref:this.canvas,width:2*u.default.FILTER_PREVIEW_WIDTH,height:2*u.default.FILTER_PREVIEW_HEIGHT,style:{width:u.default.FILTER_PREVIEW_WIDTH,height:u.default.FILTER_PREVIEW_HEIGHT}}),n.createElement("span",{className:"FiltersItem__name"},Object(ke.getLang)("photos_pe_filter_"+this.props.filter))))},t.prototype.update=function(e){var t=this,r=this.getCurrentImageUrl(null==e?void 0:e.background);r&&ee.get(r).then((function(e){t.renderImage(e)})).catch((function(e){console.error(e)}))},t.prototype.prepare=function(e){var t=this;return new Promise((function(r){t.isPrepared&&r(),t.filtersRenderer.prepare(e).then((function(){r(),t.isPrepared=!0})).catch((function(e){console.log(e)}))}))},t.prototype.renderImage=function(e){var t=this;this.prepare(e).then((function(){var r=t.filtersRenderer.render({u_amount:.75});if(r){var n=t.canvas.current;if(n){var o=n.getContext("2d");if(o){var a,i,s=+(e.height/e.width).toFixed(2);s>1.77?(a=n.height/s,i=n.height):(a=n.width,i=n.width*s);var u=n.width/2-a/2,c=n.height/2-i/2;if(o.clearRect(0,0,n.width,n.height),o.fillStyle="rgb(30, 30, 30)",o.fillRect(0,0,n.width,n.height),o.save(),o.filter="blur(135px)",o.drawImage(r,0,0,n.width,n.height),o.restore(),"none"!==o.filter){var l=X(o);o.fillStyle="rgb("+l.r+", "+l.g+", "+l.b+")",o.fillRect(0,0,n.width,n.height)}o.drawImage(r,u,c,a,i)}}}})).catch((function(e){console.log(e)}))},t}(n.Component),ut=Object(o.connect)((function(e){return{data:e.data,background:e.background,settings:e.settings}}),(function(e){return{setFilter:function(t,r){return e(H(t,r))}}}))(st),ct=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),lt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.changeFilterValue=function(e){t.props.setFilter(t.props.settings.filter.name,e)},t}return ct(t,e),t.prototype.render=function(){return n.createElement("div",{className:"FiltersPanel"},n.createElement("div",{className:"FiltersPanel__header"},this.renderHeader()),n.createElement("div",{className:"FiltersPanel__inner"},u.default.PHOTO_FILTERS.map((function(e){return n.createElement(ut,{key:e,filter:e})}))))},t.prototype.renderHeader=function(){var e=this.props.settings;return"regular"===e.filter.name?n.createElement("span",null,Object(ke.getLang)("photos_pe_filter_disabled")):n.createElement("div",{className:"FiltersPanel__slider"},n.createElement("span",{className:"FiltersPanel__title"},Object(ke.getLang)("photos_pe_filter_enabled")),n.createElement(Xe,{min:0,max:1,defaultValue:e.filter.value,isShowHandle:!0,onChange:this.changeFilterValue,formatHint:function(e){return Math.round(100*e)+"%"}}))},t}(n.Component),dt=Object(o.connect)((function(e){return{settings:e.settings}}),(function(e){return{setFilter:function(t,r){return e(H(t,r))}}}))(lt),pt=r("3oLO"),ft=r("W9Tc"),mt=r("Egk5"),ht=r("zxIV"),gt=r("6raB"),vt=r("PjZB"),_t=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),yt=function(){return(yt=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},xt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.componentDidMount=function(){window.addEventListener("keydown",t.handleKeyDown),window.addEventListener("mousedown",t.canvasMouseDown),t.getEditorData().then((function(e){var r=e.stickers,n=e.backgrounds,o=e.storyUploadUrlHash,a=e.storySaveHash,i={};r.forEach((function(e){e.items.forEach((function(e){i[e.id]=e}))})),t.props.setData({stickers:r,stickersMap:i,backgrounds:n,placeholders:Object(ke.getLang)("photos_pe_texts_placeholders").split("<br>"),fontsPlaceholders:Object(ke.getLang)("photos_pe_fonts").split("<br>"),storyUploadUrlHash:o,storySaveHash:a}),t.props.setDataLoaded(),t.props.background.currentBackgroundType===u.default.BACKGROUND_MODES.BACKGROUND&&(t.props.addLayerText(!0,{isEdit:!0}),t.props.closeTextEditor(),t.props.setCurrentLayer(null)),t.props.stickers&&t.prepareStickers(t.props.stickers)})).catch((function(){window.showFastBox({title:Object(ke.getLang)("global_error")},Object(ke.getLang)("global_error"),Object(ke.getLang)("global_close"),(function(){window.curBox().hide(),t.props.data.close(!1,!0)}))}))},t.componentWillUnmount=function(){window.removeEventListener("keydown",t.handleKeyDown),window.removeEventListener("mousedown",t.canvasMouseDown),delete window.cur.storyPublishContext},t.getEditorData=function(){return new Promise((function(e,t){pt.ajax.post("al_photos.php",{act:"get_editor_data"},{onDone:function(t){e(t)},onFail:function(){return t(),!0}})}))},t.render=function(){var e,r=t.props,o=r.ui,a=r.data,i=r.drawings,s=r.layers,c=r.settings;if(a.artboardContainer||(e={width:a.artboardWidth,height:parseInt(a.artboardHeight)+u.default.BOTTOM_PANEL_HEIGHT}),t.isSaveDisabled=!0,a.context===u.default.CONTEXT_TYPES.STORY)t.isSaveDisabled=!1;else{var l=c.colorCorrection;t.isSaveDisabled=!s.items.length&&!i.length&&!(l.exposure||l.brightness||l.contrast||l.saturation||l.vignette||l.sharpness||l.warmth)&&"regular"===c.filter.name}return n.createElement("div",{className:"PhotoEditor",style:{height:parseInt(a.artboardHeight)+u.default.BOTTOM_PANEL_HEIGHT}},n.createElement("div",{className:"PhotoEditor__canvas",style:e},n.createElement(Ie,{getStickerUrlById:t.getStickerUrlById})),n.createElement("div",{className:"PhotoEditor__tabs"},o.isDataLoaded?t.renderTabs():n.createElement(vt.default,null)),!o.isDataLoaded&&t.renderFontsPreloading())},t.renderTabs=function(){var e=Object(ft.partConfigEnabled)("web_new_photo_editor"),r=Object(ke.getLang)("photos_pe_save_action");return t.props.data.context===u.default.CONTEXT_TYPES.STORY&&(r=Object(ke.getLang)("photos_pe_publish_action")),n.createElement("div",{className:"PhotoEditor__inner"},n.createElement(je,{current:t.props.ui.currentMode,change:t.props.setMode},n.createElement("div",{"data-mode":u.default.TABS.STICKERS},n.createElement(We,{stickerMouseDown:t.stickerDragStart})),n.createElement("div",{"data-mode":u.default.TABS.TEXT},n.createElement(tt,null)),n.createElement("div",{"data-mode":u.default.TABS.PAINT},n.createElement(qe,null)),e&&n.createElement("div",{"data-mode":u.default.TABS.COLOR},n.createElement(ot,null)),e&&n.createElement("div",{"data-mode":u.default.TABS.FILTERS},n.createElement(dt,null))),n.createElement("div",{className:"PhotoEditor__actions"},n.createElement($e.default,{appearance:"secondary",onClick:t.props.data.close},Object(ke.getLang)("photos_pe_cancel_action")),n.createElement(gt.default,{appearance:"primary",loading:t.props.ui.isSaveLoading,disabled:t.isSaveDisabled,onClick:t.save},r)))},t.renderFontsPreloading=function(){return n.createElement("div",{className:"PhotoEditor__fontPreload"},u.default.FONTS.map((function(e){return n.createElement("span",{key:e,className:"PhotoEditorFontStyle--"+e})})))},t.save=function(){t.props.setCurrentLayer(null),t.props.setSaveLoading(!0),t.renderFinalImage().then((function(e){var r=e.blob,n=e.width,o=e.height,a=t.props,i=a.layers,s=a.drawings,u=a.background,c=Object(D.prepareStat)(i.items,s,u.currentBackgroundType,u.currentBackgroundId),l=[];t.props.layers.items.forEach((function(e){e.clickableZones&&e.clickableZones.forEach((function(r){l.push(t.getPreparedClickableZone(e,r))}))}));var d={original_width:n,original_height:o,clickable_stickers:l};t.props.data.save(r,(function(){t.props.setSaveLoading(!1)}),{attachment:t.props.data.attachment,storyUploadUrlHash:t.props.data.storyUploadUrlHash,storySaveHash:t.props.data.storySaveHash,analytics:JSON.stringify(c),clickableStickers:JSON.stringify(d)})})).catch((function(e){console.error(e)}))},t.getPreparedClickableZone=function(e,r){var n,o=t.props.data.originalWidth/t.props.data.artboardWidth,a=e.rotate*(Math.PI/180),i=e.x-e.width/2,s=e.y-e.height/2,u=parseFloat(e.x)+(i-e.x)*Math.cos(a)-(s-e.y)*Math.sin(a),c=parseFloat(e.y)+(s-e.y)*Math.cos(a)+(i-e.x)*Math.sin(a),l=null===(n=r.clickable_area)||void 0===n?void 0:n.map((function(t){var r=t.x*e.width,n=t.y*e.height,i=r*Math.cos(a)-n*Math.sin(a),s=r*Math.sin(a)+n*Math.cos(a);return{x:(u+i)*o,y:(c+s)*o}})),d={type:r.action_type,clickable_area:l};return"link"===r.action_type?(d.link=r.action.link,r.action.tooltip_text_key&&(d.tooltip_text_key=r.action.tooltip_text_key)):"app"===r.action_type&&(d.app_id=r.action.app_id,r.action.app_context&&(d.app_id=r.action.app_id)),d},t.renderFinalImage=function(){return new Promise((function(e){var r=document.createElement("canvas"),n=r.getContext("2d"),o=document.querySelector(".EditorCanvas__canvas--bg"),a=document.querySelector(".EditorCanvas__canvas--draw"),i=document.getElementById("EditorCanvas__layers");if(n&&o&&a&&i){r.width=o.width,r.height=o.height,n.drawImage(o,0,0),n.drawImage(a,0,0);var s=t.props.data,u=s.artboardWidth,c=s.artboardHeight,l=s.addons,d=c;l&&l.photoHeight&&(d=l.photoHeight),P.a.toCanvas(i,{width:u,height:d,filter:function(e){return e.nodeType===Node.TEXT_NODE||!e.classList.contains("EditorLayer--sticker")&&!e.classList.contains("EditorClickableZone")}}).then((function(o){n.drawImage(o,0,0,r.width,r.height),t.renderCanvasLayers(n).then((function(){r.toBlob((function(t){e({blob:t,width:r.width,height:r.height})}),"image/jpeg",1)})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}}))},t.renderCanvasLayers=function(e){return new Promise((function(r,n){var o=t.props.data.originalWidth/t.props.data.artboardWidth,a=[];t.props.layers.items.forEach((function(r){r.type===u.default.LAYER_TYPES.STICKER&&a.push(t.renderCanvasSticker(e,r,o))})),Promise.all(a).then(r).catch((function(e){n(e)}))}))},t.renderCanvasSticker=function(e,r,n){return z(t.getStickerUrlById(r.id,u.default.STICKER_LARGE)).then((function(t){var o=r.width*n,a=r.height*n,i=(r.x-r.width/2)*n,s=(r.y-r.height/2)*n;e.save(),e.translate(i,s),e.translate(o/2,a/2),e.rotate(r.rotate*Math.PI/180),e.translate(-o/2,-a/2),e.drawImage(t,0,0,o,a),e.restore()}))},t.handleKeyDown=function(e){if((e.ctrlKey||e.metaKey)&&90===e.keyCode&&t.props.ui.currentMode===u.default.TABS.PAINT&&t.props.undoDrawing(),null!==t.props.layers.currentIndex&&"TEXTAREA"!==e.target.nodeName)if(e.keyCode===mt.KEY.DEL)e.preventDefault(),t.props.deleteLayer();else if([mt.KEY.UP,mt.KEY.DOWN,mt.KEY.LEFT,mt.KEY.RIGHT].includes(e.keyCode)){var r=t.getCurrentLayer();if(!r)return;var n={x:r.x,y:r.y},o=e.shiftKey?10:1;switch(e.keyCode){case mt.KEY.UP:n.y-=o;break;case mt.KEY.DOWN:n.y+=o;break;case mt.KEY.LEFT:n.x-=o;break;case mt.KEY.RIGHT:n.x+=o}t.props.updateLayer({x:n.x,y:n.y})}},t.canvasMouseDown=function(e){var r=t.getCurrentLayer(),n=e.target;if(r&&r.isFixed)t.layerDragFinish(e);else if("TEXTAREA"!==n.tagName)return!!n.closest(".EditorCanvas")&&(!n.closest(".SwitchMode")&&void(t.props.ui.currentMode!==u.default.TABS.PAINT&&(r&&r.type===u.default.LAYER_TYPES.TEXT&&r.isEdit?t.props.closeTextEditor():n.closest(".EditorLayer")?t.layerDragStart(e):r&&t.props.setCurrentLayer(null))))},t.getCurrentLayer=function(){var e=t.props.layers,r=e.items,n=e.currentIndex;return null===n?n:r[n]},t.layerDragStart=function(e,r){window.addEventListener("mousemove",t.layerDragProcess),window.addEventListener("mouseup",t.layerDragFinish);var n,o=e.target.closest("[data-index]");n=o?+Object(ht.domData)(o,"index"):t.props.layers.currentIndex,t.props.layers.currentIndex!==n&&t.props.setCurrentLayer(n);var a=V(e,document.querySelector(".EditorCanvas__canvas--draw")),i=a.x,s=a.y,u=a.xOrigin,c=a.yOrigin;t.currentLayer=t.getCurrentLayer(),t.currentLayer&&(t.fromPanel=r,t.clientX=e.clientX,t.clientY=e.clientY,t.fromPanel?(t.shiftX=0,t.shiftY=0,t.shiftBodyX=0,t.shiftBodyY=0):(t.shiftX=i-t.currentLayer.x,t.shiftY=s-t.currentLayer.y,t.shiftBodyX=t.clientX-(t.currentLayer.x+u),t.shiftBodyY=t.clientY-(t.currentLayer.y+c)))},t.layerDragProcess=function(e){void 0!==t.shiftBodyX&&void 0!==t.shiftBodyY&&(t.props.updateLayer({x:Math.round(e.clientX-t.shiftBodyX),y:Math.round(e.clientY-t.shiftBodyY),isFixed:!0,isHide:!1}),t.fromPanel||t.props.ui.isShowDropBox||t.props.setShowDropBox(!0))},t.layerDragFinish=function(e){if(window.removeEventListener("mousemove",t.layerDragProcess),window.removeEventListener("mouseup",t.layerDragFinish),t.getCurrentLayer()&&t.currentLayer&&void 0!==t.shiftX&&void 0!==t.shiftY){var r=document.querySelector(".EditorCanvas__canvas--draw");if(r){var n=V(e,r),o=n.x,a=n.y,i=r.getBoundingClientRect(),s=i.width,u=i.height,c=o-t.shiftX,l=a-t.shiftY,d=!1;if(t.fromPanel){var p=t.currentLayer.width/2,f=t.currentLayer.height/2;t.clientX===e.clientX&&t.clientY===e.clientY?(c=r.offsetWidth/2,l=r.offsetHeight/2):(c+p<0||c-p>s||l+f<0||l-f>u)&&(d=!0)}t.props.updateLayer({x:Math.round(c),y:Math.round(l),isFixed:!1,isHide:!1}),d&&t.props.deleteLayer(),t.props.setShowDropBox(!1),delete t.currentLayer,delete t.shiftX,delete t.shiftY,delete t.shiftBodyX,delete t.shiftBodyY,delete t.fromPanel,delete t.clientX,delete t.clientY}}},t.getStickerUrlById=function(e,r){var n=t.props.data.stickersMap[e];return n?n.sizes[r]:""},t.stickerDragStart=function(e,r){e.persist();var n=t.getCurrentLayer();if(!n||!n.isFixed){var o=document.querySelector(".EditorCanvas__canvas--draw");if(o){var a=u.default.LAYER_DEFAULT_SIZE/2,i=Math.floor(o.width/u.default.CANVAS_SCALE/2-a),s=Math.floor(o.height/u.default.CANVAS_SCALE/2-a);t.props.addLayerSticker({id:r,x:i,y:s,width:u.default.LAYER_DEFAULT_SIZE,height:u.default.LAYER_DEFAULT_SIZE,rotate:0,isHide:!0,isFixed:!1}),setTimeout((function(){t.layerDragStart(e.nativeEvent,!0)}),0)}}},t.prepareStickers=function(e){var r=t.props.data,n=r.artboardWidth,o=r.artboardHeight;e.forEach((function(e){var r=e.sticker.transform||{},a=r.gravity,i=void 0===a?"center":a,s=r.rotation,c=void 0===s?0:s,l=r.translation_x,d=void 0===l?0:l,p=r.translation_y,f=void 0===p?0:p,m=r.relation_width;if(d=Math.min(Math.max(d,-1),1),f=Math.min(Math.max(f,-1),1),m&&(m=Math.min(Math.max(m,.1),1)),"renderable"===e.sticker_type)t.prepareRenderableSticker(e.sticker,i,d,f,m).then((function(e){var r=e.url,n=e.x,o=e.y,a=e.stickerWidth,i=e.stickerHeight,s=e.clickableZones;t.props.addLayerImage({url:r,x:n,y:o,width:Math.round(a),height:Math.round(i),rotate:-c,isFixed:!1,clickableZones:s})})).catch((function(e){console.error(e)}));else if("native"===e.sticker_type)switch(e.sticker.action_type){case"sticker":var h=m?n*m:u.default.LAYER_DEFAULT_SIZE,g=m?n*m:u.default.LAYER_DEFAULT_SIZE,v=e.sticker.action.pack_id+"_"+e.sticker.action.sticker_id;if(t.props.data.stickersMap[v]){var _=Z(i,n,o,h/2,g/2,d*n,f*o),y=_.x,x=_.y;t.props.addLayerSticker({id:v,x:y,y:x,width:h,height:g,rotate:-c,isHide:!1,isFixed:!1})}break;case"text":var b=.5;m&&(b=t.getFontSize(e.sticker.action.text,n*m,e.sticker.action.style));var E=t.getTextRect(e.sticker.action.text,b*u.default.FONT_SIZE_COEFFICIENT,e.sticker.action.style),w=(h=E.width,g=E.height,Z(i,n,o,h/2,g/2,d*n,f*o));y=w.x,x=w.y;t.props.addLayerText(!1,{text:e.sticker.action.text,style:e.sticker.action.style,color:e.sticker.action.selection_color,fontSize:b,initialFontSize:b,rotate:-c,x:y,y:x})}}))},t.prepareRenderableSticker=function(e,r,n,o,a){var i=t.props.data,s=i.artboardWidth,u=i.artboardHeight,c=i.originalWidth/s;return new Promise((function(t,i){"string"!=typeof e.url&&"string"!=typeof e.blob&&i();var l=e.url||e.blob||"";z(l).then((function(i){var d=i.height/i.width,p=0,f=0;a?f=(p=s*a)*d:(p=i.width/c,f=i.height/c,p>s&&(f=(p=s)*d));var m,h=Z(r,s,u,p/2,f/2,n*s,o*u),g=h.x,v=h.y;e.clickable_zones&&(m=e.clickable_zones.map((function(e){var t;return t=e.clickable_area?e.clickable_area.map((function(e){return{x:e.x/i.width,y:e.y/i.height}})):[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],yt(yt({},e),{clickable_area:t})}))),t({url:l,x:g,y:v,stickerWidth:p,stickerHeight:f,clickableZones:m})})).catch((function(){i()}))}))},t.getTextRect=function(e,t,r){var n=document.createElement("span");n.innerHTML=e,n.style.display="inline-block",n.style.fontSize=t+"px",n.style.lineHeight="1em",n.style.whiteSpace="pre",r&&n.classList.add("PhotoEditorFontStyle--"+r),document.body.append(n);var o=n.getBoundingClientRect();return n.remove(),o},t.getFontSize=function(e,t,r){var n=2*t,o=document.createElement("span");for(o.innerHTML=e,o.style.display="inline-block",o.style.width=t+"px",o.style.fontSize=n+"px",o.style.lineHeight="1em",o.style.whiteSpace="pre",r&&o.classList.add("PhotoEditorFontStyle--"+r),document.body.append(o);n&&o.scrollWidth>Math.round(t);)n--,o.style.fontSize=n+"px";return o.remove(),n/100},t}return _t(t,e),t}(n.Component),bt=Object(o.connect)((function(e){return{ui:e.ui,settings:e.settings,layers:e.layers,drawings:e.drawings,background:e.background,data:e.data}}),(function(e){return{setMode:function(t){return e(B(t))},addLayerSticker:function(t){return e(function(e){return Object(D.sendStat)(D.EVENTS.ADD_STICKER),R("ADD_LAYER_STICKER",{type:u.default.LAYER_TYPES.STICKER,id:e.id,x:e.x,y:e.y,width:e.width,height:e.height,rotate:e.rotate,isHide:e.isHide,isFixed:e.isFixed})}(t))},addLayerText:function(t,r){return e(I(t,r))},addLayerImage:function(t){return e(function(e){return R("ADD_LAYER_IMAGE",{type:u.default.LAYER_TYPES.IMAGE,url:e.url,x:e.x,y:e.y,width:e.width,height:e.height,rotate:e.rotate,isFixed:e.isFixed,clickableZones:e.clickableZones})}(t))},updateLayer:function(t){return e(A(t))},undoDrawing:function(){return e(W())},deleteLayer:function(){return e(j())},setCurrentLayer:function(t){return e(N(t))},setDataLoaded:function(){return e({type:"SET_DATA_LOADED"})},setShowDropBox:function(t){return e(F(t))},setSaveLoading:function(t){return e(function(e){return{type:"SET_SAVE_LOADING",value:e}}(t))},closeTextEditor:function(){return e(M())},setData:function(t){return e(function(e){return{type:"SET_DATA",payload:e}}(t))}}}))(xt),Et=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),wt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getBackgroundType=function(){var e=u.default.CONTEXT_TYPES,r=u.default.BACKGROUND_MODES;return t.props.context===e.STORY?t.props.photoUrl?r.PHOTO:r.BACKGROUND:r.PHOTO},t}return Et(t,e),t.prototype.render=function(){var e,t=(e={data:this.props,background:{currentBackgroundType:this.getBackgroundType(),currentPhotoUrl:this.props.photoUrl,currentBackgroundId:1}},Object(a.createStore)(C,e,i.composeWithDevTools(Object(a.applyMiddleware)(s.default))));return n.createElement(o.Provider,{store:t},n.createElement(bt,{stickers:this.props.stickers}))},t.defaultProps={originalWidth:u.default.STORY_BASE_WIDTH,originalHeight:u.default.STORY_BASE_HEIGHT},t}(n.Component);t.default=wt},"1y80":function(e,t,r){"use strict";function n(e,t,r,n,o){return window.statlogsValueEvent(e,t,r,n,o)}function o(e){return Math.random()<e}function a(e,t,r,a,i,s){o(e)&&n(t,r,a,i,s)}r.r(t),r.d(t,"statlogsValueEvent",(function(){return n})),r.d(t,"randEnabled",(function(){return o})),r.d(t,"statlogsProbValueEvent",(function(){return a}))},265:function(e,t,r){e.exports=r("8o6h")},"2mql":function(e,t,r){"use strict";var n=r("TOwV"),o={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},a={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function u(e){return n.isMemo(e)?i:s[e.$$typeof]||o}s[n.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[n.Memo]=i;var c=Object.defineProperty,l=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,p=Object.getOwnPropertyDescriptor,f=Object.getPrototypeOf,m=Object.prototype;e.exports=function e(t,r,n){if("string"!=typeof r){if(m){var o=f(r);o&&o!==m&&e(t,o,n)}var i=l(r);d&&(i=i.concat(d(r)));for(var s=u(t),h=u(r),g=0;g<i.length;++g){var v=i[g];if(!(a[v]||n&&n[v]||h&&h[v]||s&&s[v])){var _=p(r,v);try{c(t,v,_)}catch(e){}}}}return t}},"3UD+":function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},"6krn":function(e,t,r){"use strict";r.r(t),r.d(t,"getLang",(function(){return i}));var n=r("nAFc"),o=r("4+be"),a={};function i(e,t,r){void 0===t&&(t=!1);var i="number"==typeof t,s=t||i,u=e+(s?".raw":"");if(void 0===a[u]){var c=s?Object(o.getLang)(e,"raw"):Object(o.getLang)(e);"string"==typeof c?a[u]=Object(n.decodeHTMLEntities)(c):Array.isArray(c)&&(a[u]=c.map(n.decodeHTMLEntities))}if(i){var l=t;return Object(o.langNumeric)(l,a[u],r)}return a[u]||""}t.default={getLang:i}},"8o6h":function(e,t,r){"use strict";r.r(t);var n=r("qJhe");window.StoryPublisher=n.StoryPublisher;try{window.stManager.done(window.jsc("web/story_publisher.js"))}catch(e){}},ANjH:function(e,t,r){"use strict";r.r(t),r.d(t,"createStore",(function(){return s})),r.d(t,"combineReducers",(function(){return c})),r.d(t,"bindActionCreators",(function(){return d})),r.d(t,"applyMiddleware",(function(){return h})),r.d(t,"compose",(function(){return m})),r.d(t,"__DO_NOT_USE__ActionTypes",(function(){return a}));var n=r("bCCX"),o=function(){return Math.random().toString(36).substring(7).split("").join(".")},a={INIT:"@@redux/INIT"+o(),REPLACE:"@@redux/REPLACE"+o(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+o()}};function i(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function s(e,t,r){var o;if("function"==typeof t&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function");if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(s)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var u=e,c=t,l=[],d=l,p=!1;function f(){d===l&&(d=l.slice())}function m(){if(p)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return c}function h(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(p)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var t=!0;return f(),d.push(e),function(){if(t){if(p)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");t=!1,f();var r=d.indexOf(e);d.splice(r,1)}}}function g(e){if(!i(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(p)throw new Error("Reducers may not dispatch actions.");try{p=!0,c=u(c,e)}finally{p=!1}for(var t=l=d,r=0;r<t.length;r++){(0,t[r])()}return e}function v(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");u=e,g({type:a.REPLACE})}function _(){var e,t=h;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function r(){e.next&&e.next(m())}return r(),{unsubscribe:t(r)}}})[n.default]=function(){return this},e}return g({type:a.INIT}),(o={dispatch:g,subscribe:h,getState:m,replaceReducer:v})[n.default]=_,o}function u(e,t){var r=t&&t.type;return"Given "+(r&&'action "'+String(r)+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function c(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var o=t[n];0,"function"==typeof e[o]&&(r[o]=e[o])}var i,s=Object.keys(r);try{!function(e){Object.keys(e).forEach((function(t){var r=e[t];if(void 0===r(void 0,{type:a.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===r(void 0,{type:a.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+a.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}(r)}catch(e){i=e}return function(e,t){if(void 0===e&&(e={}),i)throw i;for(var n=!1,o={},a=0;a<s.length;a++){var c=s[a],l=r[c],d=e[c],p=l(d,t);if(void 0===p){var f=u(c,t);throw new Error(f)}o[c]=p,n=n||p!==d}return n?o:e}}function l(e,t){return function(){return t(e.apply(this,arguments))}}function d(e,t){if("function"==typeof e)return l(e,t);if("object"!=typeof e||null===e)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":typeof e)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var r=Object.keys(e),n={},o=0;o<r.length;o++){var a=r[o],i=e[a];"function"==typeof i&&(n[a]=l(i,t))}return n}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){p(e,t,r[t])}))}return e}function m(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function h(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(){var r=e.apply(void 0,arguments),n=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},o={getState:r.getState,dispatch:function(){return n.apply(void 0,arguments)}},a=t.map((function(e){return e(o)}));return f({},r,{dispatch:n=m.apply(void 0,a)(r.dispatch)})}}}},D2Nl:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r("JHWP")),a=r("Iwry"),i=/url\((['"]?)([^'"]+?)\1\)/g;function s(e){var t=[];return e.replace(i,(function(e,r,n){return t.push(n),e})),t.filter((function(e){return!a.isDataUrl(e)}))}function u(e,t,r,n){var i=r?function(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;var r=document.implementation.createHTMLDocument(),n=r.createElement("base"),o=r.createElement("a");return r.head.appendChild(n),r.body.appendChild(o),t&&(n.href=t),o.href=e,o.href}(t,r):t;return Promise.resolve(i).then((function(e){return o.default(e,n)})).then((function(e){return a.toDataURL(e,a.getMimeType(t))})).then((function(r){return e.replace(new RegExp("(url\\(['\"]?)("+function(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}(t)+")(['\"]?\\))","g"),"$1"+r+"$3")})).then((function(e){return e}),(function(){return i}))}function c(e){return-1!==e.search(i)}t.shouldEmbed=c,t.default=function(e,t,r){return c(e)?Promise.resolve(e).then(s).then((function(n){return n.reduce((function(e,n){return e.then((function(e){return u(e,n,t,r)}))}),Promise.resolve(e))})):Promise.resolve(e)}},Iwry:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o="application/font-woff",a={woff:o,woff2:o,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"};function i(e){var t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function s(e){var t=i(e).toLowerCase();return a[t]||""}function u(e){return new Promise((function(t,r){var n=new Image;n.onload=function(){t(n)},n.onerror=r,n.crossOrigin="anonymous",n.src=e}))}function c(e){return e.split(/,/)[1]}function l(e,t){var r=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(r.replace("px",""))}function d(){return window.devicePixelRatio||1}t.uuid=(n=0,function(){return n+=1,"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+n}),t.parseExtension=i,t.getMimeType=s,t.delay=function(e){return function(t){return new Promise((function(r){setTimeout((function(){r(t)}),e)}))}},t.createImage=u,t.isDataUrl=function(e){return-1!==e.search(/^(data:)/)},t.toDataURL=function(e,t){return"data:"+t+";base64,"+e},t.getDataURLContent=c,t.canvasToBlob=function(e){return e.toBlob?new Promise((function(t){e.toBlob(t)})):function(e){return new Promise((function(t){for(var r=window.atob(e.toDataURL().split(",")[1]),n=r.length,o=new Uint8Array(n),a=0;a<n;a+=1)o[a]=r.charCodeAt(a);t(new Blob([o],{type:"image/png"}))}))}(e)},t.toArray=function(e){for(var t=[],r=0,n=e.length;r<n;r+=1)t.push(e[r]);return t},t.getNodeWidth=function(e){var t=l(e,"border-left-width"),r=l(e,"border-right-width");return e.scrollWidth+t+r},t.getNodeHeight=function(e){var t=l(e,"border-top-width"),r=l(e,"border-bottom-width");return e.scrollHeight+t+r},t.getPixelRatio=d,t.svgToDataURL=function(e){return Promise.resolve().then((function(){return(new XMLSerializer).serializeToString(e)})).then(encodeURIComponent).then((function(e){return"data:image/svg+xml;charset=utf-8,"+e}))},t.getBlobFromImageURL=function(e){return u(e).then((function(t){var r=t.width,n=t.height,o=document.createElement("canvas"),a=o.getContext("2d"),i=d();return o.width=r*i,o.height=n*i,o.style.width=""+r,o.style.height=""+n,a.scale(i,i),a.drawImage(t,0,0),c(o.toDataURL(s(e)))}))}},JHWP:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("Iwry");t.default=function(e,t){return t.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime()),(window.fetch?window.fetch(e).then((function(e){return e.blob()})).then((function(e){return new Promise((function(t,r){var n=new FileReader;n.onloadend=function(){return t(n.result)},n.onerror=r,n.readAsDataURL(e)}))})).then(n.getDataURLContent).catch((function(){return new Promise((function(e,t){t()}))})):new Promise((function(t,r){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status){var a=new FileReader;a.onloadend=function(){t(n.getDataURLContent(a.result))},a.readAsDataURL(o.response)}else r(new Error("Failed to fetch resource: "+e+", status: "+o.status))},o.ontimeout=function(){r(new Error("Timeout of 30000ms occured while fetching resource: "+e))},o.responseType="blob",o.timeout=3e4,o.open("GET",e,!0),o.send()}))).catch((function(r){var n="";if(t.imagePlaceholder){var o=t.imagePlaceholder.split(/,/);o&&o[1]&&(n=o[1])}var a="Failed to fetch resource: "+e;return r&&(a="string"==typeof r?r:r.message),a&&console.error(a),n}))}},JX7q:function(e,t,r){"use strict";function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}r.r(t),r.d(t,"default",(function(){return n}))},PjZB:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return a}));r("rGqo"),r("a1Th"),r("Btvt");var n=r("q1tI"),o=(r("17x9"),r("pemR"));class a extends n.Component{constructor(e){super(e),this.id=Math.round(1e6*Math.random()).toString(16),this.setSpinnerParams(e)}componentWillReceiveProps(e){this.setSpinnerParams(e)}setSpinnerParams(e){this.offset=Math.round(Math.PI*e.size),this.c=.5*e.size,this.animation=function(e,t){if(!e||!t)return"";var r=Object.keys(t).map(e=>e+" {"+Object.keys(t[e]).map(r=>r+":"+t[e][r]).join(";")+"}").join("");return`@-webkit-keyframes ${e} {${r}} @keyframes ${e} {${r}}`}("dash"+this.id,{"0%":{"stroke-dashoffset":this.offset},"50%":{"stroke-dashoffset":Math.round(.25*this.offset),transform:"rotate(135deg)"},"100%":{"stroke-dashoffset":this.offset,transform:"rotate(360deg)"}})}render(){var e=this.props,t=e.style,r=e.color,a=e.size,i=e.duration,s=e.strokeWidth,u=e.className,c=this.id,l=this.offset,d=this.animation,p=Object(o.classNames)("Spinner",u);return n.createElement("div",{className:p,style:t},n.createElement("svg",{className:"Spinner__svg",width:a,height:a,viewBox:`0 0 ${a} ${a}`,xmlns:"http://www.w3.org/2000/svg"},n.createElement("g",{style:{width:a,height:a,transformOrigin:.5*a+"px "+.5*a+"px"}},n.createElement("style",{dangerouslySetInnerHTML:{__html:d}}),n.createElement("circle",{className:"Spinner__path",fill:"none",stroke:r,strokeDasharray:l,strokeDashoffset:l,strokeWidth:s,style:{animationName:"dash"+c,animationTimingFunction:"ease-in-out",animationDuration:i+"s",animationIterationCount:"infinite"},cx:.5*a,cy:.5*a,r:.5*a-.5*s}))))}}a.defaultProps={color:"#5181b8",size:19,strokeWidth:2,duration:1.4,className:""}},QLaP:function(e,t,r){"use strict";e.exports=function(e,t,r,n,o,a,i,s){if(!e){var u;if(void 0===t)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[r,n,o,a,i,s],l=0;(u=new Error(t.replace(/%s/g,(function(){return c[l++]})))).name="Invariant Violation"}throw u.framesToPop=1,u}}},SLVX:function(e,t,r){"use strict";function n(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}r.r(t),r.d(t,"default",(function(){return n}))},TBLV:function(e,t,r){"use strict";r.r(t);r("91GP"),r("ioFf"),r("rGqo"),r("Btvt");var n=r("q1tI"),o=(r("17x9"),r("pemR"));function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var s=e=>{var t=e.className,r=e.children,s=i(e,["className","children"]),u=Object(o.classNames)("Radio",t,{"Radio--disabled":e.disabled});return n.createElement("label",{className:u},n.createElement("input",a({className:"Radio__input Radio__visuallyHidden",type:"radio"},s)),n.createElement("span",{className:"Radio__control"}),Boolean(r)&&n.createElement("span",{className:"Radio__text"},r))};s.defaultProps={className:"",name:void 0,onChange:void 0,checked:void 0,defaultChecked:void 0,autoFocus:!1,disabled:!1,children:null},t.default=s},TOwV:function(e,t,r){"use strict";e.exports=r("qT12")},UlUB:function(e,t,r){"use strict";function n(e,t){var r,n,o=!1;return function a(){if(o)return r=arguments,void(n=this);e.apply(this,arguments),o=!0,setTimeout((function(){o=!1,r&&(a.apply(n,r),r=n=null)}),t)}}r.r(t),r.d(t,"throttle",(function(){return n}))},WfVW:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r("Iwry"),a=n(r("JHWP")),i=n(r("D2Nl"));function s(e,t){return e instanceof Element?Promise.resolve(e).then((function(e){return function(e,t){var r=e.style.getPropertyValue("background");return r?Promise.resolve(r).then((function(e){return i.default(e,null,t)})).then((function(t){return e.style.setProperty("background",t,e.style.getPropertyPriority("background")),e})):Promise.resolve(e)}(e,t)})).then((function(e){return function(e,t){return e instanceof HTMLImageElement&&!o.isDataUrl(e.src)?Promise.resolve(e.src).then((function(e){return a.default(e,t)})).then((function(t){return o.toDataURL(t,o.getMimeType(e.src))})).then((function(t){return new Promise((function(r,n){e.onload=r,e.onerror=n,e.src=t}))})).then((function(){return e}),(function(){return e})):Promise.resolve(e)}(e,t)})).then((function(e){return function(e,t){var r=o.toArray(e.childNodes).map((function(e){return s(e,t)}));return Promise.all(r).then((function(){return e}))}(e,t)})):Promise.resolve(e)}t.default=s},XpgC:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return c}));r("91GP");var n=r("q1tI"),o=r("i8i4"),a=(r("17x9"),r("pemR")),i=r("clTp");function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var u=e=>{var t=e.position,r=e.align,n=e.text,o=e.rect,a=e.marginTop,i=e.marginLeft,s=e.maxWidth,u=e.appearance,c=e.className,l=o.left,d=o.top;switch(t){case"t":l+=.5*o.width;break;case"r":l+=o.width,d+=.5*o.height;break;case"b":l+=.5*o.width,d+=o.height;break;case"l":d+=.5*o.height}return{tooltip:{position:t,align:r,text:n,x:l=Math.round(l+i),y:d=Math.round(d+a),maxWidth:s,appearance:u,className:c}}};class c extends n.Component{constructor(e){super(e),this.onMouseEnter=e=>{if(this.state.el){var t=this.props,r=t.text,n=t.position,o=t.align,a=t.marginTop,s=t.marginLeft,u=t.maxWidth,c=t.appearance,l=t.className,d=Object(i.default)(this.state.el);this.update({text:r,position:n,align:o,rect:d,marginTop:a,marginLeft:s,maxWidth:u,appearance:c,className:l})}},this.onMouseLeave=e=>this.update(),this.onTransitionEnd=e=>{"visibility"===e.propertyName&&this.state.tooltip&&this.setState({tooltip:void 0})},this.renderTooltip=()=>{if(!this.state.tooltip)return null;var e=this.state.tooltip,t=e.x,r=e.y,o=e.position,i=e.align,s=e.text,u=e.removed,c=e.maxWidth,l=e.appearance,d=e.className,p=Object(a.classNames)("Tooltip","Tooltip--"+o,"Tooltip--"+l,{"Tooltip--removed":!!u,["Tooltip--align-"+i]:"t"===o||"b"===o},d);return n.createElement("div",{className:p,style:{top:r,left:t},onTransitionEnd:this.onTransitionEnd},n.createElement("div",{className:"Tooltip__in",style:{maxWidth:c},dangerouslySetInnerHTML:{__html:s}}))},this.state={}}componentDidMount(){var e=o.findDOMNode(this);this.setState({el:e}),e.addEventListener("mouseenter",this.onMouseEnter),e.addEventListener("mouseleave",this.onMouseLeave)}componentWillUnmount(){this.state.el.removeEventListener("mouseenter",this.onMouseEnter),this.state.el.removeEventListener("mouseleave",this.onMouseLeave)}static getDerivedStateFromProps(e,t){return t.tooltip&&["text","position","align","maxWidth","appearance"].some(r=>e[r]!==t.tooltip[r])?u(s({},e,{rect:Object(i.default)(t.el)})):null}update(e){if(!e)return this.setState({tooltip:Object.assign({},this.state.tooltip,{removed:!0})});this.setState(u(e))}render(){var e=this.renderTooltip();return e?(this.defaultNode||"undefined"==typeof window||(this.defaultNode=document.createElement("div"),document.body.appendChild(this.defaultNode)),n.createElement(n.Fragment,null,this.props.children,o.createPortal(e,this.defaultNode))):this.props.children}}c.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,appearance:"dark"}},Ya8i:function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var o=r("Iwry"),a=n(r("D2Nl"));function i(e){if(void 0===e)return[];var t=e,r=[],n=new RegExp("(\\/\\*[\\s\\S]*?\\*\\/)","gi");t=t.replace(n,"");for(var o,a=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");null!==(o=a.exec(t));)r.push(o[0]);t=t.replace(a,"");for(var i=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");null!==(o=i.exec(t));)r.push(o[0]);return r}function s(e,t){return fetch(e).then((function(t){return{url:e,cssText:t.text()}}),(function(e){console.log("ERROR FETCHING CSS: ",e.toString())}))}function u(e){return e.cssText.then((function(t){var r=t,n=(r.match(/url\([^)]+\)/g)||[]).map((function(t){var n=t.replace(/url\(([^]+)\)/g,"$1");if(!n.startsWith("https://")){var o=e.url;n=new URL(n,o).href}return new Promise((function(e,o){fetch(n).then((function(e){return e.blob()})).then((function(n){var o=new FileReader;o.addEventListener("load",(function(n){r=r.replace(t,"url("+o.result+")"),e([t,o.result])})),o.readAsDataURL(n)})).catch(o)}))}));return Promise.all(n).then((function(){return r}))}))}function c(e){var t=[],r=[];return e.forEach((function(t){if("cssRules"in t)try{o.toArray(t.cssRules).forEach((function(e){e.type===CSSRule.IMPORT_RULE&&r.push(s(e.href).then(u).then((function(e){i(e).forEach((function(e){t.insertRule(e,t.cssRules.length)}))})).catch((function(e){console.log("Error loading remote css",e.toString())})))}))}catch(o){var n=e.find((function(e){return null===e.href}))||document.styleSheets[0];null!=t.href&&r.push(s(t.href).then(u).then((function(e){i(e).forEach((function(e){n.insertRule(e,t.cssRules.length)}))})).catch((function(e){console.log("Error loading remote stylesheet",e.toString())}))),console.log("Error inlining remote css file",o.toString())}})),Promise.all(r).then((function(){return e.forEach((function(e){if("cssRules"in e)try{o.toArray(e.cssRules).forEach((function(e){t.push(e)}))}catch(t){console.log("Error while reading CSS rules from "+e.href,t.toString())}})),t}))}function l(e){return e.filter((function(e){return e.type===CSSRule.FONT_FACE_RULE})).filter((function(e){return a.shouldEmbed(e.style.getPropertyValue("src"))}))}function d(e){return new Promise((function(t,r){e.ownerDocument||r(new Error("Provided element is not within a Document")),t(o.toArray(e.ownerDocument.styleSheets))})).then(c).then(l)}t.parseWebFontRules=d,t.default=function(e,t){return d(e).then((function(e){return Promise.all(e.map((function(e){var r=e.parentStyleSheet?e.parentStyleSheet.href:null;return a.default(e.cssText,r,t)})))})).then((function(e){return e.join("\n")})).then((function(t){var r=document.createElement("style"),n=document.createTextNode(t);return r.appendChild(n),e.firstChild?e.insertBefore(r,e.firstChild):e.appendChild(r),e}))}},bCCX:function(e,t,r){"use strict";r.r(t),function(e,n){var o,a=r("SLVX");o="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:n;var i=Object(a.default)(o);t.default=i}.call(this,r("yLpj"),r("3UD+")(e))},clTp:function(e,t,r){"use strict";function n(e){var t=e.getBoundingClientRect(),r=document.body,n=document.documentElement,o=window.pageYOffset||n.scrollTop||r.scrollTop,a=window.pageXOffset||n.scrollLeft||r.scrollLeft,i=n.clientTop||r.clientTop||0,s=n.clientLeft||r.clientLeft||0;return{top:Math.round(t.top+o-i),left:Math.round(t.left+a-s),width:e.offsetWidth,height:e.offsetHeight}}r.r(t),r.d(t,"default",(function(){return n}))},dI71:function(e,t,r){"use strict";function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}r.r(t),r.d(t,"default",(function(){return n}))},mYgU:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r("yOtm")),a=n(r("Ya8i")),i=n(r("WfVW")),s=n(r("xkiS")),u=n(r("t0N9")),c=r("Iwry");function l(e,t){return void 0===t&&(t={}),{width:t.width||c.getNodeWidth(e),height:t.height||c.getNodeHeight(e)}}function d(e,t){void 0===t&&(t={});var r=l(e,t),n=r.width,c=r.height;return o.default(e,t.filter,!0).then((function(e){return a.default(e,t)})).then((function(e){return i.default(e,t)})).then((function(e){return u.default(e,t)})).then((function(e){return s.default(e,n,c)}))}function p(e,t){return void 0===t&&(t={}),d(e,t).then(c.createImage).then(c.delay(100)).then((function(r){var n=document.createElement("canvas"),o=n.getContext("2d"),a=c.getPixelRatio(),i=l(e,t),s=i.width,u=i.height;return n.width=s*a,n.height=u*a,n.style.width=""+s,n.style.height=""+u,o.scale(a,a),t.backgroundColor&&(o.fillStyle=t.backgroundColor,o.fillRect(0,0,n.width,n.height)),o.drawImage(r,0,0),n}))}function f(e,t){void 0===t&&(t={});var r=l(e,t),n=r.width,o=r.height;return p(e,t).then((function(e){return e.getContext("2d").getImageData(0,0,n,o).data}))}function m(e,t){return void 0===t&&(t={}),p(e,t).then((function(e){return e.toDataURL()}))}function h(e,t){return void 0===t&&(t={}),p(e,t).then((function(e){return e.toDataURL("image/jpeg",t.quality||1)}))}function g(e,t){return void 0===t&&(t={}),p(e,t).then(c.canvasToBlob)}t.toSvgDataURL=d,t.toCanvas=p,t.toPixelData=f,t.toPng=m,t.toJpeg=h,t.toBlob=g,t.default={toSvgDataURL:d,toCanvas:p,toPixelData:f,toPng:m,toJpeg:h,toBlob:g}},qJhe:function(e,t,r){"use strict";r.r(t),r.d(t,"StoryPublisher",(function(){return v}));var n,o=r("q1tI"),a=r("i8i4"),i=r("0fW4"),s=r("jE6c"),u=r("EasH"),c=r("6krn"),l=r("3oLO"),d=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),p=r("r7nW").default,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.errorHandler=function(e,t){var r=e||Object(c.getLang)("global_error");window.showFastBox({title:Object(c.getLang)("global_error")},r,Object(c.getLang)("global_close"),(function(){t(),window.curBox().hide()}))},t.save=function(e,r,n){void 0===n&&(n={}),t.props.onClickSave(),l.ajax.post("al_stories.php",{act:"get_upload_url",attachment:JSON.stringify(t.props.attachment),clickable_stickers:n.clickableStickers,mini_app_id:t.props.miniAppId,analytics:n.analytics,hash:n.storyUploadUrlHash,entry_point:t.props.entrypoint,ref:window.cur.module},{onDone:function(o){t.sendToServer(e,o,n.storySaveHash,r)},onFail:function(e){return t.errorHandler(e,r),!0}})},t.sendToServer=function(e,r,n,o){var a=new FormData,i=encodeURIComponent("edited_"+Object(s.irand)(0,99999)+".jpg");a.append("file0",e,i),fetch(r,{method:"POST",body:a}).then((function(e){return e.json()})).then((function(e){var r=e.response.upload_result;t.saveOnServer(r,n,o)})).catch((function(e){console.error(e)}))},t.saveOnServer=function(e,r,n){l.ajax.post("al_stories.php",{act:"save",upload_result:e,hash:r},{onDone:function(e){t.onClose(!0,!1,e),n()},onFail:function(){return t.errorHandler("",n),!0}})},t.onClose=function(e,r,n){r?t.props.onClose(!1):e?(window.Stories&&window.Stories.updateFeedStories&&window.Stories.updateFeedStories(),t.props.onClose(!0,n)):t.box?(t.box.hide(),delete t.box):t.box=Object(u.showFastBox)({title:Object(c.getLang)("photos_pe_are_you_sure_close_title"),bodyStyle:"padding: 20px; line-height: 160%;",dark:1,forceNoBtn:1,onShow:function(){window.cur._noEscHide=!0},onClean:function(){window.cur._noEscHide=!1}},Object(c.getLang)("photos_pe_are_you_sure_close_text"),Object(c.getLang)("box_yes"),(function(){t.props.onClose(!1),t.box.hide()}),Object(c.getLang)("box_no"))},t}return d(t,e),t.prototype.render=function(){var e=this,t=window.innerHeight-100,r=t/1.78;return o.createElement(p,{disableBodyScroll:!0,onClose:function(){return e.onClose()}},o.createElement(i.default,{context:"story",photoUrl:this.props.photoUrl,artboardWidth:r,artboardHeight:t,save:this.save,close:function(){return e.onClose()},attachment:this.props.attachment,stickers:this.props.stickers}))},t}(o.Component),m=r("ufMw"),h=r("kcIO"),g=r("4+be"),v={init:function(e,t,r){var n=this;this.onClickSave=t||function(){},this.cb=r,this.loadStatic().then((function(){n.render(e)})).catch((function(e){console.error(e)}))},loadStatic:function(){return window.stManager.add([window.jsc("web/story_publisher.js"),"photo_editor.css"])},render:function(e){var t=(null==e?void 0:e.entrypoint)||"",r=(null==e?void 0:e.miniAppId)||0;window.cur.storyPublishContext=!0,"story_repost"===t?Object(m.sendStat)(m.EVENTS.ADD_STORY_FROM_SHARING):Object(m.sendStat)(m.EVENTS.ADD_STORY);var n=document.querySelector(".StoryPublisher");n||((n=document.createElement("div")).classList.add("StoryPublisher"),document.body.append(n)),a.render(o.createElement(f,{entrypoint:t,miniAppId:r,onClose:this.destroy.bind(this),onClickSave:this.onClickSave.bind(this),photoUrl:null==e?void 0:e.photoUrl,attachment:null==e?void 0:e.attachment,stickers:null==e?void 0:e.stickers}),n)},destroy:function(e,t){var r=document.querySelector(".StoryPublisher");r&&a.unmountComponentAtNode(r),this.cb&&this.cb(e,t),e&&Object(h.showDoneBox)(Object(g.getLang)("photos_pe_story_published"))}}},qT12:function(e,t,r){"use strict";var n="function"==typeof Symbol&&Symbol.for,o=n?Symbol.for("react.element"):60103,a=n?Symbol.for("react.portal"):60106,i=n?Symbol.for("react.fragment"):60107,s=n?Symbol.for("react.strict_mode"):60108,u=n?Symbol.for("react.profiler"):60114,c=n?Symbol.for("react.provider"):60109,l=n?Symbol.for("react.context"):60110,d=n?Symbol.for("react.async_mode"):60111,p=n?Symbol.for("react.concurrent_mode"):60111,f=n?Symbol.for("react.forward_ref"):60112,m=n?Symbol.for("react.suspense"):60113,h=n?Symbol.for("react.suspense_list"):60120,g=n?Symbol.for("react.memo"):60115,v=n?Symbol.for("react.lazy"):60116,_=n?Symbol.for("react.block"):60121,y=n?Symbol.for("react.fundamental"):60117,x=n?Symbol.for("react.responder"):60118,b=n?Symbol.for("react.scope"):60119;function E(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case o:switch(e=e.type){case d:case p:case i:case u:case s:case m:return e;default:switch(e=e&&e.$$typeof){case l:case f:case v:case g:case c:return e;default:return t}}case a:return t}}}function w(e){return E(e)===p}t.AsyncMode=d,t.ConcurrentMode=p,t.ContextConsumer=l,t.ContextProvider=c,t.Element=o,t.ForwardRef=f,t.Fragment=i,t.Lazy=v,t.Memo=g,t.Portal=a,t.Profiler=u,t.StrictMode=s,t.Suspense=m,t.isAsyncMode=function(e){return w(e)||E(e)===d},t.isConcurrentMode=w,t.isContextConsumer=function(e){return E(e)===l},t.isContextProvider=function(e){return E(e)===c},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===o},t.isForwardRef=function(e){return E(e)===f},t.isFragment=function(e){return E(e)===i},t.isLazy=function(e){return E(e)===v},t.isMemo=function(e){return E(e)===g},t.isPortal=function(e){return E(e)===a},t.isProfiler=function(e){return E(e)===u},t.isStrictMode=function(e){return E(e)===s},t.isSuspense=function(e){return E(e)===m},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===i||e===p||e===u||e===s||e===m||e===h||"object"==typeof e&&null!==e&&(e.$$typeof===v||e.$$typeof===g||e.$$typeof===c||e.$$typeof===l||e.$$typeof===f||e.$$typeof===y||e.$$typeof===x||e.$$typeof===b||e.$$typeof===_)},t.typeOf=E},r7nW:function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),o=r("i8i4"),a=(r("17x9"),r("pemR"));class i extends n.Component{constructor(){super(...arguments),this.getScrollbarWidth=()=>{var e=document.createElement("div");e.classList.add("BaseModal__scrollbarMeasure"),document.body.appendChild(e);var t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t},this.hideScrollBar=()=>{var e=document.body.getBoundingClientRect(),t=e.left+e.right<window.innerWidth,r=this.getScrollbarWidth();this.calculatedPadding=window.getComputedStyle(document.body)["padding-right"],t&&(document.body.style.paddingRight=parseFloat(this.calculatedPadding)+r+"px"),document.body.classList.add("BaseModal__bodyHiddenOverflow")},this.showScrollBar=()=>{document.body.style.paddingRight=this.calculatedPadding,document.body.classList.remove("BaseModal__bodyHiddenOverflow")},this.onDocumentKeyDown=e=>{var t=this.props.onClose;"Escape"===e.key&&t()},this.onBackdropClick=()=>{var e=this.props,t=e.onClose;!e.disableBackdropClick&&t()}}componentDidMount(){var e=this.props,t=e.disableEscapeClose,r=e.disableBodyScroll;t||document.body.addEventListener("keydown",this.onDocumentKeyDown),r&&this.hideScrollBar()}componentWillUnmount(){var e=this.props,t=e.disableEscapeClose,r=e.disableBodyScroll;t||document.body.removeEventListener("keydown",this.onDocumentKeyDown),r&&this.showScrollBar()}renderModal(){var e=this.props.className,t=Object(a.classNames)("BaseModal",e);return n.createElement("div",{className:t,"aria-modal":"true"},n.createElement("div",{className:"BaseModal__backdrop",onClick:this.onBackdropClick}),n.createElement("div",{className:"BaseModal__content"},this.props.children))}render(){return o.createPortal(this.renderModal(),document.body)}}i.defaultProps={className:"",children:null,disableBackdropClick:!1,disableEscapeClose:!1,disableBodyScroll:!1},t.default=i},sINF:function(e,t,r){"use strict";function n(e){return function(t){var r=t.dispatch,n=t.getState;return function(t){return function(o){return"function"==typeof o?o(r,n,e):t(o)}}}}r.r(t);var o=n();o.withExtraArgument=n,t.default=o},t0N9:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var r=e.style;return t.backgroundColor&&(r.backgroundColor=t.backgroundColor),t.width&&(r.width=t.width+"px"),t.height&&(r.height=t.height+"px"),t.style&&Object.assign(r,t.style),e}},ufMw:function(e,t,r){"use strict";r.r(t),r.d(t,"EVENTS",(function(){return s})),r.d(t,"sendStat",(function(){return u})),r.d(t,"prepareStat",(function(){return c}));var n=r("1y80"),o=r("98sY"),a=r("xYVc"),i=r("W9Tc"),s={ADD_STORY:"add_story",ADD_STORY_FROM_SHARING:"add_story_from_sharing",CLICK_TO_CAMERA_ICON:"click_to_camera_icon",CLICK_TO_GRADIENT_ICON:"click_to_gradient_icon",ADD_TEXT:"add_text",EDIT_TEXT:"edit_text",DELETE_TEXT:"delete_text",ADD_STICKER:"add_sticker",DELETE_STICKER:"delete_sticker",ADD_GRAFFITI:"add_graffiti",CANCEL_GRAFFITI:"cancel_graffiti",SELECT_BACKGROUND:"select_background"};function u(e){if(window.cur.storyPublishContext){var t={event_type:e,story_type:"photo"};Object(i.partConfigEnabled)("story_publish_analytics_log")&&Object(o.debugLog)(t),Object(n.statlogsValueEvent)("story_create_product_analytics",t)}}function c(e,t,r,n){var o=0,i="photo";r===a.default.BACKGROUND_MODES.BACKGROUND&&(i=(o=n)>100?"emojies":"gradients");var s={has_text:0,has_sticker:0,has_graffiti:0,background_type:i,background_id:o},u=[],c=[],l=[];return e.forEach((function(e){if(e.type===a.default.LAYER_TYPES.STICKER){var t=(i=e).id.split("_"),r=t[0],n=t[1],o=parseInt(r);u.push({id:parseInt(n),pack_id:o||0,type:o?"from_pack":"individual"})}else if(e.type===a.default.LAYER_TYPES.TEXT){var i=e;c.push({text:i.text,font:i.fontStyle,size:Math.round(i.fontSize*a.default.FONT_SIZE_COEFFICIENT),color:i.color.slice(1),background:"none",align:"center"})}})),c.length&&(s.has_text=1,s.texts=c),u.length&&(s.has_sticker=1,s.stickers=u),t.forEach((function(e){l.push({brush:e.opacity,size:e.width,color:e.color.slice(1)})})),l.length&&(s.has_graffiti=1,s.graffities=l),s}},vRp6:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return c}));r("HEwt"),r("a1Th"),r("Btvt"),r("rGqo"),r("rE2o"),r("ioFf");var n=r("q1tI"),o=(r("17x9"),r("UlUB")),a=r("PjZB"),i=r("pemR");function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw a}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}class c extends n.Component{constructor(e){super(e),this.checkLoad=Object(o.throttle)(e=>{var t=s(e,3),r=t[0],n=t[1],o=t[2];if(!this.loading)return this.props.virtualized||this.props.hasMore?void(n-r-o<=this.props.threshold&&(this.loading=!0,this.props.loadMore().then(()=>{this.loading=!1}))):this.detachListeners()},34),this.onScroll=e=>{var t=this.getScrollData();this.props.virtualized&&this.processChildren(this.props.children,t),this.props.hasMore&&this.checkLoad(t)},this.getRef=e=>{this.container=e,this.props.virtualized&&this.setState(this.getChildrenData(this.props.children,this.getScrollData()))},this.useWindowScroll=e.useWindowScroll,e.virtualized&&(this.state={before:0,after:e.children.length,start:0,end:0})}getScrollData(){var e=this.useWindowScroll?document.documentElement:this.container;return[this.getScrollTop(),e?e.scrollHeight:0,e?e.clientHeight:0]}getScrollTop(){var e=document.documentElement||document.body.parentNode||document.body;return this.useWindowScroll?void 0!==window.pageYOffset?window.pageYOffset:e.scrollTop:this.container?this.container.scrollTop:0}attachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.addEventListener("scroll",this.onScroll,this.props.useCapture),e.addEventListener("resize",this.onScroll,this.props.useCapture))}detachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.removeEventListener("scroll",this.onScroll,this.props.useCapture),e.removeEventListener("resize",this.onScroll,this.props.useCapture))}processChildren(e,t){var r=this.state,n=this.getChildrenData(e,t||this.getScrollData()),o=n.start,a=n.end,i=n.before,s=n.after;o===r.start&&a===r.end&&i===r.before&&s===r.after||this.setState(n)}getChildrenData(e,t){var r=s(t,3),n=r[0],o=r[1],a=r[2],i=this.useWindowScroll?window:this.container,u=i&&i.offsetHeight;if(!i||0===o||0===a)return{start:0,end:0,before:0,after:e.length};a=Math.max(a,u);var c=e.length,l=Math.max(Math.floor(n/this.props.itemHeight)-1,0),d=Math.min(Math.floor((n+2*a)/this.props.itemHeight+1),c);return{start:l,end:d,before:l,after:c-d}}componentWillReceiveProps(e){this.props.virtualized&&this.processChildren(e.children)}componentDidMount(){this.attachListeners()}componentWillUnmount(){this.detachListeners()}render(){return n.createElement("div",{className:Object(i.classNames)("InfiniteScroll",this.props.className),ref:this.getRef,style:this.props.style},this.props.virtualized&&this.state.before>0&&n.createElement("div",{style:{height:this.state.before*this.props.itemHeight},key:"before"}),this.props.virtualized?[].concat(this.props.children).slice(this.state.start,this.state.end):this.props.children,this.props.virtualized&&this.state.after>0&&n.createElement("div",{style:{height:this.state.after*this.props.itemHeight},key:"after"}),this.props.hasMore&&(this.props.loader||n.createElement("div",{className:"InfiniteScroll__loader",key:"loader"},n.createElement(a.default,null))))}}c.defaultProps={useWindowScroll:!1,virtualized:!1,hasMore:!0,useCapture:!1,threshold:100,itemHeight:55}},vTYg:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("Iwry");function o(e,t,r){var o="."+e+":"+t,a=r.cssText?function(e){var t=e.getPropertyValue("content");return e.cssText+" content: "+t+";"}(r):function(e){return n.toArray(e).map((function(t){return t+": "+e.getPropertyValue(t)+(e.getPropertyPriority(t)?" !important":"")+";"})).join(" ")}(r);return document.createTextNode(o+"{"+a+"}")}t.default=function(e,t){[":before",":after"].forEach((function(r){return function(e,t,r){var a=window.getComputedStyle(e,r),i=a.getPropertyValue("content");if(""!==i&&"none"!==i){var s=n.uuid(),u=document.createElement("style");u.appendChild(o(s,r,a)),t.className=t.className+" "+s,t.appendChild(u)}}(e,t,r)}))}},wx14:function(e,t,r){"use strict";function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}r.r(t),r.d(t,"default",(function(){return n}))},xYVc:function(e,t,r){"use strict";r.r(t);var n=r("t7n3");t.default={TABS:{STICKERS:"stickers",TEXT:"text",PAINT:"paint",CROP:"crop",FILTERS:"filters",COLOR:"color"},BACKGROUND_MODES:{PHOTO:"photo",BACKGROUND:"background"},STORY_BASE_WIDTH:1080,STORY_BASE_HEIGHT:1920,BOTTOM_PANEL_HEIGHT:50,CANVAS_SCALE:Object(n.isRetina)()?2:1,STICKER_SMALL:64,STICKER_MEDIUM:Object(n.isRetina)()?256:128,STICKER_LARGE:512,COLORS:["#FFFFFF","#000000","#E64646","#FF9300","#FFCB00","#62DA37","#00AEF9","#CC74E1"],FONTS:["classic","cursive","marker","italics","typewriter","poster","retro"],BRUSH_WIDTH_COEFFICIENT:40,FONT_SIZE_COEFFICIENT:100,PHOTO_FILTERS:["regular","nox","vesper","latona","liber","luna","minerva","mitra","pro","terra","veles","vesta","zaria","sepia","genius","horus","fortuna"],COLOR_CORRECTION:["exposure","brightness","contrast","saturation","vignette","sharpness","warmth"],LAYER_TYPES:{STICKER:"sticker",TEXT:"text",IMAGE:"image"},LAYER_MIN_SIZE:30,LAYER_DEFAULT_SIZE:128,CONTEXT_TYPES:{PHOTO:"photo",STORY:"story"},FILTER_PREVIEW_WIDTH:127,FILTER_PREVIEW_HEIGHT:90}},xkiS:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("Iwry");t.default=function(e,t,r){var o="http://www.w3.org/2000/svg",a=document.createElementNS(o,"svg"),i=document.createElementNS(o,"foreignObject");return a.setAttributeNS("","width",""+t),a.setAttributeNS("","height",""+r),i.setAttributeNS("","width","100%"),i.setAttributeNS("","height","100%"),i.setAttributeNS("","x","0"),i.setAttributeNS("","y","0"),i.setAttributeNS("","externalResourcesRequired","true"),a.appendChild(i),i.appendChild(e),n.svgToDataURL(a)}},yOtm:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r("Iwry"),a=n(r("vTYg"));function i(e){return e instanceof HTMLCanvasElement?o.createImage(e.toDataURL()):e.tagName&&"svg"===e.tagName.toLowerCase()?Promise.resolve(e).then((function(e){return o.svgToDataURL(e)})).then(o.createImage):Promise.resolve(e.cloneNode(!1))}function s(e,t){return t instanceof Element?Promise.resolve().then((function(){return function(e,t){var r=window.getComputedStyle(e),n=t.style;r.cssText?n.cssText=r.cssText:o.toArray(r).forEach((function(e){n.setProperty(e,r.getPropertyValue(e),r.getPropertyPriority(e))}))}(e,t)})).then((function(){return a.default(e,t)})).then((function(){return function(e,t){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}(e,t)})).then((function(){return t})):t}function u(e,t,r){return r||!t||t(e)?Promise.resolve(e).then(i).then((function(r){return function(e,t,r){var n=o.toArray(e.childNodes);return 0===n.length?Promise.resolve(t):n.reduce((function(e,n){return e.then((function(){return u(n,r)})).then((function(e){e&&t.appendChild(e)}))}),Promise.resolve()).then((function(){return t}))}(e,r,t)})).then((function(t){return s(e,t)})):Promise.resolve(null)}t.default=u},zLVn:function(e,t,r){"use strict";function n(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}r.r(t),r.d(t,"default",(function(){return n}))}});