!function(t){function e(e){for(var s,a,n=e[0],l=e[1],d=e[2],h=0,p=[];h<n.length;h++)a=n[h],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&p.push(i[a][0]),i[a]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(t[s]=l[s]);for(c&&c(e);p.length;)p.shift()();return o.push.apply(o,d||[]),r()}function r(){for(var t,e=0;e<o.length;e++){for(var r=o[e],s=!0,n=1;n<r.length;n++){var l=r[n];0!==i[l]&&(s=!1)}s&&(o.splice(e--,1),t=a(a.s=r[0]))}return t}var s={},i={"web/pretty_cards":0},o=[];function a(e){if(s[e])return s[e].exports;var r=s[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=t,a.c=s,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)a.d(r,s,function(e){return t[e]}.bind(null,s));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/js/cmodules/";var n=window.webpackJsonp=window.webpackJsonp||[],l=n.push.bind(n);n.push=e,n=n.slice();for(var d=0;d<n.length;d++)e(n[d]);var c=l;o.push([235,"bundles/common"]),r()}({"+B+J":function(t,e,r){"use strict";r.r(e);var s=r("yRDP");window.PrettyCardGallery=s.PrettyCardGallery;try{window.stManager.done(window.jsc("web/pretty_cards.js"))}catch(t){}},235:function(t,e,r){t.exports=r("+B+J")},jYEY:function(t,e,r){var s;!function(i){"use strict";function o(t,e){var r=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(r>>16)<<16|65535&r}function a(t,e,r,s,i,a){return o((n=o(o(e,t),o(s,a)))<<(l=i)|n>>>32-l,r);var n,l}function n(t,e,r,s,i,o,n){return a(e&r|~e&s,t,e,i,o,n)}function l(t,e,r,s,i,o,n){return a(e&s|r&~s,t,e,i,o,n)}function d(t,e,r,s,i,o,n){return a(e^r^s,t,e,i,o,n)}function c(t,e,r,s,i,o,n){return a(r^(e|~s),t,e,i,o,n)}function h(t,e){var r,s,i,a,h;t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;var p=1732584193,_=-271733879,g=-1732584194,u=271733878;for(r=0;r<t.length;r+=16)s=p,i=_,a=g,h=u,p=n(p,_,g,u,t[r],7,-680876936),u=n(u,p,_,g,t[r+1],12,-389564586),g=n(g,u,p,_,t[r+2],17,606105819),_=n(_,g,u,p,t[r+3],22,-1044525330),p=n(p,_,g,u,t[r+4],7,-176418897),u=n(u,p,_,g,t[r+5],12,1200080426),g=n(g,u,p,_,t[r+6],17,-1473231341),_=n(_,g,u,p,t[r+7],22,-45705983),p=n(p,_,g,u,t[r+8],7,1770035416),u=n(u,p,_,g,t[r+9],12,-1958414417),g=n(g,u,p,_,t[r+10],17,-42063),_=n(_,g,u,p,t[r+11],22,-1990404162),p=n(p,_,g,u,t[r+12],7,1804603682),u=n(u,p,_,g,t[r+13],12,-40341101),g=n(g,u,p,_,t[r+14],17,-1502002290),p=l(p,_=n(_,g,u,p,t[r+15],22,1236535329),g,u,t[r+1],5,-165796510),u=l(u,p,_,g,t[r+6],9,-1069501632),g=l(g,u,p,_,t[r+11],14,643717713),_=l(_,g,u,p,t[r],20,-373897302),p=l(p,_,g,u,t[r+5],5,-701558691),u=l(u,p,_,g,t[r+10],9,38016083),g=l(g,u,p,_,t[r+15],14,-660478335),_=l(_,g,u,p,t[r+4],20,-405537848),p=l(p,_,g,u,t[r+9],5,568446438),u=l(u,p,_,g,t[r+14],9,-1019803690),g=l(g,u,p,_,t[r+3],14,-187363961),_=l(_,g,u,p,t[r+8],20,1163531501),p=l(p,_,g,u,t[r+13],5,-1444681467),u=l(u,p,_,g,t[r+2],9,-51403784),g=l(g,u,p,_,t[r+7],14,1735328473),p=d(p,_=l(_,g,u,p,t[r+12],20,-1926607734),g,u,t[r+5],4,-378558),u=d(u,p,_,g,t[r+8],11,-2022574463),g=d(g,u,p,_,t[r+11],16,1839030562),_=d(_,g,u,p,t[r+14],23,-35309556),p=d(p,_,g,u,t[r+1],4,-1530992060),u=d(u,p,_,g,t[r+4],11,1272893353),g=d(g,u,p,_,t[r+7],16,-155497632),_=d(_,g,u,p,t[r+10],23,-1094730640),p=d(p,_,g,u,t[r+13],4,681279174),u=d(u,p,_,g,t[r],11,-358537222),g=d(g,u,p,_,t[r+3],16,-722521979),_=d(_,g,u,p,t[r+6],23,76029189),p=d(p,_,g,u,t[r+9],4,-640364487),u=d(u,p,_,g,t[r+12],11,-421815835),g=d(g,u,p,_,t[r+15],16,530742520),p=c(p,_=d(_,g,u,p,t[r+2],23,-995338651),g,u,t[r],6,-198630844),u=c(u,p,_,g,t[r+7],10,1126891415),g=c(g,u,p,_,t[r+14],15,-1416354905),_=c(_,g,u,p,t[r+5],21,-57434055),p=c(p,_,g,u,t[r+12],6,1700485571),u=c(u,p,_,g,t[r+3],10,-1894986606),g=c(g,u,p,_,t[r+10],15,-1051523),_=c(_,g,u,p,t[r+1],21,-2054922799),p=c(p,_,g,u,t[r+8],6,1873313359),u=c(u,p,_,g,t[r+15],10,-30611744),g=c(g,u,p,_,t[r+6],15,-1560198380),_=c(_,g,u,p,t[r+13],21,1309151649),p=c(p,_,g,u,t[r+4],6,-145523070),u=c(u,p,_,g,t[r+11],10,-1120210379),g=c(g,u,p,_,t[r+2],15,718787259),_=c(_,g,u,p,t[r+9],21,-343485551),p=o(p,s),_=o(_,i),g=o(g,a),u=o(u,h);return[p,_,g,u]}function p(t){var e,r="",s=32*t.length;for(e=0;e<s;e+=8)r+=String.fromCharCode(t[e>>5]>>>e%32&255);return r}function _(t){var e,r=[];for(r[(t.length>>2)-1]=void 0,e=0;e<r.length;e+=1)r[e]=0;var s=8*t.length;for(e=0;e<s;e+=8)r[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return r}function g(t){var e,r,s="";for(r=0;r<t.length;r+=1)e=t.charCodeAt(r),s+="0123456789abcdef".charAt(e>>>4&15)+"0123456789abcdef".charAt(15&e);return s}function u(t){return unescape(encodeURIComponent(t))}function y(t){return function(t){return p(h(_(t),8*t.length))}(u(t))}function b(t,e){return function(t,e){var r,s,i=_(t),o=[],a=[];for(o[15]=a[15]=void 0,i.length>16&&(i=h(i,8*t.length)),r=0;r<16;r+=1)o[r]=909522486^i[r],a[r]=1549556828^i[r];return s=h(o.concat(_(e)),512+8*e.length),p(h(a.concat(s),640))}(u(t),u(e))}function C(t,e,r){return e?r?b(e,t):g(b(e,t)):r?y(t):g(y(t))}void 0===(s=function(){return C}.call(e,r,e,t))||(t.exports=s)}()},yRDP:function(t,e,r){"use strict";r.r(e),r.d(e,"PrettyCardGallery",(function(){return p}));r("rE2o"),r("ioFf"),r("HEwt"),r("a1Th"),r("KKXr"),r("Oyvg"),r("pIFo"),r("rGqo"),r("Btvt");var s=r("zxIV"),i=r("t7n3"),o=r("v+DW"),a=r("EasH"),n=r("FWc3"),l=r("4+be"),d=r("jYEY");function c(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h(t,e)}(t))){var e=0,r=function(){};return{s:r,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i,o=!0,a=!1;return{s:function(){s=t[Symbol.iterator]()},n:function(){var t=s.next();return o=t.done,t},e:function(t){a=!0,i=t},f:function(){try{o||null==s.return||s.return()}finally{if(a)throw i}}}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,s=new Array(e);r<e;r++)s[r]=t[r];return s}class p{constructor(t,e,r){if(!t.prettyCardsInitialized){if(t.prettyCardsInitialized=!0,t.removeAttribute("onmouseenter"),this.VIEWPORT_CARDS=2,this.CARD_WIDTH=200,this.CARDS_MARGIN=12,this.CONTENT_PADDING=13,this.POST_PADDING=20,this.POST_PADDING_TOP=15,this.TRANSFORM_ANIMATION_DURATION=300,this.TRANSFORM_ANIMATION_DURATION_LONG=600,this.TRANSFORM_ANIMATION_DELAY=100,this.el=t,this.scrollerLeft=Object(s.geByClass1)("pretty-cards__scroller_position_left",t),this.scrollerRight=Object(s.geByClass1)("pretty-cards__scroller_position_right",t),this.scrollerProtector=Object(s.geByClass1)("pretty-cards__scroller_type_protector",t),this.wrapper=Object(s.geByClass1)("pretty-cards__wrapper",t),this.wrapperOuter=Object(s.geByClass1)("pretty-cards__wrapper-outer",t),this.scrollPosition=0,this.cardsElements=geByClass("pretty-card",t),this.buttonEditorDropdown=Object(s.geByClass1)("pretty-card__button-dropdown",t),this.container=Object(s.geByClass1)("pretty-cards__container",t),this.newCardsId=-1,this.lastChosenUrl="",this.options=extend({},e||{}),this.adPixelData=this.getAdPixelData(),this.options.editing&&this.addPlaceholder(),r)for(var i=0,o=Object.keys(r);i<o.length;i++){var a=o[i];this.addCard(r[a]),r[a].link&&(this.lastChosenUrl=r[a].link)}this.initEvents(),this.scroll(0,!1),this.options.editing&&this.updateSendDataHash()}}initEvents(){if(this.scrollerLeft&&(addEvent(this.scrollerLeft,"click",this.scroll.bind(this,-1,!1)),addEvent(this.scrollerLeft,"mouseenter",this.onScrollerMouseEnter.bind(this,-1)),addEvent(this.scrollerLeft,"mouseleave",this.onScrollerMouseLeave.bind(this,-1))),this.scrollerRight&&(addEvent(this.scrollerRight,"click",this.scroll.bind(this,1,!1)),addEvent(this.scrollerRight,"mouseenter",this.onScrollerMouseEnter.bind(this,1)),addEvent(this.scrollerRight,"mouseleave",this.onScrollerMouseLeave.bind(this,1))),addEvent(this.scrollerProtector,"mouseout",hide.pbind(this.scrollerProtector)),addEvent(this.container,"mousemove",this.onDraggingMouseMove.bind(this)),addEvent(this.buttonEditorDropdown,"mouseover",Page.actionsDropdownUnhide),addEvent(this.buttonEditorDropdown,"mouseout",Page.actionsDropdownHide.bind(this,this.buttonEditorDropdown)),this.scrollerLeft&&this.scrollerRight){var t=function(){this.lastWinOnScroll=vkNow()}.bind(this);addEvent(window,"scroll",t),addEvent(this.wrapperOuter,"scroll",this.onWrapperScroll.bind(this)),cur.destroy.push((function(){removeEvent(window,"scroll",t)}))}addEvent(this.wrapper,"click",t=>this.onCardsClick(t));var e={root:null,rootMargin:"0px",threshold:1};this.cardsElements.forEach(t=>this.createCardObserver(t,"impression",e))}onWrapperScroll(){if(!(vkNow()-this.lastWinOnScroll<300)){var t=this.wrapperOuter.scrollLeft,e=this.cardsElements.length*this.CARD_WIDTH+Math.max(0,this.cardsElements.length-1)*this.CARDS_MARGIN;this.cardsPos=Math.max(0,Math.min(t,e-this.wrapperOuter.clientWidth)),this.scrollPosition+=Math.round(this.cardsPos/(this.CARD_WIDTH-this.CARDS_MARGIN))-this.scrollPosition,this.scrollPosition=Math.max(0,this.scrollPosition),this.scrollPosition=Math.max(0,Math.min(this.cardsElements.length-this.VIEWPORT_CARDS,this.scrollPosition));var r=e-this.wrapperOuter.clientWidth-this.cardsPos-this.POST_PADDING,i=this.cardsPos-this.POST_PADDING;toggleClass(this.scrollerRight,"pretty-cards__scroller_hidden_right",r<0),toggleClass(this.scrollerLeft,"pretty-cards__scroller_hidden_left",i<0),Object(s.addClass)(this.scrollerProtector,"pretty-cards__scroller_position_right",0),show(this.scrollerProtector)}}onScrollerMouseEnter(t){this.draggingCard&&(this.blockDraggingSwitch=!0,this.wrapperTransitions(!0,this.draggingCard),this.scroll(t,!0),setTimeout(this.wrapperTransitions.bind(this,!1,this.draggingCard),this.TRANSFORM_ANIMATION_DURATION_LONG))}onScrollerMouseLeave(t){this.draggingCard&&(this.blockDraggingSwitch=!1)}onDraggingMouseMove(t){if(this.draggingCard&&!this.blockDragging){var e=t.clientX-this.draggingStartingX+(this.translateX-this.draggingStartingTranslateX);if(setStyle(this.draggingCard,{transform:"translateY(10px) scale(1.05) translateX("+e+"px)"}),!this.blockDraggingSwitch){var r=(t.clientX-this.draggingContainerX+this.translateX+(this.CARD_WIDTH/2-this.cardDraggingPointX)-this.CARD_WIDTH/2)/(this.CARD_WIDTH+this.CARDS_MARGIN),i=this.lastDestinationCardIndex;if(r<i-1)i-=1;else if(r>i+1){this.placeholderElement&&i+1===this.cardsElements.length-1||(i+=1)}if(i!==this.lastDestinationCardIndex){var o=this.cardsElements.indexOf(this.draggingCard);i>this.lastDestinationCardIndex?i>o?(this.wrapperTransitions(!0,this.cardsElements[i]),Object(s.addClass)(this.cardsElements[i],"pretty-card_dragging_left")):i<=o&&Object(s.removeClass)(this.cardsElements[this.lastDestinationCardIndex],"pretty-card_dragging_right"):i<this.lastDestinationCardIndex&&(i>=o?Object(s.removeClass)(this.cardsElements[this.lastDestinationCardIndex],"pretty-card_dragging_left"):i<o&&(this.wrapperTransitions(!0,this.cardsElements[i]),Object(s.addClass)(this.cardsElements[i],"pretty-card_dragging_right"))),this.lastDestinationCardIndex=i}}}}addPlaceholder(){if(this.options.placeholder_html){var t=se(this.options.placeholder_html);this.wrapper.appendChild(t),this.cardsElements.push(t),this.placeholderElement=t,addEvent(t,"click",this.onPlaceholderClicked.bind(this))}}onUrlChosen(t,e,r){var i=t.btns.ok[0],a=Object(s.geByClass1)("share_url_input",t.bodyNode),n=val(a);Object(o.lockButton)(i),disable(a,!0),hide("share_url_error"),ajax.post("al_wall.php",{act:"a_pretty_cards_check_url",url:n,owner_id:e},{onDone:(e,s,i)=>{this.lastChosenUrl=s,t.hide(),r(s,e,i)},onFail:t=>{var e="";return t&&t!==Object(l.getLang)("global_unknown_error")&&(e=t+" "),Object(s.ge)("share_url_error").innerHTML=e+Object(l.getLang)("global_share_link_failed"),disable(a,!1),Object(o.unlockButton)(i),show("share_url_error"),elfocus(a),!0}})}chooseUrl(t,e,r){window.onShareChooseUrlBoxInit=()=>{var e=curBox(),i=Object(s.geByClass1)("share_url_input",e.bodyNode);addEvent(i,"keydown",s=>{if(s.which===KEY.ENTER)return this.onUrlChosen(e,r,t),!1})};var i=showBox("share.php",{act:"choose_url_box",default_url:e},{dark:1});i.removeButtons(),i.addButton(Object(l.getLang)("global_continue"),this.onUrlChosen.bind(this,i,r,t))}onPlaceholderClicked(){this.chooseUrl((t,e,r)=>{this.addCard({link:t,link_decoded:r,allowed_buttons:e})},this.lastChosenUrl,this.options.owner_id)}wrapperTransitions(t,e,r){e&&(t?Object(s.addClass)(e,!0===r?"pretty-card_transitions_long":"pretty-card_transitions_on"):(Object(s.removeClass)(e,"pretty-card_transitions_long"),Object(s.removeClass)(e,"pretty-card_transitions_on")))}addCard(t){if(this.options.card_template_html&&(!(this.cardsElements.length>=intval(this.options.cards_max))||this.placeholderElement)){var e=this.cardsElements.length===intval(this.options.cards_max),r=se(this.options.card_template_html);if(t){if(t.id&&t.owner_id?r.prettyCardId=t.owner_id+"_"+t.id:r.prettyCardId=this.newCardsId--,t.link&&this.setLink(r,t.link,t.link_decoded),t.title&&val(Object(s.geByClass1)("pretty-card__title",r),t.title),void 0!==t.price&&t.price!=this.options.price_unshown){var i=Object(s.geByClass1)("pretty-card__price_actual",r),o=domPS(domPN(i));val(i,t.price),this.priceInputChanged(i),this.togglePrice(o,!0)}if(void 0!==t.price_old&&t.price_old!=this.options.price_unshown){var a=Object(s.geByClass1)("pretty-card__price_old",r),d=domPS(domPN(a));val(a,t.price_old),this.priceInputChanged(a),this.togglePrice(d,!0)}t.photo_url&&this.setPhoto(r,t.photo_url),t.photo&&(r.prettyCardPhoto=t.photo),t.allowed_buttons&&(r.prettyCardAllowedButtons=t.allowed_buttons,t.button_key?this.setButton(Object(s.geByClass1)("pretty-card__button",r),t.button_key,r.prettyCardAllowedButtons):t.button_action&&this.setButtonRaw(Object(s.geByClass1)("pretty-card__button",r),t.button_action,t.button_text))}if(this.wrapperTransitions(!1,r),Object(s.addClass)(r,"pretty-card_removing_yes"),this.cardsElements.splice(this.cardsElements.length-1,0,r),this.placeholderElement&&(this.wrapperTransitions(!1,this.placeholderElement),this.wrapper.insertBefore(r,this.placeholderElement),Object(s.addClass)(this.placeholderElement,"pretty-card_adding_yes"),this.placeholderElement.offsetHeight),r.offsetHeight,this.wrapperTransitions(!0,this.placeholderElement),this.wrapperTransitions(!0,r),Object(s.removeClass)(r,"pretty-card_removing_yes"),this.placeholderElement&&Object(s.removeClass)(this.placeholderElement,"pretty-card_adding_yes"),e?setTimeout(()=>{this.placeholderElement&&(re(this.placeholderElement),delete this.placeholderElement),this.cardsElements.splice(this.cardsElements.length-1,1),this.scroll(0,!1)},this.TRANSFORM_ANIMATION_DELAY):setTimeout(this.scroll.bind(this,0,!1),this.TRANSFORM_ANIMATION_DELAY),geByClass("pretty-card__price-adder",r).map(t=>{addEvent(t,"click",this.priceAdderClicked.bind(this,t)),addEvent(Object(s.geByClass1)("pretty-card__editor-button_type_remove",domNS(t)),"click",this.priceRemoverClicked.bind(this,t))}),geByClass("pretty-card__price",r).map(t=>addEvent(t,"change blur",this.priceInputChanged.bind(this,t))),geByClass("pretty-card__price",r).map(t=>addEvent(t,"focus",this.priceInputFocused.bind(this,t))),this.options.price_max){var c=String(this.options.price_max).length;geByClass("pretty-card__price",r).map(t=>t.setAttribute("maxlength",c))}var h=Object(s.geByClass1)("pretty-card__edit-button_action_remove",r);addEvent(h,"click",()=>{window.tooltips&&tooltips.destroyAll(this.el),this.placeholderElement||this.addPlaceholder();var t=this.cardsElements.length,e=this.cardsElements.indexOf(r);this.wrapperTransitions(!0,r),Object(s.addClass)(r,"pretty-card_removing_yes");for(var i=e+1;i<t;++i){var o=this.cardsElements[i];this.wrapperTransitions(!0,o),setTimeout(s.addClass.pbind(o,"pretty-card_adding_yes"),(i-e-1)*this.TRANSFORM_ANIMATION_DELAY)}r.offsetHeight;for(var a=e+1;a<t;++a){this.cardsElements[a].offsetHeight}var n=(t-e-2)*this.TRANSFORM_ANIMATION_DELAY+this.TRANSFORM_ANIMATION_DURATION;this.cardsElements.splice(e,1),this.scroll(0,!1),setTimeout(()=>{re(r);for(var t=e;t<this.cardsElements.length;++t){var i=this.cardsElements[t];this.wrapperTransitions(!1,i),Object(s.removeClass)(i,"pretty-card_adding_yes")}},n)}),addEvent(h,"mouseover",()=>{Object(n.showTooltip)(h,{text:Object(l.getLang)("wall_pretty_cards_remove_tt"),black:1,appendParentCls:"pretty-cards",shift:[7,10]})}),addEvent(Object(s.geByClass1)("pretty-card__link-editor",r),"click",()=>{this.chooseUrl((t,e,s)=>{r.prettyCardAllowedButtons=e,this.setLink(r,t,s)},r.prettyCardLink,this.options.owner_id)});var p=Object(s.geByClass1)("pretty-card__button",r);addEvent(p,"click",this.buttonEditorClicked.bind(this,p,r)),addEvent(p,"mouseover",Page.actionsDropdownUnhide),addEvent(p,"mouseout",Page.actionsDropdownHide.bind(this,this.buttonEditorDropdown)),addEvent(Object(s.geByClass1)("pretty-card__button-remove",p),"click",this.buttonRemoveClicked.bind(this,p)),this.initPhotoUploader(r),addEvent(r,"mousedown",this.onCardMouseDown.bind(this,r)),addEvent(geByTag1("body"),"mouseup",this.onCardMouseUp.bind(this,r))}}setLink(t,e,r){var i=Object(s.geByClass1)("pretty-card__link-editor",t);i.innerHTML=r,t.prettyCardLink=e;var o="tel:"===e.substr(0,4);toggleClass(i,"pretty-card__link-editor_phone_yes",o)}initPhotoUploader(t){var e=Object(s.geByClass1)("pretty-card__upload-photo-button",t),r=Object(s.geByClass1)("pretty-card__edit-button_action_photo",t),i=Object(s.geByClass1)("pretty-card__upload-progress",t),o=extend({},this.options.upload_options_changed,{clear:!0,onUploadStart:this.onPhotoUploadStart.bind(this,i),onUploadError:this.onPhotoUploadError.bind(this,i),onUploadComplete:this.onPhotoUploadComplete.bind(this,i,t),onUploadProgress:this.onPhotoUploadProgress.bind(this),onCheckComplete:this.onPhotoUploadCheckComplete.bind(this,{})});UploadPhotoTransform.init(e,this.options.upload_url,this.options.upload_vars,this.options.upload_options,o),addEvent(r,"click",()=>{domFC(e).click()}),addEvent(r,"mouseover",()=>{Object(n.showTooltip)(r,{text:Object(l.getLang)("wall_pretty_cards_upload_photo_tt"),black:1,appendParentCls:"pretty-cards",shift:[7,10]})})}onPhotoUploadStart(t,e,r){debugLog("Upload started"),Object(s.addClass)(t,"pretty-card__upload-progress_shown_yes"),showProgress(t,"","inv")}onPhotoUploadError(t,e,r){debugLog("Upload error, msg:",r),r="При загрузке произошла ошибка, проверьте, что размер изображения не менее 400х400 пикселей и удовлетворяет требованиям.",Object(a.showFastBox)({title:Object(l.getLang)("global_error")},r),hideProgress(t),Object(s.removeClass)(t,"pretty-card__upload-progress_shown_yes"),Upload.embed(e)}onPhotoUploadComplete(t,e,r,i){var o;debugLog("Upload complete",e,r,i);try{o=parseJSON(i)}catch(t){}o&&o.photo?UploadPhotoTransform.getPhotoUrl(o,this.options.stored_photo_size_list,r=>{debugLog("Success uploading photo"),this.setPhoto(e,r),e.prettyCardPhoto=o.photo,hideProgress(t),Object(s.removeClass)(t,"pretty-card__upload-progress_shown_yes")},()=>{debugLog("Error uploading photo"),hideProgress(t),hide(t)}):Upload.onUploadError(r)}onPhotoUploadProgress(t,e,r){debugLog("Upload progress")}onPhotoUploadCheckComplete(t,e){t.renewComplete?Upload.embed(e):(t.renewComplete=!0,setTimeout(UploadPhotoTransform.reinit.pbind(e),1))}setPhoto(t,e){var r=Object(s.geByClass1)("pretty-card__photo",t),i=Object(s.geByClass1)("pretty-card__photo-fader",t);setStyle(i,{backgroundImage:`url(${e})`}),hide(Object(s.geByClass1)("pretty-card__upload-photo-button",r)),Object(s.addClass)(i,"pretty-card__photo-fader_top_yes"),setTimeout(()=>{setStyle(r,{backgroundImage:`url(${e})`}),Object(s.removeClass)(i,"pretty-card__photo-fader_top_yes"),Object(s.removeClass)(r,"pretty-card__photo_upload_yes")},200)}onCardMouseDown(t,e){if(!this.draggingCard&&hasClass(e.target,"pretty-card__draghandle"))return this.draggingCard=t,this.draggingStartingX=e.clientX,this.draggingStartingTranslateX=this.translateX,this.draggingContainerX=this.wrapperOuter.getBoundingClientRect().left,this.cardDraggingPointX=e.clientX-t.getBoundingClientRect().left,this.lastDestinationCardIndex=this.cardsElements.indexOf(t),this.wrapperTransitions(!0,t),Object(s.addClass)(t,"pretty-card_dragging_yes"),Object(s.addClass)(t,"pretty-card_ontop_yes"),setTimeout(this.wrapperTransitions.pbind(!1,t),this.TRANSFORM_ANIMATION_DURATION),e.cancelBubble=!0,e.returnValue=!1,!1}onCardMouseUp(t){if(t===this.draggingCard){this.draggingCard&&delete this.draggingCard;var e=this.cardsElements.indexOf(t),r=this.lastDestinationCardIndex;this.wrapperTransitions(!0,t),setStyle(t,{transform:"translateX("+(r-e)*(this.CARD_WIDTH+this.CARDS_MARGIN)+"px)"}),Object(s.removeClass)(t,"pretty-card_dragging_yes"),setTimeout(()=>{Object(s.removeClass)(t,"pretty-card_ontop_yes");var i,o=c(this.cardsElements);try{for(o.s();!(i=o.n()).done;){var a=i.value;this.wrapperTransitions(!1,a),Object(s.removeClass)(a,"pretty-card_dragging_right"),Object(s.removeClass)(a,"pretty-card_dragging_left"),setStyle(a,{transform:""})}}catch(t){o.e(t)}finally{o.f()}if(e<r){for(var n=e+1;n<=r;++n)this.wrapper.insertBefore(this.cardsElements[n],this.cardsElements[e]);this.cardsElements.splice(r+1,0,t),this.cardsElements.splice(e,1)}else if(e>r){for(var l=e-1;l>=r;--l)this.wrapper.insertBefore(this.cardsElements[l],domNS(this.cardsElements[e]));this.cardsElements.splice(e,1),this.cardsElements.splice(r,0,t)}this.scroll(0,!1)},this.TRANSFORM_ANIMATION_DURATION)}}buttonEditorClicked(t,e,r){var s=e.prettyCardAllowedButtons,i=domFC(this.buttonEditorDropdown);i.innerHTML="",Object.keys(s).map(e=>{var r=se(this.options.button_action_template_html),o=s[e];r.innerHTML=o[1],addEvent(i.appendChild(r),"click",this.buttonActionClicked.bind(this,t,e,s))}),setStyle(this.buttonEditorDropdown,{right:this.el.clientWidth-(e.offsetLeft+this.CARD_WIDTH)+this.CONTENT_PADDING+this.translateX,top:e.clientHeight+this.POST_PADDING_TOP+t.offsetTop+t.clientHeight}),Page.actionsDropdown(this.buttonEditorDropdown)}setButtonRaw(t,e,r){Object(s.removeClass)(t,"button_contour"),Object(s.addClass)(t,"button_bright_blue"),Object(s.geByClass1)("pretty-card__button-editor-label",t).innerHTML=r}setButton(t,e,r){var s=r[e],i=s[0],o=s[1];this.setButtonRaw(t,i,o),t.prettyCardButtonKey=e}buttonActionClicked(t,e,r){this.setButton(t,e,r),Page.actionsDropdownHide(this.buttonEditorDropdown,1)}buttonRemoveClicked(t){return Object(s.addClass)(t,"button_contour"),Object(s.removeClass)(t,"button_bright_blue"),Object(s.geByClass1)("pretty-card__button-editor-label",t).innerHTML=Object(l.getLang)("global_wall_pretty_cards_add_button"),Page.actionsDropdownHide(this.buttonEditorDropdown,1),t.prettyCardButtonKey="",!1}togglePrice(t,e){toggleClass(t,"pretty-card__price_hidden_yes",!!e),toggleClass(domNS(t),"pretty-card__price-wrapper_hidden_yes",!e)}priceAdderClicked(t){this.togglePrice(t,!0),elfocus(Object(s.geByClass1)("pretty-card__editor",domNS(t)))}priceRemoverClicked(t){this.togglePrice(t,!1)}priceInputFocused(t){var e=this.formatPriceString(val(t));val(t,e),t.setSelectionRange(0,100)}formatPriceString(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(""===t.trim())return"";var r=parseFloat(t.replace(",",".").replace(/[^\d.]/g,""));return isNaN(r)||(r=parseFloat(r.toFixed(2))),e?isNaN(r)?"0":Math.floor(100*r)%100==0?r:r.toFixed(2):isNaN(r)?0:r}priceInputChanged(t){var e=val(t).trim();if(""!==e){var r,i=this.formatPriceString(e);if(i=Math.min(i,intval(this.options.price_max)),0===(i=Math.max(i,intval(this.options.price_min))))r=Object(l.getLang)("wall_pretty_cards_price_free_val");else{var o=window.langConfig&&window.langConfig.numDel||"";r=stripHTML(langNumeric(i,Object(l.getLang)("global_money_amount_rub_short","raw"),!0)).replace(new RegExp(o,"g")," ")}val(t,r)}else{var a=Object(s.geByClass1)("pretty-card__price-adder",gpeByClass("pretty-card__price-container",t));this.togglePrice(a,!1)}}scroll(t){var e=(this.container.clientWidth-2*this.POST_PADDING-this.VIEWPORT_CARDS*this.CARD_WIDTH-(this.VIEWPORT_CARDS-1)*this.CARDS_MARGIN)/2,r=this.cardsElements.length;this.scrollPosition+=t,this.scrollPosition=Math.max(0,this.scrollPosition),this.scrollPosition=Math.max(0,Math.min(this.cardsElements.length-this.VIEWPORT_CARDS,this.scrollPosition));var s=Math.max(0,r-this.scrollPosition-this.VIEWPORT_CARDS),i=this.scrollPosition,o=this.scrollPosition*(this.CARD_WIDTH+this.CARDS_MARGIN);return!s&&r>this.VIEWPORT_CARDS?o-=2*e:i&&(o-=e),this.translateX=o,this.wrapperOuter.scrollTo({left:o,behavior:"smooth"}),toggleClass(this.scrollerRight,"pretty-cards__scroller_hidden_right",!s),toggleClass(this.scrollerLeft,"pretty-cards__scroller_hidden_left",!i),toggleClass(this.scrollerProtector,"pretty-cards__scroller_position_left",t<0),toggleClass(this.scrollerProtector,"pretty-cards__scroller_position_right",t>=0),show(this.scrollerProtector),this.cardsPos=o,!1}updateCardsIds(t){var e,r=c(this.cardsElements);try{for(r.s();!(e=r.n()).done;){var s=e.value;s.prettyCardId in t&&(s.prettyCardId=t[s.prettyCardId])}}catch(t){r.e(t)}finally{r.f()}}needSendData(){var t=this.getSendData().prettyCardsData;return d(t)!==this.sendDataHash}updateSendDataHash(){var t=this.getSendData().prettyCardsData;this.sendDataHash=d(t)}saveCards(t,e){var r=this.getSendData(),i=r.attachVal,o=r.prettyCardsData,a=(r,i,o)=>{if("ok"===r)this.updateCardsIds(i),this.updateSendDataHash(),t&&t();else if(e){if(e(i),o){var a=this.cardsElements.find(t=>t.prettyCardId==o);if(a){var n=this.cardsElements.indexOf(a)-this.scrollPosition,l=!1;n>this.VIEWPORT_CARDS-1?(this.scroll(n-(this.VIEWPORT_CARDS-1)),l=!0):n<0&&(this.scroll(n),l=!0);setTimeout(()=>{Object(s.addClass)(a,"pretty-card_error_yes"),setTimeout(s.removeClass.pbind(a,"pretty-card_error_yes"),1e3)},l?this.TRANSFORM_ANIMATION_DURATION+300:300)}}return!0}};ajax.post("al_wall.php",{act:"a_pretty_cards_save",pretty_cards_data:o,attach:i,owner_id:this.options.owner_id,hash:this.options.save_hash},{onDone:a,onFail:a.bind(this,"error")})}getSendData(){var t,e=[],r=[],i=c(this.cardsElements);try{for(i.s();!(t=i.n()).done;){var o=t.value;if(o!==this.placeholderElement){var a=Object(s.geByClass1)("pretty-card__price_actual",o),n=val(a),l=void 0;l=hasClass(domPN(a),"pretty-card__price-wrapper_hidden_yes")?this.options.price_unshown:this.formatPriceString(n,!0);var d=Object(s.geByClass1)("pretty-card__price_old",o),h=val(d),p=void 0;p=hasClass(domPN(d),"pretty-card__price-wrapper_hidden_yes")?this.options.price_unshown:this.formatPriceString(h,!0);var _=Object(s.geByClass1)("pretty-card__button",o),g=o.prettyCardId,u={id:g,title:val(Object(s.geByClass1)("pretty-card__title",o)),price:l,price_old:p,button:_.prettyCardButtonKey?_.prettyCardButtonKey:"",link:o.prettyCardLink,photo:o.prettyCardPhoto};r.push(g),e.push(u)}}}catch(t){i.e(t)}finally{i.f()}return{prettyCardsData:JSON.stringify(e),attachVal:r.join(",")}}onCardsClick(t){var e=t.target.closest(".pretty-card");this.onCardClick(e)}onCardClick(t){if(!Object(s.domData)(t,"ad-block-uid"))return!1;var e=Object(s.domData)(t,"ad-stat-click");e&&this.triggerCardStatEvent(e)}triggerCardStatEvent(t){if(!t)return!1;t.split("$$$").forEach(t=>Object(i.vkImage)().src=t)}getAdPixelData(){return this.cardsElements.reduce((t,e)=>{var r=Object(s.domData)(e,"ad-block-uid");if(!r)return t;var i=Object(s.domData)(e,"ad-stat-impression")||"";return t[r]={stats:{impression:{pixel:i}}},t},{})}createCardObserver(t,e,r){var i=Object(s.domData)(t,"ad-block-uid");if(!i)return!1;var o=["impression"].includes(e);new IntersectionObserver((r,a)=>{r.map(r=>{r.isIntersecting&&1===r.intersectionRatio&&this.adPixelData[i]&&(o&&a.unobserve(t),this.triggerCardStatEvent(this.adPixelData[i].stats[e].pixel),Object(s.domData)(t,"ad-disabled-stat-"+e,Object(s.domData)(t,"ad-stat-"+e)),Object(s.domData)(t,"ad-stat-"+e,null))})},r).observe(t)}}}});